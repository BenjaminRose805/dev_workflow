# Task 9.4: Orchestrator Features NOT in Current TUI Plan

**Date:** 2025-12-26
**Source:** Phase 8 inventory (tasks 8.1-8.5) vs tui-integration-implementation.md
**Purpose:** Identify orchestrator features missing from current TUI plan

---

## Summary

Comparing the orchestrator feature inventory from Phase 8 against the current TUI plan reveals **22 missing orchestrator features**. The current TUI plan has command integration (Phase 3) for running commands but lacks execution control, stuck detection, and error recovery UI.

---

## Current TUI Plan Orchestrator Coverage

### What's Partially Covered

| Feature | Location in Plan | Gap |
|---------|-----------------|-----|
| Task actions | Phase 3.2-3.4 | `e/i/v/s` keys but no stuck handling |
| Activity stream | Existing | Shows tool calls, no orchestrator events |
| Progress display | Existing | Basic progress bar, no iteration count |

### What's Completely Missing

- Pause/Resume/Stop controls
- Stuck task detection and intervention
- Retry tracking and controls
- Error detail modals
- Batch size adjustment
- IPC command integration
- Orchestrator status indicators

---

## Missing Orchestrator Features

### Category A: Execution Control (Critical)

| Feature | Source | Impact | Description |
|---------|--------|--------|-------------|
| **Pause execution** | 8.5 | HIGH | `P` key → pause after current task |
| **Resume execution** | 8.5 | HIGH | `R` key → resume paused orchestrator |
| **Stop/shutdown** | 8.5 | HIGH | `Q` key → graceful stop modal |
| **Skip current task** | 8.5 | HIGH | `S` key → skip with reason |
| **Abort current task** | 8.5 | MEDIUM | Force-fail stuck task |
| **Force retry** | 8.5 | MEDIUM | `Ctrl+R` → reset task |

### Category B: Stuck Detection & Recovery (Critical)

| Feature | Source | Impact | Description |
|---------|--------|--------|-------------|
| **Stuck warning panel** | 8.4 | HIGH | Alert when task exceeds threshold |
| **Countdown timer** | 8.4 | HIGH | `28:45 / 30:00` per task |
| **Activity heartbeat** | 8.4 | MEDIUM | Show last activity time |
| **Extend threshold** | 8.4 | MEDIUM | `X` key → grant more time |
| **Manual intervention modal** | 8.4 | HIGH | Options: retry, skip, extend |
| **Threshold adjustment** | 8.4 | LOW | Change 30-min default |

### Category C: Error Handling

| Feature | Source | Impact | Description |
|---------|--------|--------|-------------|
| **Error detail modal** | 8.5 | HIGH | `E` key → show full error |
| **Retry badge on tasks** | 8.5 | HIGH | `[Retry 2/3]` indicator |
| **Exhausted task list** | 8.5 | MEDIUM | Show tasks with no retries left |
| **Failure panel** | 8.5 | MEDIUM | Dedicated failed task display |

### Category D: Batch & Orchestrator Control

| Feature | Source | Impact | Description |
|---------|--------|--------|-------------|
| **Batch size adjustment** | 8.5 | LOW | `+`/`-` keys at runtime |
| **IPC status query** | 8.3 | LOW | Query remote orchestrator |
| **Iteration count display** | 8.1 | MEDIUM | `Iteration: 12/50` in header |
| **Orchestrator state indicator** | 8.5 | MEDIUM | Running/paused/stopped badge |

### Category E: Event Streaming

| Feature | Source | Impact | Description |
|---------|--------|--------|-------------|
| **Task start/complete events** | 8.3 | MEDIUM | Real-time event feed |
| **Phase transition events** | 8.3 | LOW | Show phase changes |
| **Agent spawn events** | 8.3 | LOW | Track agent spawning |
| **Constraint violation events** | 8.3 | MEDIUM | Alert on violations |

---

## Gap Analysis Summary

### By Priority

| Priority | Count | Features |
|----------|-------|----------|
| **HIGH** | 10 | Pause, resume, stop, skip, stuck panel, countdown, intervention, error modal, retry badge |
| **MEDIUM** | 8 | Abort, force retry, heartbeat, extend, exhausted, failure panel, iteration, state, task events, constraint events |
| **LOW** | 4 | Threshold adjust, batch size, IPC, phase events, agent events |

### By Implementation Type

| Type | Count | Features |
|------|-------|----------|
| **Control (user action)** | 8 | Pause, resume, stop, skip, abort, retry, extend, batch size |
| **Display (read-only)** | 9 | Stuck panel, countdown, heartbeat, retry badge, exhausted, failure, iteration, state, events |
| **Modal/Overlay** | 3 | Stop confirmation, intervention, error detail |
| **IPC Integration** | 2 | Status query, event streaming |

---

## Specific Feature Details

### 1. Pause/Resume/Stop Modal (Missing)

**Proposed in task 8.5:**
```
┌─ Execution Control ─────────────────────────────────────────┐
│                                                              │
│   Current State: RUNNING                                     │
│   Iteration: 12/50                                           │
│   Active Tasks: 3.2, 4.1                                     │
│                                                              │
│   [P] Pause after current task                               │
│   [S] Stop immediately (graceful)                            │
│   [F] Force stop (may lose progress)                         │
│   [Esc] Cancel                                               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**Why missing:** Current TUI has no orchestrator control surface.

**Implementation:** Uses IPC to send pause/shutdown commands.

### 2. Stuck Detection Panel (Missing)

**Proposed in task 8.4:**
```
┌─ ⚠ Stuck Detection ─────────────────────────────────────────┐
│                                                              │
│  Task 3.2: Merge docs          28:45 / 30:00                │
│  ├─ Last activity: 5 min ago                                │
│  ├─ Claude status: idle                                     │
│  └─ [E]xtend [S]kip [R]etry [?]Details                      │
│                                                              │
│  Task 4.1: Create redirects    15:23 / 30:00                │
│  └─ Status: Active ✓                                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

**Why missing:** Current TUI has no time-based monitoring.

**Data source:** `detect-stuck` command, task `startedAt` timestamps.

### 3. Task Action Menu (Partial - Missing Orchestrator Actions)

**Current plan has:** `e/i/v/s/f/d` for explain/implement/verify/skip/findings/deps

**Missing actions:**
```
┌─ Task 3.2: Merge documentation ─────────────────────────────┐
│                                                              │
│   Status: in_progress (18:45 elapsed)                        │
│   Phase: 3 - Documentation                                   │
│   Dependencies: 3.1 ✓                                        │
│                                                              │
│   [E] Explain task                                           │
│   [I] Implement task                                         │
│   [V] Verify task                                            │
│   [S] Skip task                                              │
│   [F] View findings                                          │
│   [D] Show dependencies                                      │
│   [X] Extend stuck threshold     ← NEW                       │
│   [R] Retry task                 ← NEW                       │
│   [A] Abort task                 ← NEW                       │
│   [Esc] Close                                                │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 4. Retry Badge on Tasks (Missing)

**Proposed in task 8.5:**
```
┌──────────────────────────────────────────┐
│ IN PROGRESS                              │
├──────────────────────────────────────────┤
│ 2.1: Update API [Retry 2/3] [◐ 45%]     │
│ 2.3: Add middleware                      │
│ 3.1: Create service [Retry 1/3]          │
└──────────────────────────────────────────┘
```

**Why missing:** Current plan shows task status but not retry state.

**Data source:** `task.retryCount` from status.json.

---

## Integration Points with Current TUI Plan

### Easy Extensions to Existing Tasks

| Existing Task | Possible Extension |
|---------------|-------------------|
| 3.2 Task Action Keys | Add `X/R/A` for extend/retry/abort |
| 2.3 Retry History | Add retry badge with count |
| 2.2 Upcoming Tasks | Add stuck countdown |

### New Tasks Needed

| Feature Cluster | Est. Tasks | Priority |
|-----------------|------------|----------|
| Execution control modal | 2 tasks | HIGH |
| Stuck detection panel | 2 tasks | HIGH |
| Error detail modal | 1 task | HIGH |
| Event streaming | 2-3 tasks | MEDIUM |
| IPC integration | 2 tasks | LOW |

---

## Data Availability

All features have **data sources already implemented**:

| Feature | Data Source | Status |
|---------|-------------|--------|
| Pause/resume/stop | IPC via `plan_orchestrator.py` | Available |
| Stuck detection | `detect-stuck` command | Available |
| Task duration | `task.startedAt` timestamps | Available |
| Retry count | `task.retryCount` in status.json | Available |
| Error messages | `task.lastError` in status.json | Available |
| Orchestrator state | `orchestrator-registry.json` | Available |
| Events | Claude runner callbacks | Available |

---

## Recommendations

### Quick Wins (Extend Existing Tasks)

1. **Add retry badge** to In Progress panel
2. **Add iteration count** to header
3. **Add X/R/A keys** to task action menu

### Medium Effort (New Tasks in Existing Phases)

4. **Execution control modal** (new task in Phase 3)
5. **Stuck detection panel** (new task in Phase 2)
6. **Error detail modal** (new task in Phase 2)

### Larger Features (May Need New Plan)

7. **Event streaming infrastructure** (requires architectural change)
8. **IPC integration for remote control** (new communication layer)

---

## Key Differences from Current Plan

| Aspect | Current Plan | Missing |
|--------|--------------|---------|
| **Control** | Execute commands | Pause, resume, stop orchestrator |
| **Monitoring** | Progress bar, activity | Stuck detection, time tracking |
| **Recovery** | None | Retry controls, error modals |
| **State** | Task status | Orchestrator running state |

The fundamental gap is that the current TUI plan treats the TUI as a **command executor** but not as an **orchestrator controller**. It can run `/plan:implement` but cannot pause a running orchestrator.

---

## Verification Criteria

- [x] Compared Phase 8 inventory with current TUI plan
- [x] Identified 22 missing orchestrator features
- [x] Categorized by priority (HIGH/MEDIUM/LOW)
- [x] Noted data availability for each feature
- [x] Proposed integration points

---

**End of Analysis**
