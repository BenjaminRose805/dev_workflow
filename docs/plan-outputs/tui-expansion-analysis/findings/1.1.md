# Task 1.1: Git Workflow Phase 1 Findings Review - Branch Operations

## Summary

Review of `docs/plan-outputs/git-workflow-phase1-core-branching/findings/` for branch operations applicable to TUI expansion.

## Branch Operations Identified

### 1. Branch Creation & Switching (`/plan:set`)
**Source:** findings/1.1.md

| Operation | Implementation | TUI Opportunity |
|-----------|---------------|-----------------|
| Create plan branch | `git checkout -b plan/{plan-name}` | Visual branch creation indicator |
| Switch to existing branch | `git checkout plan/{plan-name}` | Branch switcher panel |
| Derive branch name | `plan/{plan-name}` from plan filename | Show expected branch in UI |
| Git availability check | `git --version` at start | Graceful degradation in TUI |

### 2. Branch Validation (`/plan:implement`)
**Source:** findings/2.3.md

| Validation | Logic | TUI Opportunity |
|------------|-------|-----------------|
| Correct plan branch check | `$CURRENT_BRANCH == plan/{plan-name}` | Branch status badge (✓/⚠) |
| Auto-switch from wrong plan branch | Detects `plan/other-plan`, switches automatically | Confirmation modal |
| Non-plan branch warning | Continues with warning if on master/feature | Warning banner |
| Detached HEAD handling | Warn but continue | Status indicator |

### 3. Branch Switching Between Plans
**Source:** findings/5.2.md

| Feature | Behavior | TUI Opportunity |
|---------|----------|-----------------|
| Independent commit counts | Each branch tracks separately | Per-plan commit counter |
| File isolation | Changes isolated to branches | Dirty file indicator |
| Seamless switching | No data loss on switch | Transition animation |

### 4. Uncommitted Changes Handling
**Source:** findings/5.3.md, findings/1.1.md

| Feature | Current Behavior | TUI Opportunity |
|---------|------------------|-----------------|
| Detection | `git status --porcelain` counts files | Uncommitted files badge |
| Threshold warning | >=10 files = too many | Threshold indicator/progress |
| Auto-stash | `git stash push -m "plan-switch: ..."` | Stash management panel |
| User options | commit/stash/cancel | Quick action buttons |

### 5. Git Info in Status Output
**Source:** findings/4.1.md, findings/5.1.md

| Output Format | Git Fields | TUI Display |
|---------------|------------|-------------|
| Text | Branch, Uncommitted, Commits ahead, Last commit | Status bar section |
| JSON | `git: { branch, uncommittedCount, commitCount, lastCommit }` | Data source for panels |
| Markers | `[PROGRESS] git branch=X uncommitted=N commits=N` | Real-time updates |

### 6. Backwards Compatibility
**Source:** findings/5.4.md

| Scenario | Behavior | TUI Implication |
|----------|----------|-----------------|
| No git installed | `getGitInfo()` returns null | Hide git section |
| Not in git repo | Returns null | Graceful fallback |
| Non-plan branch | Works, shows branch name | Show all branch types |
| Git command failure | Individual field null, others work | Partial git display |

## Key Data Points for TUI

### From status-cli.js JSON Output
```json
{
  "git": {
    "branch": "plan/my-plan",
    "uncommittedCount": 2,
    "commitCount": 5,
    "lastCommit": {
      "sha": "abc1234",
      "message": "[plan-name] task 1.1: Description"
    }
  }
}
```

### Recommended TUI Components

1. **Branch Status Badge**
   - Shows current branch name
   - Color coding: Green (correct plan branch), Yellow (other plan branch), Red (non-plan branch)

2. **Uncommitted Changes Indicator**
   - File count badge
   - Quick stash/commit buttons

3. **Commit Counter**
   - "N commits ahead of master"
   - Links to commit list

4. **Last Commit Display**
   - SHA + abbreviated message
   - Task ID linkable

5. **Branch Switcher**
   - List of plan branches
   - Current indicator
   - Quick switch capability

## API Integration Points

| Function | Location | Purpose |
|----------|----------|---------|
| `getGitInfo()` | status-cli.js:146-223 | Get all git info |
| `cmdProgress` | status-cli.js:873-1072 | Includes git in output |
| `cmdStatus` | status-cli.js:176-209 | JSON status output |

## Recommended TUI Panel: Git Status Panel

```
┌─ Git Status ──────────────────────────────────┐
│ Branch: plan/tui-expansion-analysis ✓         │
│ Commits: 3 ahead of master                    │
│ Uncommitted: 0 files                          │
│ Last: abc1234 [plan] task 1.1: Add tests      │
│                                               │
│ [Commit] [Stash] [Switch Branch]              │
└───────────────────────────────────────────────┘
```
