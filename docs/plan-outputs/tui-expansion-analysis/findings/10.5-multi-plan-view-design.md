# Task 10.5: Multi-Plan View Design

**Date:** 2025-12-26
**Purpose:** Design TUI view for managing multiple concurrent plans
**Scope:** Side-by-side progress, cross-plan dependencies, resource allocation

---

## Executive Summary

The Multi-Plan View is an **architectural-level** expansion that provides visibility and control across multiple concurrent plans. This design specifies a dashboard view showing all active plans, a plan switcher, cross-plan progress comparison, and resource allocation visualization.

**Estimated Effort:** 40-56 hours (High - requires multi-plan infrastructure)
**Priority:** P2 (High Value, but depends on worktree support)

---

## 1. View Overview

### 1.1 Purpose

Enable users to:
- See all active plans and their progress at a glance
- Switch between plans without leaving TUI
- Compare progress across plans
- Understand resource allocation (if multiple orchestrators)
- Visualize cross-plan dependencies (future: worktree integration)

### 1.2 Prerequisites

This feature depends on:
- `--plan` argument implementation (completed, task 6.1)
- Separate status.json per plan (completed)
- orchestrator-registry.json for multi-instance tracking
- Git worktree integration (planned: phase 5)

### 1.3 Data Sources

| Data | Source | Update Frequency |
|------|--------|------------------|
| Plan list | Glob `docs/plans/*.md` | Startup / 30s |
| Plan status | `docs/plan-outputs/*/status.json` | 500ms per plan |
| Active plan | `.claude/current-plan.txt` | On demand |
| Orchestrator instances | `.claude/orchestrator-registry.json` | 5s |
| Git branches | `git branch -l plan/*` | 10s |
| Worktrees | `git worktree list` | 30s |

---

## 2. Visual Design

### 2.1 Default View: Plan Selector Dropdown

Quick access plan switcher (toggle with `Tab` or `:plans`):

```
┌─ Plan Selector ───────────────────────────────────────────────────────┐
│                                                                        │
│  Active Plans (3):                                                     │
│                                                                        │
│  ● tui-expansion-analysis (current)                                   │
│    ├─ [████████████████░░░░░░░░░░░░░░░░░░░░] 79%                      │
│    ├─ Phase 10 of 11 │ 45/57 tasks                                    │
│    └─ Branch: plan/tui-expansion-analysis ✓                           │
│                                                                        │
│  ○ git-workflow-phase5-worktrees                                       │
│    ├─ [████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] 12%                      │
│    ├─ Phase 1 of 8 │ 10/84 tasks                                      │
│    └─ Branch: plan/git-workflow-phase5 ⚠ (stale)                      │
│                                                                        │
│  ○ parallel-execution-architecture (paused)                            │
│    ├─ [████████████████████████████████████] 100%                     │
│    ├─ Completed │ 35/35 tasks                                         │
│    └─ Branch: plan/parallel-execution ✓                               │
│                                                                        │
│  [↑/↓] Navigate  [Enter] Switch  [Space] Preview  [Esc] Cancel        │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Expanded View: Multi-Plan Dashboard

Full dashboard (toggle with `Ctrl+P`):

```
┌─ Multi-Plan Dashboard ────────────────────────────────────────────────┐
│                                                                        │
│  ┌─ Overview ──────────────────────────────────────────────────────┐  │
│  │                                                                  │  │
│  │  Active: 2  │  Paused: 1  │  Completed: 3  │  Total: 6          │  │
│  │  Running orchestrators: 1  │  Worktrees: 2                       │  │
│  │                                                                  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  ┌─ tui-expansion-analysis (ACTIVE) ───────────────────────────────┐  │
│  │ ○──────────────────────────────────────────────────────●────────┐  │
│  │ │ [████████████████████████████████████░░░░░░░░░░░░░░░] 79%    │  │
│  │ │                                                                │  │
│  │ │ Phase: 10/11 (Expansion Opportunity Design)                   │  │
│  │ │ Tasks: 45 ✓  12 ◯  0 ✗  0 ⊘                                   │  │
│  │ │ Current: 10.2 Design Parallel Execution Dashboard             │  │
│  │ │ Branch: plan/tui-expansion-analysis ✓                         │  │
│  │ │ Orchestrator: Running (iter 5/50)                              │  │
│  │ └───────────────────────────────────────────────────────────────┘  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  ┌─ git-workflow-phase5-worktrees ─────────────────────────────────┐  │
│  │ ○──────●───────────────────────────────────────────────────────┐  │
│  │ │ [████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] 12%    │  │
│  │ │                                                                │  │
│  │ │ Phase: 1/8 (Core Worktree Infrastructure)                     │  │
│  │ │ Tasks: 10 ✓  74 ◯  0 ✗  0 ⊘                                   │  │
│  │ │ Next: 1.5 Implement worktree directory detection              │  │
│  │ │ Branch: plan/git-workflow-phase5 ⚠ (needs rebase)             │  │
│  │ │ Orchestrator: Not running                                      │  │
│  │ └───────────────────────────────────────────────────────────────┘  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  [1-9] Focus plan  [Enter] Switch  [O] Orchestrate  [N] New plan      │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Side-by-Side Comparison View

Compare two plans (toggle with `Ctrl+Shift+P`):

```
┌─ Plan Comparison ─────────────────────────────────────────────────────┐
│                                                                        │
│  ┌─ tui-expansion-analysis ─────┬─ git-workflow-phase5 ─────────────┐  │
│  │                              │                                    │  │
│  │  Progress:                   │  Progress:                         │  │
│  │  [████████████████░░░░] 79%  │  [████░░░░░░░░░░░░░░░░░░░░░] 12%  │  │
│  │                              │                                    │  │
│  │  Phase: 10/11                │  Phase: 1/8                        │  │
│  │  Tasks: 45/57                │  Tasks: 10/84                      │  │
│  │  Velocity: 4.2 tasks/hr      │  Velocity: 1.8 tasks/hr            │  │
│  │                              │                                    │  │
│  │  Current Task:               │  Current Task:                     │  │
│  │  10.2 Design Parallel        │  (not running)                     │  │
│  │  Execution Dashboard         │                                    │  │
│  │                              │                                    │  │
│  │  Recent:                     │  Recent:                           │  │
│  │  ✓ 10.1 Git Status Panel     │  ✓ 1.4 Worktree path utils        │  │
│  │  ✓ 9.5 Gap categorization    │  ✓ 1.3 Branch detection           │  │
│  │  ✓ 9.4 Orchestrator gaps     │  ✓ 1.2 Config file parsing        │  │
│  │                              │                                    │  │
│  └──────────────────────────────┴────────────────────────────────────┘  │
│                                                                        │
│  [←/→] Switch focus  [Enter] Full view  [Esc] Close                   │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

### 2.4 Resource Allocation Panel

When multiple orchestrators are running:

```
┌─ Resource Allocation ─────────────────────────────────────────────────┐
│                                                                        │
│  Orchestrator Instances (2 running):                                   │
│                                                                        │
│  ┌─────────────────────────────────────────────────────────────────┐  │
│  │                                                                   │  │
│  │  Instance 1: tui-expansion-analysis                               │  │
│  │  ├─ PID: 12345                                                    │  │
│  │  ├─ Worktree: /home/user/project/.worktrees/tui-expansion        │  │
│  │  ├─ Batch size: 5                                                 │  │
│  │  ├─ Active tasks: 3                                               │  │
│  │  └─ API calls: 45/min                                             │  │
│  │                                                                   │  │
│  │  Instance 2: git-workflow-phase5                                   │  │
│  │  ├─ PID: 12346                                                    │  │
│  │  ├─ Worktree: /home/user/project/.worktrees/git-workflow-p5      │  │
│  │  ├─ Batch size: 3                                                 │  │
│  │  ├─ Active tasks: 1                                               │  │
│  │  └─ API calls: 22/min                                             │  │
│  │                                                                   │  │
│  └─────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  Total API Usage: 67/min (limit: 100/min)                             │
│  [████████████████████████████████████████░░░░░░░░░░░░░░░░░░] 67%    │
│                                                                        │
│  [B] Adjust batch sizes  [P] Pause instance  [S] Stop instance        │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

### 2.5 Cross-Plan Dependency Visualization (Future)

For plans with inter-dependencies:

```
┌─ Cross-Plan Dependencies ─────────────────────────────────────────────┐
│                                                                        │
│  Dependency Graph:                                                     │
│                                                                        │
│  tui-integration-implementation                                        │
│  ├─ depends-on: parallel-execution-architecture ✓ (complete)          │
│  ├─ depends-on: git-workflow-phase2 ✓ (complete)                      │
│  └─ blocked-by: None                                                   │
│                                                                        │
│  tui-expansion-analysis                                                │
│  ├─ depends-on: tui-integration-implementation (24 pending)           │
│  └─ blocked-by: None (analysis only)                                   │
│                                                                        │
│  git-workflow-phase5-worktrees                                         │
│  ├─ depends-on: git-workflow-phase4 (not started)                     │
│  └─ blocked-by: git-workflow-phase4                                    │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Implementation Specification

### 3.1 New Python Classes

#### PlanRegistry

```python
from dataclasses import dataclass
from typing import List, Optional, Dict
from pathlib import Path
import json
import glob

@dataclass
class PlanInfo:
    """Information about a single plan."""
    name: str
    path: str
    status_path: Optional[str]
    output_dir: Optional[str]
    branch: Optional[str]
    worktree: Optional[str]
    is_active: bool
    is_current: bool
    orchestrator_pid: Optional[int]

    # Progress
    total_tasks: int
    completed_tasks: int
    failed_tasks: int
    pending_tasks: int
    in_progress_tasks: int
    current_phase: Optional[str]

    @property
    def progress_percent(self) -> float:
        if self.total_tasks == 0:
            return 0
        return (self.completed_tasks / self.total_tasks) * 100

    @property
    def is_complete(self) -> bool:
        return self.completed_tasks == self.total_tasks and self.total_tasks > 0


class PlanRegistry:
    """Registry of all plans in the project."""

    def __init__(self, project_root: str = "."):
        self.project_root = Path(project_root)
        self.plans: List[PlanInfo] = []
        self.current_plan: Optional[str] = None

    def refresh(self) -> None:
        """Scan for all plans and their status."""
        self.plans = []
        self.current_plan = self._get_current_plan()

        # Find all plan files
        plan_pattern = self.project_root / "docs" / "plans" / "*.md"
        for plan_path in glob.glob(str(plan_pattern)):
            plan_info = self._load_plan_info(plan_path)
            if plan_info:
                self.plans.append(plan_info)

        # Sort by activity (current first, then by progress)
        self.plans.sort(key=lambda p: (
            not p.is_current,
            not p.is_active,
            -p.progress_percent
        ))

    def _get_current_plan(self) -> Optional[str]:
        """Get the currently active plan."""
        current_file = self.project_root / ".claude" / "current-plan.txt"
        if current_file.exists():
            return current_file.read_text().strip()
        return None

    def _load_plan_info(self, plan_path: str) -> Optional[PlanInfo]:
        """Load plan information from status files."""
        plan_path = Path(plan_path)
        plan_name = plan_path.stem

        # Determine paths
        output_dir = self.project_root / "docs" / "plan-outputs" / plan_name
        status_path = output_dir / "status.json"

        # Load status if exists
        total = completed = failed = pending = in_progress = 0
        current_phase = None

        if status_path.exists():
            try:
                with open(status_path) as f:
                    status = json.load(f)
                summary = status.get('summary', {})
                total = summary.get('totalTasks', 0)
                completed = summary.get('completed', 0)
                failed = summary.get('failed', 0)
                pending = summary.get('pending', 0)
                in_progress = summary.get('in_progress', 0)
                current_phase = status.get('currentPhase')
            except:
                pass

        # Check if orchestrator is running
        orchestrator_pid = self._get_orchestrator_pid(plan_name)

        # Check git branch
        branch = self._get_plan_branch(plan_name)
        worktree = self._get_plan_worktree(plan_name)

        return PlanInfo(
            name=plan_name,
            path=str(plan_path),
            status_path=str(status_path) if status_path.exists() else None,
            output_dir=str(output_dir) if output_dir.exists() else None,
            branch=branch,
            worktree=worktree,
            is_active=in_progress > 0 or orchestrator_pid is not None,
            is_current=(str(plan_path) == self.current_plan),
            orchestrator_pid=orchestrator_pid,
            total_tasks=total,
            completed_tasks=completed,
            failed_tasks=failed,
            pending_tasks=pending,
            in_progress_tasks=in_progress,
            current_phase=current_phase
        )

    def _get_orchestrator_pid(self, plan_name: str) -> Optional[int]:
        """Check if an orchestrator is running for this plan."""
        registry_file = self.project_root / ".claude" / "orchestrator-registry.json"
        if not registry_file.exists():
            return None
        try:
            with open(registry_file) as f:
                registry = json.load(f)
            for instance in registry.get('instances', []):
                if instance.get('planName') == plan_name:
                    return instance.get('pid')
        except:
            pass
        return None

    def _get_plan_branch(self, plan_name: str) -> Optional[str]:
        """Get the git branch for this plan."""
        import subprocess
        try:
            result = subprocess.run(
                ['git', 'branch', '-l', f'plan/{plan_name}'],
                capture_output=True, text=True, cwd=self.project_root
            )
            if result.returncode == 0 and result.stdout.strip():
                return f"plan/{plan_name}"
        except:
            pass
        return None

    def _get_plan_worktree(self, plan_name: str) -> Optional[str]:
        """Get the worktree path for this plan."""
        import subprocess
        try:
            result = subprocess.run(
                ['git', 'worktree', 'list', '--porcelain'],
                capture_output=True, text=True, cwd=self.project_root
            )
            if result.returncode == 0:
                for line in result.stdout.split('\n'):
                    if f'plan/{plan_name}' in line:
                        parts = line.split()
                        if parts and parts[0] == 'worktree':
                            return parts[1] if len(parts) > 1 else None
        except:
            pass
        return None

    def get_active_plans(self) -> List[PlanInfo]:
        """Get all plans with active orchestrators."""
        return [p for p in self.plans if p.is_active]

    def get_plan_by_name(self, name: str) -> Optional[PlanInfo]:
        """Get a specific plan by name."""
        return next((p for p in self.plans if p.name == name), None)
```

#### MultiPlanView

```python
class MultiPlanView:
    """Multi-plan view for TUI."""

    def __init__(self, registry: PlanRegistry, config: Optional[Dict] = None):
        self.registry = registry
        self.config = config or {}
        self.expanded = False
        self.view_mode = 'list'  # 'list', 'dashboard', 'compare'
        self.selected_index = 0
        self.compare_index = -1  # For comparison mode

    def refresh(self) -> None:
        """Refresh plan registry."""
        self.registry.refresh()

    def render_selector(self) -> Panel:
        """Render quick plan selector."""
        self.registry.refresh()

        table = Table(show_header=False, box=None, expand=True)
        table.add_column("Select", width=3)
        table.add_column("Plan")
        table.add_column("Progress", width=25)
        table.add_column("Status", width=15)

        for i, plan in enumerate(self.registry.plans[:8]):
            is_selected = i == self.selected_index
            icon = "●" if plan.is_current else "○"
            if is_selected:
                icon = "▶" if plan.is_current else "▷"

            # Progress bar
            progress = self._mini_progress_bar(plan.progress_percent, 20)

            # Status
            status = ""
            if plan.is_complete:
                status = "✓ Complete"
            elif plan.orchestrator_pid:
                status = "● Running"
            elif plan.is_active:
                status = "◐ Active"
            else:
                status = "◯ Idle"

            style = "cyan" if is_selected else "dim" if not plan.is_active else ""

            table.add_row(
                Text(icon, style=style),
                Text(plan.name, style=style),
                Text(f"{progress} {plan.progress_percent:.0f}%", style=style),
                Text(status, style=style)
            )

        # Controls
        table.add_row("", "", "", "")
        table.add_row(
            "",
            Text("[↑/↓] Navigate  [Enter] Switch  [Space] Preview  [Esc] Cancel", style="dim"),
            "", ""
        )

        return Panel(table, title="Plan Selector", border_style="cyan")

    def render_dashboard(self) -> Panel:
        """Render full multi-plan dashboard."""
        self.registry.refresh()

        layout = Layout()
        layout.split(
            Layout(name="overview", size=4),
            Layout(name="plans", ratio=1)
        )

        # Overview section
        layout["overview"].update(self._render_overview())

        # Plans list
        plan_layouts = []
        for i, plan in enumerate(self.registry.plans[:4]):
            plan_layouts.append(Layout(name=f"plan_{i}", ratio=1))

        if plan_layouts:
            plans_layout = Layout()
            plans_layout.split(*plan_layouts)
            for i, plan in enumerate(self.registry.plans[:4]):
                plans_layout[f"plan_{i}"].update(self._render_plan_card(plan, i == self.selected_index))
            layout["plans"].update(plans_layout)

        # Controls
        controls = Text()
        controls.append("[1-9] Focus  ", style="dim cyan")
        controls.append("[Enter] Switch  ", style="dim cyan")
        controls.append("[O] Orchestrate  ", style="dim cyan")
        controls.append("[N] New plan  ", style="dim cyan")
        controls.append("[C] Compare", style="dim cyan")

        content = Table(show_header=False, box=None, expand=True)
        content.add_column()
        content.add_row(layout)
        content.add_row("")
        content.add_row(controls)

        return Panel(content, title="Multi-Plan Dashboard", border_style="cyan")

    def _render_overview(self) -> Panel:
        """Render overview statistics."""
        active = len([p for p in self.registry.plans if p.is_active])
        paused = len([p for p in self.registry.plans if not p.is_active and not p.is_complete])
        completed = len([p for p in self.registry.plans if p.is_complete])
        running_orchestrators = len([p for p in self.registry.plans if p.orchestrator_pid])
        worktrees = len([p for p in self.registry.plans if p.worktree])

        text = Text()
        text.append(f"Active: {active}  │  ", style="green")
        text.append(f"Paused: {paused}  │  ", style="yellow")
        text.append(f"Completed: {completed}  │  ", style="dim")
        text.append(f"Total: {len(self.registry.plans)}  │  ", style="dim")
        text.append(f"Running orchestrators: {running_orchestrators}  │  ", style="cyan")
        text.append(f"Worktrees: {worktrees}", style="dim")

        return Panel(text, title="Overview", border_style="dim")

    def _render_plan_card(self, plan: PlanInfo, selected: bool = False) -> Panel:
        """Render a single plan card."""
        table = Table(show_header=False, box=None, expand=True)
        table.add_column("Key", width=12, style="dim")
        table.add_column("Value")

        # Progress bar
        progress = self._mini_progress_bar(plan.progress_percent, 30)
        table.add_row("Progress:", Text(f"{progress} {plan.progress_percent:.0f}%"))

        # Phase
        phase_text = plan.current_phase or "Unknown"
        table.add_row("Phase:", phase_text[:40])

        # Tasks
        tasks = f"{plan.completed_tasks} ✓  {plan.pending_tasks} ◯  {plan.failed_tasks} ✗"
        table.add_row("Tasks:", tasks)

        # Branch
        branch_status = "✓" if plan.branch else "⚠"
        table.add_row("Branch:", f"{plan.branch or 'none'} {branch_status}")

        # Orchestrator
        if plan.orchestrator_pid:
            table.add_row("Orchestrator:", Text(f"Running (PID {plan.orchestrator_pid})", style="green"))
        else:
            table.add_row("Orchestrator:", Text("Not running", style="dim"))

        title = f"{'●' if plan.is_current else '○'} {plan.name}"
        if plan.is_active:
            title += " (ACTIVE)"

        border_style = "cyan" if selected else "green" if plan.is_active else "dim"

        return Panel(table, title=title, border_style=border_style)

    def _render_compare(self) -> Panel:
        """Render side-by-side comparison."""
        if len(self.registry.plans) < 2:
            return Panel(Text("Need at least 2 plans to compare", style="dim"))

        plan1 = self.registry.plans[self.selected_index]
        plan2 = self.registry.plans[self.compare_index if self.compare_index >= 0 else (self.selected_index + 1) % len(self.registry.plans)]

        layout = Layout()
        layout.split_row(
            Layout(name="left"),
            Layout(name="right")
        )

        layout["left"].update(self._render_plan_detail(plan1, "left"))
        layout["right"].update(self._render_plan_detail(plan2, "right"))

        return Panel(layout, title="Plan Comparison", border_style="cyan")

    def _render_plan_detail(self, plan: PlanInfo, side: str) -> Panel:
        """Render detailed plan info for comparison."""
        table = Table(show_header=False, box=None, expand=True)
        table.add_column("Key", width=15, style="dim")
        table.add_column("Value")

        # Progress
        progress = self._mini_progress_bar(plan.progress_percent, 20)
        table.add_row("Progress:", f"{progress} {plan.progress_percent:.0f}%")

        table.add_row("", "")
        table.add_row("Phase:", f"{plan.current_phase or 'N/A'}")
        table.add_row("Tasks:", f"{plan.completed_tasks}/{plan.total_tasks}")

        # Calculate velocity (placeholder)
        velocity = plan.completed_tasks / max(1, plan.total_tasks) * 10  # Rough estimate
        table.add_row("Velocity:", f"{velocity:.1f} tasks/hr")

        return Panel(table, title=plan.name, border_style="blue")

    def _mini_progress_bar(self, percent: float, width: int = 20) -> str:
        """Create a mini progress bar."""
        filled = int((percent / 100) * width)
        return "█" * filled + "░" * (width - filled)

    def handle_key(self, key: str) -> bool:
        """Handle keyboard input."""
        if key in ('j', 'down'):
            self.selected_index = min(self.selected_index + 1, len(self.registry.plans) - 1)
            return True
        elif key in ('k', 'up'):
            self.selected_index = max(self.selected_index - 1, 0)
            return True
        elif key == 'enter':
            return self._switch_to_selected()
        elif key == 'c':
            self.view_mode = 'compare'
            return True
        elif key == 'escape':
            self.expanded = False
            return True
        return False

    def _switch_to_selected(self) -> bool:
        """Switch to the selected plan."""
        if not self.registry.plans:
            return False
        plan = self.registry.plans[self.selected_index]
        # Write to current-plan.txt
        current_file = Path(self.registry.project_root) / ".claude" / "current-plan.txt"
        current_file.write_text(plan.path)
        self.registry.current_plan = plan.path
        return True

    def toggle(self) -> None:
        """Toggle expanded/collapsed state."""
        self.expanded = not self.expanded
        if self.expanded:
            self.refresh()
```

### 3.2 Keyboard Mappings

| Key | Context | Action |
|-----|---------|--------|
| `Tab` | Global | Open plan selector |
| `Ctrl+P` | Global | Toggle multi-plan dashboard |
| `↑/k` | Selector/Dashboard | Previous plan |
| `↓/j` | Selector/Dashboard | Next plan |
| `Enter` | Plan selected | Switch to plan |
| `Space` | Plan selected | Preview plan details |
| `C` | Dashboard | Compare mode |
| `O` | Plan selected | Start orchestrator |
| `N` | Dashboard | New plan wizard |
| `1-9` | Dashboard | Quick select plan |
| `Esc` | Any | Close/cancel |

---

## 4. Data Contract

### 4.1 Plan Registry Object

```typescript
interface PlanInfo {
  name: string;
  path: string;
  statusPath: string | null;
  outputDir: string | null;

  // Git integration
  branch: string | null;
  worktree: string | null;

  // State
  isActive: boolean;
  isCurrent: boolean;
  isComplete: boolean;
  orchestratorPid: number | null;

  // Progress
  totalTasks: number;
  completedTasks: number;
  failedTasks: number;
  pendingTasks: number;
  inProgressTasks: number;
  currentPhase: string | null;
  progressPercent: number;

  // Metrics
  velocity?: number;  // tasks per hour
  estimatedCompletion?: string;
}

interface PlanRegistry {
  plans: PlanInfo[];
  currentPlan: string | null;
  activeCount: number;
  completedCount: number;
  runningOrchestrators: number;
}
```

### 4.2 Orchestrator Registry Object

```typescript
interface OrchestratorInstance {
  planName: string;
  planPath: string;
  pid: number;
  startedAt: string;
  worktreePath?: string;
  batchSize: number;
  iteration: number;
  maxIterations: number;
  state: 'running' | 'paused' | 'stuck';
}

interface OrchestratorRegistry {
  instances: OrchestratorInstance[];
  lastUpdated: string;
}
```

---

## 5. Effort Estimate

### 5.1 Implementation Breakdown

| Component | Effort | Priority |
|-----------|--------|----------|
| PlanRegistry class | 6 hours | P0 |
| Plan scanning and status loading | 4 hours | P0 |
| MultiPlanView class | 6 hours | P0 |
| Plan selector popup | 4 hours | P0 |
| Dashboard view | 6 hours | P0 |
| Plan cards | 3 hours | P0 |
| Plan switching | 2 hours | P0 |
| Keyboard handling | 2 hours | P0 |
| **Subtotal Core:** | **33 hours** | - |
| Comparison view | 4 hours | P1 |
| Resource allocation panel | 6 hours | P2 |
| Cross-plan dependencies | 8 hours | P3 |
| Worktree integration | 6 hours | P2 |
| **Subtotal Enhanced:** | **24 hours** | - |
| **Total:** | **57 hours** | - |

### 5.2 Recommended Implementation

**MVP (Core):** 33 hours
- Plan registry with status scanning
- Plan selector dropdown
- Dashboard with plan cards
- Plan switching
- Basic progress display

**Full Feature:** 57 hours
- All MVP features
- Side-by-side comparison
- Resource allocation visualization
- Cross-plan dependency graph
- Worktree integration

---

## 6. Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Many plans = slow scan | MEDIUM | LOW | Cache, incremental updates |
| Status file conflicts | LOW | MEDIUM | Read-only, separate files |
| Confusing plan switching | MEDIUM | MEDIUM | Clear current indicator |
| Worktree complexity | HIGH | MEDIUM | Defer until phase 5 complete |

---

## 7. Success Criteria

### 7.1 Functional Requirements

- [ ] Shows all plans with progress
- [ ] Identifies current/active plans
- [ ] Switch between plans
- [ ] Shows orchestrator status per plan
- [ ] Shows git branch status per plan
- [ ] Keyboard navigation

### 7.2 Quality Requirements

- [ ] Scans 20+ plans in <500ms
- [ ] Responsive UI
- [ ] Clear visual hierarchy
- [ ] Works without orchestrator running

### 7.3 Integration Requirements

- [ ] Uses existing status.json format
- [ ] Uses existing --plan argument
- [ ] Integrates with orchestrator registry
- [ ] Prepares for worktree integration

---

## 8. Related Documents

- Task 6.1: --plan argument implementation
- Task 6.4: Multi-session orchestration
- Task 6.5: Multi-plan TUI mapping
- Task 10.4: Orchestrator Control Panel
- git-workflow-phase5-worktrees.md: Worktree integration plan

---

**End of Design**
