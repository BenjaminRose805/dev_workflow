# Task 11.3: Identify Integration Points with Existing TUI Plan

**Date:** 2025-12-26
**Purpose:** Map expansions to tui-integration-implementation.md phases
**Decision Criteria:** AMEND vs NEW PLAN

---

## Executive Summary

This analysis maps each expansion to the existing TUI integration plan and makes a recommendation on whether to **AMEND** the existing plan, create a **NEW PLAN**, or use a **HYBRID** approach.

**Recommendation: HYBRID Approach**
- **AMEND** existing plan for quick wins and 3 compatible panels
- **NEW PLAN** for infrastructure-heavy architectural features

---

## 1. Existing TUI Plan Overview

### 1.1 Current Plan Structure

**File:** `docs/plans/tui-integration-implementation.md`
**Status:** 24 pending tasks (0% complete)

| Phase | Name | Tasks | Focus |
|-------|------|-------|-------|
| 1 | Keyboard Foundation | 4 | KeyboardHandler, navigation, help |
| 2 | Quick Win Panels | 6 | Phase progress, upcoming, retry, blockers |
| 3 | Command Integration | 4 | Command palette, task picker, actions |
| 4 | Advanced Visualization | 5 | Dependency graph, agents, subtasks |
| 5 | Polish and Enhancement | 5 | Search, responsive, config, focus |

**Total:** 24 tasks, ~4-6 weeks estimated

### 1.2 Current Plan Gaps (from Analysis)

The existing plan does NOT include:
- Git status/branch integration
- Parallel/sequential constraint visualization
- Orchestrator control (pause/resume/retry)
- Multi-plan management
- Real-time event streaming
- Batch composition visualization

---

## 2. Integration Point Analysis

### 2.1 Phase-by-Phase Mapping

#### Phase 1: Keyboard Foundation

| Expansion | Integration Potential | Conflicts |
|-----------|----------------------|-----------|
| Git Status Panel | Add `g` key for git toggle | None |
| Constraint Panel | Add `c` key for constraints | None |
| Batch Panel | Add `b` key for batch | None |
| Control Panel | Add `Ctrl+O` for orchestrator | None |
| Event Stream | Add `Ctrl+E` for events | None |

**Assessment:** Easy integration - just add new keys to KeyboardHandler

#### Phase 2: Quick Win Panels

| Expansion | Integration Potential | Conflicts |
|-----------|----------------------|-----------|
| Quick Win Bundle 1 | Enhances 2.4 Inline Blockers | Overlaps |
| Quick Win Bundle 3 | Enhances 2.3 Retry History | Overlaps |
| Git Quick Wins | New - not in phase | Addition |

**Assessment:**
- Bundles 1 & 3 should AMEND tasks 2.3-2.4
- Git quick wins should ADD new task 2.7

#### Phase 3: Command Integration

| Expansion | Integration Potential | Conflicts |
|-----------|----------------------|-----------|
| Orchestrator Control | Task actions overlap with 3.3 | Enhances |
| Batch Panel | Size adjustment is new command | Addition |

**Assessment:**
- Control panel actions could extend 3.3 Task Action Keys
- Batch size is a new command for command palette

#### Phase 4: Advanced Visualization

| Expansion | Integration Potential | Conflicts |
|-----------|----------------------|-----------|
| Task Constraint Panel | Extends 4.1 Dependency Graph | Overlaps |
| Parallel Dashboard | Extends 4.2 Agent Tracking | Overlaps |
| Batch Execution Panel | New visualization | Addition |

**Assessment:**
- Constraint and Parallel panels can AMEND Phase 4
- Batch panel is new addition to Phase 4

#### Phase 5: Polish and Enhancement

| Expansion | Integration Potential | Conflicts |
|-----------|----------------------|-----------|
| Git Status Panel | Could be 5.x responsive feature | Addition |
| Multi-Plan View | New major feature | Separate |
| Event Stream | New major feature | Separate |
| Orchestrator Control | New major feature | Separate |

**Assessment:**
- Simple Git panel could fit in Phase 5
- Complex panels need separate phase or plan

---

## 3. Decision Matrix

### 3.1 AMEND Criteria (from plan)

**AMEND if ALL of:**
- ≤15 new tasks
- ≤2 new phases
- No architectural changes (no new infrastructure)

### 3.2 NEW PLAN Criteria (from plan)

**NEW PLAN if ANY of:**
- >15 new tasks
- >2 new phases
- Requires new infrastructure (IPC, EventBus)

### 3.3 Expansion Classification

| Expansion | New Tasks | New Phase? | Infrastructure? | **Decision** |
|-----------|-----------|------------|-----------------|--------------|
| Quick Wins Bundle 1-3 | 0 (enhance) | No | No | **AMEND** |
| Git Status Panel | 3-4 | No | No | **AMEND** |
| Task Constraint Panel | 4-5 | No | No | **AMEND** |
| Batch Execution Panel | 3-4 | No | No | **AMEND** |
| **Subtotal AMEND** | **10-13** | **0** | **No** | ✓ Eligible |
| Parallel Dashboard | 5-6 | Borderline | No | **AMEND/NEW** |
| Orchestrator Control | 8-10 | Yes | IPC | **NEW PLAN** |
| Event Stream | 6-8 | Yes | EventBus | **NEW PLAN** |
| Multi-Plan View | 8-10 | Yes | Registry | **NEW PLAN** |
| **Subtotal NEW** | **27-34** | **3** | **Yes** | ✓ NEW PLAN |

---

## 4. Recommended Integration

### 4.1 AMEND: tui-integration-implementation.md

Add these to existing plan:

**Phase 2 Amendments:**

```markdown
- [ ] 2.7 Implement Git Quick Wins in `scripts/lib/tui.py`
  - [ ] 2.7.1 Add branch badge to header
  - [ ] 2.7.2 Add branch validation icon
  - [ ] 2.7.3 Add uncommitted count to footer
```

**Phase 2 Task 2.3 Enhancement:**

```markdown
- [ ] 2.3 Implement Retry History Indicator (Gap G3) in `scripts/lib/tui.py`
  - [ ] 2.3.1 Read `retryCount` from task objects
  - [ ] 2.3.2 Display `[Retry N/3]` suffix for retried tasks
  - [ ] 2.3.3 Color-code based on retry count
  - [ ] 2.3.4 Show last error message on selection
  + [ ] 2.3.5 Add orchestrator state badge to header
  + [ ] 2.3.6 Add iteration count to header
```

**Phase 2 Task 2.4 Enhancement:**

```markdown
- [ ] 2.4 Implement Inline Blockers Display (Gap B1 partial)
  - [ ] 2.4.1 Query for blockers
  - [ ] 2.4.2 Display `[Blocked by: X.Y]` indicator
  - [ ] 2.4.3 Dim tasks that cannot start
  + [ ] 2.4.4 Add sequential chain icon (⛓) to sequential tasks
  + [ ] 2.4.5 Add conflict badge (⚠) to conflicting tasks
  + [ ] 2.4.6 Show sequential group range [3.1-3.4]
```

**Phase 4 New Tasks:**

```markdown
- [ ] 4.6 Implement Task Constraint Panel in `scripts/tui/panels.py`
  - [ ] 4.6.1 Create `TaskConstraintPanel` class
  - [ ] 4.6.2 Load constraint data from cmdNext()
  - [ ] 4.6.3 Render constraint summary view
  - [ ] 4.6.4 Render expanded constraint cards
  - [ ] 4.6.5 Add keyboard handling (c to toggle)

- [ ] 4.7 Implement Batch Execution Panel in `scripts/tui/panels.py`
  - [ ] 4.7.1 Create `BatchExecutionPanel` class
  - [ ] 4.7.2 Load current batch from status.json
  - [ ] 4.7.3 Render batch composition view
  - [ ] 4.7.4 Render "Why this batch?" explainer
  - [ ] 4.7.5 Add keyboard handling (b to toggle)
```

**Phase 5 New Tasks:**

```markdown
- [ ] 5.6 Implement Git Status Panel in `scripts/tui/panels.py`
  - [ ] 5.6.1 Create `GitStatusPanel` class
  - [ ] 5.6.2 Implement collapsed single-line view
  - [ ] 5.6.3 Implement expanded detailed view
  - [ ] 5.6.4 Add keyboard handling (g to toggle)
```

### 4.2 NEW PLAN: tui-workflow-expansion.md

Create new plan for architectural features:

```markdown
# Implementation Plan: TUI Workflow Expansion

## Overview
- **Objective:** Add orchestrator control, event streaming, and multi-plan support to TUI
- **Prerequisites:** tui-integration-implementation.md (Phase 1-4)
- **Created:** 2025-12-26

## Phase 1: IPC Infrastructure

- [ ] 1.1 Design IPC Protocol
  - [ ] 1.1.1 Define command/response format
  - [ ] 1.1.2 Implement file-based IPC client
  - [ ] 1.1.3 Add IPC handlers to orchestrator

- [ ] 1.2 Implement IPCClient class
  - [ ] 1.2.1 Create IPCClient with timeout
  - [ ] 1.2.2 Implement send/receive
  - [ ] 1.2.3 Add connection health check

## Phase 2: Orchestrator Control Panel

- [ ] 2.1 Create OrchestratorControlPanel class
- [ ] 2.2 Implement collapsed control bar
- [ ] 2.3 Implement execution state section
- [ ] 2.4 Implement batch size control
- [ ] 2.5 Implement failed task actions
- [ ] 2.6 Implement stuck detection section
- [ ] 2.7 Add keyboard handling

## Phase 3: Event Bus Infrastructure

- [ ] 3.1 Create EventBus class
- [ ] 3.2 Define event types enum
- [ ] 3.3 Integrate event emission in orchestrator
- [ ] 3.4 Add event history storage

## Phase 4: Real-time Event Stream Panel

- [ ] 4.1 Create EventStreamPanel class
- [ ] 4.2 Implement collapsed stream view
- [ ] 4.3 Implement expanded view with cards
- [ ] 4.4 Implement filter bar
- [ ] 4.5 Add keyboard handling

## Phase 5: Parallel Execution Dashboard

- [ ] 5.1 Create ParallelExecutionDashboard class
- [ ] 5.2 Implement active sessions section
- [ ] 5.3 Implement constraints section
- [ ] 5.4 Implement commit queue section
- [ ] 5.5 Add keyboard handling

## Phase 6: Multi-Plan View

- [ ] 6.1 Create PlanRegistry class
- [ ] 6.2 Create MultiPlanView class
- [ ] 6.3 Implement plan selector
- [ ] 6.4 Implement dashboard view
- [ ] 6.5 Implement comparison view
- [ ] 6.6 Add keyboard handling
```

---

## 5. Task Count Summary

### 5.1 AMEND Summary

| Location | New Tasks | Effort |
|----------|-----------|--------|
| Phase 2.3 enhancement | +2 subtasks | +2 hrs |
| Phase 2.4 enhancement | +3 subtasks | +3 hrs |
| Phase 2.7 (new) | +3 subtasks | +5 hrs |
| Phase 4.6 (new) | +5 subtasks | +16 hrs |
| Phase 4.7 (new) | +5 subtasks | +16 hrs |
| Phase 5.6 (new) | +4 subtasks | +12 hrs |
| **AMEND Total** | **+22 subtasks** | **+54 hrs** |

Adds 3 new top-level tasks (4.6, 4.7, 5.6) and ~10 subtasks to existing tasks.

### 5.2 NEW PLAN Summary

| Phase | Tasks | Effort |
|-------|-------|--------|
| Phase 1: IPC Infrastructure | 6 | 16 hrs |
| Phase 2: Orchestrator Control | 7 | 36 hrs |
| Phase 3: Event Bus Infrastructure | 4 | 12 hrs |
| Phase 4: Event Stream | 5 | 34 hrs |
| Phase 5: Parallel Dashboard | 5 | 20 hrs |
| Phase 6: Multi-Plan View | 6 | 33 hrs |
| **NEW PLAN Total** | **33 tasks** | **~151 hrs** |

---

## 6. Integration Visualization

### 6.1 Current vs Expanded Structure

```
EXISTING PLAN (24 tasks)              AFTER AMENDMENTS (+13 tasks = 37 tasks)
═══════════════════════               ═══════════════════════════════════════
Phase 1: Keyboard (4)          →      Phase 1: Keyboard (4)        [unchanged]
Phase 2: Quick Win (6)         →      Phase 2: Quick Win (7)       [+1 task, +5 subtasks]
Phase 3: Command (4)           →      Phase 3: Command (4)         [unchanged]
Phase 4: Advanced (5)          →      Phase 4: Advanced (7)        [+2 tasks]
Phase 5: Polish (5)            →      Phase 5: Polish (6)          [+1 task]


NEW PLAN (33 tasks)
═══════════════════════════════════════
Phase 1: IPC Infrastructure (6)
Phase 2: Orchestrator Control (7)
Phase 3: Event Bus (4)
Phase 4: Event Stream (5)
Phase 5: Parallel Dashboard (5)
Phase 6: Multi-Plan View (6)
```

### 6.2 Timeline Visualization

```
Week:    1    2    3    4    5    6    7    8    9    10   11   12
         ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤

AMENDED TUI PLAN:
Phase 1  [====]
Phase 2       [========]  (includes quick wins + git)
Phase 3            [======]
Phase 4                 [==========]  (includes constraint + batch panels)
Phase 5                         [======]  (includes git panel)

NEW WORKFLOW EXPANSION PLAN:
Phase 1                               [====]
Phase 2                                    [==========]
Phase 3                                              [===]
Phase 4                                                  [========]
Phase 5                                                          [====]
Phase 6                                                               [====]
```

---

## 7. Risk Analysis

### 7.1 AMEND Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Scope creep | MEDIUM | MEDIUM | Strict task boundaries |
| Phase 4 overload | LOW | MEDIUM | Sequential execution |
| Keyboard conflicts | LOW | LOW | Document key mappings |

### 7.2 NEW PLAN Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| IPC complexity | HIGH | HIGH | Start with file-based IPC |
| Dependency on TUI plan | MEDIUM | HIGH | Explicit prerequisites |
| Long timeline | MEDIUM | MEDIUM | Phased delivery |

---

## 8. Recommendations

### 8.1 Immediate Actions

1. **Create tui-workflow-expansion.md** plan for architectural features
2. **Amend tui-integration-implementation.md** with:
   - New task 2.7 (Git Quick Wins)
   - Enhanced tasks 2.3 and 2.4 (orchestrator + constraint badges)
   - New tasks 4.6 and 4.7 (Constraint + Batch panels)
   - New task 5.6 (Git Status Panel)

### 8.2 Execution Order

1. Start amended TUI plan (includes quick wins)
2. Complete Phases 1-3 of amended plan
3. Start NEW workflow expansion plan (IPC infrastructure)
4. Complete Phase 4 of amended plan (panels)
5. Continue workflow expansion plan in parallel
6. Complete Phase 5 of amended plan
7. Complete remaining workflow expansion phases

### 8.3 Success Criteria for Integration

- [ ] Amended plan has ≤15 new top-level tasks (we have 3) ✓
- [ ] Amended plan has no new phases ✓
- [ ] Amended plan has no infrastructure changes ✓
- [ ] New plan prerequisites clearly stated
- [ ] Keyboard mappings documented across both plans
- [ ] No file conflicts between plans

---

**End of Integration Analysis**
