# Task 8.5: Orchestrator Features to TUI Control Mapping

**Date:** 2025-12-26
**Source:** Synthesis of tasks 8.1-8.4 analysis
**Purpose:** Map all orchestrator features to concrete TUI control opportunities

---

## Executive Summary

This document maps **28 orchestrator features** to TUI control surfaces. Features are categorized by interaction type: Display (read-only), Control (user action), and Configuration (settings). Implementation priorities are based on user value and effort.

---

## Feature-to-TUI Mapping Matrix

### A. Execution Control Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| Pause execution | None | `P` key → pause modal | P1 |
| Resume execution | None | `R` key → resume button | P1 |
| Stop/shutdown | None | `Q` key → confirmation modal | P1 |
| Skip current task | None | `S` key → skip with reason | P1 |
| Abort current task | None | `A` key → force fail | P2 |
| Force retry | None | `Ctrl+R` → reset task | P2 |
| Adjust batch size | None | `+`/`-` keys → slider | P3 |
| Adjust timeout | None | Settings panel | P3 |

### B. Task Selection Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| View next tasks | In Progress panel | Upcoming panel with preview | P1 |
| Select specific task | None | `Enter` on task → action menu | P1 |
| Skip to specific task | None | `:goto <id>` command | P2 |
| Reorder pending tasks | None | Drag/drop or `↑`/`↓` with modifier | P3 |
| View task dependencies | None | `D` key → dependency modal | P2 |
| Filter tasks by phase | None | Tab to switch phase view | P2 |

### C. Progress Monitoring Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| Overall progress | Progress bar | Already implemented | DONE |
| Phase progress | None | Phase mini-bars panel | P1 |
| Task durations | Partial | Duration column with sparklines | P2 |
| Iteration count | Header | Already implemented | DONE |
| Elapsed time | Progress row | Already implemented | DONE |
| Estimated completion | None | ETA based on velocity | P2 |

### D. Error & Recovery Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| Stuck task detection | Status message | Stuck warning panel | P1 |
| Retry tracking | None | Retry badge on tasks | P1 |
| Error messages | None | Error detail modal (`E` key) | P1 |
| Exhausted task list | None | Failures panel | P2 |
| Manual intervention | None | Intervention modal | P1 |
| Extend stuck threshold | None | `X` key on stuck task | P2 |

### E. Constraint Visualization Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| Sequential groups | None | Chain visualization | P1 |
| File conflicts | None | Conflict badges | P1 |
| Dependency blocking | None | "Blocked by X" indicator | P1 |
| Constraint overrides | None | Override modal | P3 |
| Batch composition | None | "Why grouped" tooltip | P2 |

### F. Multi-Orchestrator Features

| Orchestrator Feature | Current TUI | Proposed TUI Control | Priority |
|---------------------|-------------|----------------------|----------|
| Instance registry | None | Multi-plan dashboard | P2 |
| IPC status query | None | Remote status panel | P3 |
| Cross-plan progress | None | Plan switcher | P2 |
| Worktree context | None | Worktree indicator | P2 |
| Daemon status | None | Background job list | P3 |

---

## Detailed Control Specifications

### Control 1: Pause/Resume/Stop Modal

**Trigger:** `P` key (pause), `Q` key (quit)

**Modal Design:**
```
┌─ Execution Control ─────────────────────────────┐
│                                                  │
│   Current State: RUNNING                         │
│   Iteration: 12/50                               │
│   Active Tasks: 3.2, 4.1                         │
│                                                  │
│   [P] Pause after current task                   │
│   [S] Stop immediately (graceful)                │
│   [F] Force stop (may lose progress)             │
│   [Esc] Cancel                                   │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Implementation:**
- Uses IPC to send pause/shutdown commands
- Shows confirmation before destructive actions
- Displays active tasks that would be interrupted

---

### Control 2: Task Action Menu

**Trigger:** `Enter` key on selected task

**Menu Design:**
```
┌─ Task 3.2: Merge documentation ─────────────────┐
│                                                  │
│   Status: in_progress (18:45 elapsed)            │
│   Phase: 3 - Documentation                       │
│   Dependencies: 3.1 ✓                            │
│                                                  │
│   [E] Explain task                               │
│   [I] Implement task                             │
│   [V] Verify task                                │
│   [S] Skip task                                  │
│   [F] View findings                              │
│   [D] Show dependencies                          │
│   [X] Extend stuck threshold                     │
│   [Esc] Close                                    │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Actions:**
- `E/I/V` → Spawn `/plan:explain|implement|verify` command
- `S` → Mark task skipped with reason prompt
- `F` → Open findings browser modal
- `D` → Show dependency graph for this task

---

### Control 3: Stuck Detection Panel

**Display:** Always visible when stuck/approaching threshold

**Panel Design:**
```
┌─ ⚠ Stuck Detection ─────────────────────────────┐
│                                                  │
│  Task 3.2: Merge docs          28:45 / 30:00   │
│  ├─ Last activity: 5 min ago                    │
│  ├─ Claude status: idle                         │
│  └─ [E]xtend [S]kip [R]etry [?]Details          │
│                                                  │
│  Task 4.1: Create redirects    15:23 / 30:00   │
│  └─ Status: Active ✓                            │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Features:**
- Countdown timer per task
- Activity heartbeat indicator
- One-key intervention controls

---

### Control 4: Constraint Visualization Panel

**Display:** Shows why tasks are grouped/held back

**Panel Design:**
```
┌─ Execution Constraints ─────────────────────────┐
│                                                  │
│  Sequential Chain: [3.1] → [3.2] → [3.3] → [3.4]│
│  └─ Reason: All modify orchestrator-system.md   │
│                                                  │
│  Held Back:                                      │
│  ├─ 3.3: Waiting for 3.2                        │
│  └─ 3.4: Waiting for 3.3                        │
│                                                  │
│  File Conflicts:                                 │
│  └─ tui.py: 2.1, 2.3, 2.5 (sequential)          │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Features:**
- Visual chain with arrows
- Reason explanations
- "Held back" indicator

---

### Control 5: Batch Size Adjustment

**Trigger:** `+`/`-` keys or settings modal

**Inline Control:**
```
Batch Size: [<<] 3 [>>]   (Current: 5 max)
```

**Implementation:**
- Immediate effect on next iteration
- Persisted to config file
- Shown in header area

---

### Control 6: Multi-Plan Dashboard

**Trigger:** `Tab` or `:plans` command

**Dashboard Design:**
```
┌─ Active Plans ──────────────────────────────────┐
│                                                  │
│  ● tui-expansion-analysis                        │
│    [████████████░░░░] 61%  Phase 8               │
│    Branch: plan/tui-expansion-analysis           │
│                                                  │
│  ○ git-workflow-phase5 (paused)                  │
│    [██░░░░░░░░░░░░░░] 12%  Phase 1               │
│    Branch: plan/git-workflow-phase5              │
│                                                  │
│  [1-9] Switch plan  [N] New plan  [Q] Close      │
│                                                  │
└──────────────────────────────────────────────────┘
```

---

## Keyboard Mapping Summary

### Global Keys (Always Active)

| Key | Action |
|-----|--------|
| `?` | Show help overlay |
| `P` | Pause execution |
| `Q` | Quit/stop modal |
| `Tab` | Switch panel focus |
| `Esc` | Close modal/cancel |

### Navigation Keys

| Key | Action |
|-----|--------|
| `j`/`↓` | Move cursor down |
| `k`/`↑` | Move cursor up |
| `h`/`←` | Collapse tree/left |
| `l`/`→` | Expand tree/right |
| `g` | Go to top |
| `G` | Go to bottom |
| `/` | Search tasks |
| `n` | Next search match |

### Task Action Keys

| Key | Action |
|-----|--------|
| `Enter` | Open task action menu |
| `e` | Explain selected task |
| `i` | Implement selected task |
| `v` | Verify selected task |
| `s` | Skip selected task |
| `f` | View findings |
| `d` | Show dependencies |

### Execution Control Keys

| Key | Action |
|-----|--------|
| `r` | Retry failed task |
| `x` | Extend stuck threshold |
| `+` | Increase batch size |
| `-` | Decrease batch size |
| `R` | Force refresh |

### Panel Toggle Keys

| Key | Action |
|-----|--------|
| `1` | Toggle progress panel |
| `2` | Toggle activity panel |
| `3` | Toggle tasks panel |
| `4` | Toggle constraints panel |
| `5` | Toggle stuck panel |
| `F` | Focus mode (maximize current) |

---

## Implementation Priority Matrix

### P1: Critical Controls (High Value, Low-Medium Effort)

1. **Pause/Resume/Stop** - Essential orchestrator control
2. **Stuck task intervention** - Prevents wasted time
3. **Task action menu** - Enables task-level control
4. **Sequential constraint display** - Explains execution order
5. **Retry badge on tasks** - Shows recovery state
6. **Error detail modal** - Explains failures

### P2: Important Enhancements (Medium Value, Medium Effort)

7. **Phase progress mini-bars** - Better phase visibility
8. **Dependency visualization** - Shows blocking relationships
9. **Multi-plan dashboard** - Supports parallel plans
10. **ETA calculation** - Progress prediction
11. **Batch composition tooltip** - Explains grouping

### P3: Nice-to-Have Features (Lower Priority)

12. **Batch size adjustment** - Runtime tuning
13. **Constraint overrides** - Power user feature
14. **Task reordering** - Manual priority
15. **Daemon status** - Background management

---

## Data Requirements for Controls

### From status.json

| Data | Used By |
|------|---------|
| `tasks[].status` | All task displays |
| `tasks[].startedAt` | Stuck detection |
| `tasks[].retryCount` | Retry badges |
| `tasks[].lastError` | Error modals |
| `summary.*` | Progress displays |
| `currentPhase` | Phase indicators |

### From status-cli.js

| Command | Used By |
|---------|---------|
| `next` | Upcoming tasks panel |
| `phases` | Phase mini-bars |
| `deps` | Dependency visualization |
| `conflicts` | Conflict badges |
| `detect-stuck` | Stuck panel |
| `retryable` | Retry availability |

### From Orchestrator IPC

| Command | Used By |
|---------|---------|
| `status` | Multi-plan dashboard |
| `pause` | Pause control |
| `resume` | Resume control |
| `shutdown` | Stop control |

---

## Related Documents

- `8.2-orchestration-gap-analysis-review.md` - Gap analysis
- `8.3-orchestrator-events-for-tui.md` - Event streaming
- `8.4-stuck-detection-recovery-analysis.md` - Stuck handling
- `tui-integration-implementation.md` - Current TUI plan

---

**End of Analysis**
