# Task 11.4: Expansion Implementation Roadmap

**Date:** 2025-12-26
**Purpose:** Create comprehensive roadmap for TUI expansion implementation
**Inputs:** Tasks 11.1-11.3 (priority, quick wins, integration points)

---

## Executive Summary

This roadmap defines a 12-week implementation plan to expand the TUI with orchestrator visualization, control, and monitoring capabilities. The approach uses a HYBRID strategy: amending the existing TUI plan for compatible features and creating a new plan for architectural additions.

**Key Deliverables:**
- 19 quick win features (36 hours)
- 3 new panels in existing TUI plan (54 hours)
- 6-phase new workflow expansion plan (151 hours)

**Total Effort:** ~241 hours (~6-8 weeks full-time equivalent)

---

## 1. Roadmap Overview

### 1.1 High-Level Timeline

```
PHASE 1: QUICK WINS           ┃ Week 1-2   ┃ 36 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Bundle 1: Constraints        ┃    ████    ┃ 7 hrs
  Bundle 2: Git                ┃    ████    ┃ 6 hrs
  Bundle 3: Orchestrator       ┃    ████    ┃ 6 hrs
  Bundle 4: Extended           ┃    ██████  ┃ 14 hrs
  Testing & Polish             ┃      ██    ┃ 3 hrs

PHASE 2: CORE PANELS          ┃ Week 3-5   ┃ 54 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Task Constraint Panel        ┃    ████    ┃ 16 hrs
  Batch Execution Panel        ┃      ████  ┃ 16 hrs
  Git Status Panel             ┃        ████┃ 12 hrs
  Integration Testing          ┃          ██┃ 10 hrs

PHASE 3: IPC INFRASTRUCTURE   ┃ Week 6-7   ┃ 28 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Protocol Design              ┃    ██      ┃ 4 hrs
  IPC Client                   ┃    ██      ┃ 4 hrs
  Orchestrator IPC Handlers    ┃      ████  ┃ 8 hrs
  Testing                      ┃        ████┃ 12 hrs

PHASE 4: ORCHESTRATOR CONTROL ┃ Week 8-9   ┃ 46 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Control Panel Class          ┃    ████    ┃ 6 hrs
  State Section                ┃    ██      ┃ 4 hrs
  Batch Size Control           ┃      ██    ┃ 4 hrs
  Failed Task Actions          ┃      ████  ┃ 6 hrs
  Stuck Detection              ┃        ████┃ 6 hrs
  Integration                  ┃          ██████ ┃ 20 hrs

PHASE 5: EVENT INFRASTRUCTURE ┃ Week 10    ┃ 16 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  EventBus Class               ┃    ████    ┃ 4 hrs
  Event Types                  ┃    ██      ┃ 2 hrs
  Emission Integration         ┃      ████  ┃ 8 hrs
  Testing                      ┃        ██  ┃ 2 hrs

PHASE 6: EVENT STREAM PANEL   ┃ Week 11    ┃ 34 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Panel Class                  ┃    ████    ┃ 6 hrs
  Collapsed View               ┃    ██      ┃ 3 hrs
  Expanded View                ┃      ████  ┃ 4 hrs
  Event Cards                  ┃        ████┃ 4 hrs
  Filter & Keyboard            ┃          ██┃ 3 hrs
  Integration                  ┃            ████ ┃ 14 hrs

PHASE 7: ADVANCED FEATURES    ┃ Week 12+   ┃ 57 hours
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃            ┃
  Parallel Dashboard           ┃    ████████┃ 20 hrs
  Multi-Plan View              ┃            ████████████ ┃ 33 hrs
  Final Integration            ┃                    ████ ┃ 4 hrs
```

### 1.2 Milestone Summary

| Milestone | Week | Deliverable |
|-----------|------|-------------|
| M1: Quick Wins Complete | Week 2 | 19 visual enhancements deployed |
| M2: Core Panels Complete | Week 5 | 3 new panels in TUI |
| M3: IPC Ready | Week 7 | Orchestrator controllable from TUI |
| M4: Full Control | Week 9 | Pause/resume/retry from TUI |
| M5: Event Visibility | Week 11 | Real-time event stream |
| M6: Full Expansion | Week 12+ | All 7 panels operational |

---

## 2. Phase 1: Quick Wins (Weeks 1-2)

### 2.1 Objectives

- Deliver immediate visual improvements
- Lay groundwork for larger panels
- Validate data sources and rendering

### 2.2 Task Breakdown

#### Week 1, Day 1-2: Bundle 1 - Constraint Visibility

| Task | Effort | File |
|------|--------|------|
| P1: Sequential chain icon (⛓) | 1 hr | `scripts/lib/tui.py` |
| P4: Conflict badge (⚠) | 1 hr | `scripts/lib/tui.py` |
| P5: Conflict count | 1 hr | `scripts/lib/tui.py` |
| P2: Sequential group suffix | 2 hrs | `scripts/lib/tui.py` |
| P6: Extend blocker display | 2 hrs | `scripts/lib/tui.py` |

#### Week 1, Day 2-3: Bundle 2 - Git Visibility

| Task | Effort | File |
|------|--------|------|
| G1: Branch badge | 2 hrs | `scripts/lib/tui.py` |
| G2: Branch validation icon | 1 hr | `scripts/lib/tui.py` |
| G3: Uncommitted count | 2 hrs | `scripts/lib/tui.py` |
| G5: Commits ahead | 1 hr | `scripts/lib/tui.py` |

#### Week 1, Day 4-5: Bundle 3 - Orchestrator Visibility

| Task | Effort | File |
|------|--------|------|
| O3: Orchestrator state badge | 2 hrs | `scripts/lib/tui.py` |
| O1: Retry badge | 2 hrs | `scripts/lib/tui.py` |
| O2: Iteration count | 1 hr | `scripts/lib/tui.py` |
| O7: Error badge | 1 hr | `scripts/lib/tui.py` |

#### Week 2: Bundle 4 - Extended Features

| Task | Effort | File |
|------|--------|------|
| G4: Last commit display | 2 hrs | `scripts/lib/tui.py` |
| P3: Parallel phase badge | 1 hr | `scripts/lib/tui.py` |
| O4: Task action keys hint | 3 hrs | `scripts/lib/tui.py` |
| O5: Activity heartbeat | 2 hrs | `scripts/lib/tui.py` |
| P7: Critical path highlight | 3 hrs | `scripts/lib/tui.py` |
| O6: Stuck countdown | 3 hrs | `scripts/lib/tui.py` |

### 2.3 Verification

- [ ] All 19 quick wins visible in TUI
- [ ] No performance degradation (refresh <100ms)
- [ ] Data refreshes correctly
- [ ] Icons/badges consistent with style guide

---

## 3. Phase 2: Core Panels (Weeks 3-5)

### 3.1 Objectives

- Implement 3 foundational panels
- Integrate with existing TUI layout
- Establish panel patterns for later phases

### 3.2 Task Breakdown

#### Week 3: Task Constraint Panel

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `TaskConstraintPanel` class | 4 hrs | Bundle 1 complete |
| Implement data loading from cmdNext() | 2 hrs | None |
| Render constraint summary view | 3 hrs | None |
| Render expanded constraint cards | 3 hrs | None |
| Add keyboard handling (c key) | 2 hrs | Phase 1 keyboard |
| Layout integration | 2 hrs | TUI layout |

**Total:** 16 hours

#### Week 4: Batch Execution Panel

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `BatchExecutionPanel` class | 4 hrs | None |
| Implement collapsed single-line view | 2 hrs | None |
| Implement current batch section | 3 hrs | status.json |
| Implement "Why This Batch?" explainer | 3 hrs | cmdNext() |
| Add batch size control | 2 hrs | None |
| Add keyboard handling (b key) | 2 hrs | Phase 1 keyboard |

**Total:** 16 hours

#### Week 5: Git Status Panel

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `GitStatusPanel` class | 3 hrs | Bundle 2 complete |
| Implement collapsed single-line view | 2 hrs | None |
| Implement expanded multi-section view | 4 hrs | None |
| Add keyboard handling (g key) | 2 hrs | Phase 1 keyboard |
| Integration testing | 1 hr | All panels |

**Total:** 12 hours + 10 hours integration testing

### 3.3 Verification

- [ ] All 3 panels render correctly
- [ ] Panels toggle with keyboard shortcuts
- [ ] Data updates in real-time
- [ ] Layout adapts to terminal size
- [ ] No conflicts between panels

---

## 4. Phase 3: IPC Infrastructure (Weeks 6-7)

### 4.1 Objectives

- Establish bidirectional communication with orchestrator
- Enable runtime control of orchestrator
- Prepare for Orchestrator Control Panel

### 4.2 Task Breakdown

#### Week 6: Protocol Design and Client

| Task | Effort | Dependencies |
|------|--------|--------------|
| Design IPC protocol (commands/responses) | 4 hrs | None |
| Implement `IPCCommand` class | 2 hrs | None |
| Implement `IPCResponse` class | 2 hrs | None |
| Implement `IPCClient` class | 4 hrs | None |
| Add timeout and error handling | 2 hrs | None |
| Unit tests for IPC client | 2 hrs | None |

**Total:** 16 hours

#### Week 7: Orchestrator Integration

| Task | Effort | Dependencies |
|------|--------|--------------|
| Add IPC server to orchestrator | 4 hrs | Protocol design |
| Implement STATUS command handler | 2 hrs | None |
| Implement PAUSE/RESUME handlers | 2 hrs | None |
| Implement SET_BATCH_SIZE handler | 1 hr | None |
| Implement RETRY/SKIP handlers | 2 hrs | None |
| Integration testing | 4 hrs | All handlers |

**Total:** 15 hours

### 4.3 Verification

- [ ] IPC commands execute <100ms
- [ ] Orchestrator responds to all commands
- [ ] Error handling for disconnection
- [ ] Commands queued if orchestrator busy
- [ ] No race conditions

---

## 5. Phase 4: Orchestrator Control Panel (Weeks 8-9)

### 5.1 Objectives

- Full runtime control of orchestrator from TUI
- Pause, resume, adjust batch size
- Retry failed tasks, skip stuck tasks

### 5.2 Task Breakdown

#### Week 8: Core Control Panel

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `OrchestratorControlPanel` class | 6 hrs | IPC client |
| Implement collapsed control bar | 2 hrs | None |
| Implement execution state section | 4 hrs | STATUS command |
| Implement batch size control | 4 hrs | SET_BATCH_SIZE |
| Add pause/resume controls | 4 hrs | PAUSE/RESUME |

**Total:** 20 hours

#### Week 9: Advanced Controls and Integration

| Task | Effort | Dependencies |
|------|--------|--------------|
| Implement failed task actions | 6 hrs | RETRY/SKIP |
| Implement stuck detection section | 6 hrs | detect-stuck |
| Add keyboard handling (Ctrl+O) | 2 hrs | Phase 1 keyboard |
| Layout integration | 4 hrs | TUI layout |
| Integration testing | 8 hrs | All features |

**Total:** 26 hours

### 5.3 Verification

- [ ] Pause after current tasks complete
- [ ] Resume resumes execution
- [ ] Batch size changes take effect
- [ ] Failed tasks can be retried
- [ ] Stuck tasks can be skipped
- [ ] Threshold can be extended

---

## 6. Phase 5: Event Infrastructure (Week 10)

### 6.1 Objectives

- Create event bus for real-time updates
- Integrate event emission in orchestrator
- Prepare for Event Stream Panel

### 6.2 Task Breakdown

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `EventBus` class | 4 hrs | None |
| Define `EventType` enum | 2 hrs | None |
| Implement subscribe/emit pattern | 2 hrs | None |
| Add event history with max size | 2 hrs | None |
| Integrate emission in orchestrator | 4 hrs | Orchestrator |
| Integrate emission in claude_runner | 4 hrs | Claude runner |

**Total:** 18 hours

### 6.3 Verification

- [ ] Events emitted for all types
- [ ] Subscribe/unsubscribe works
- [ ] History maintains max size
- [ ] No memory leaks
- [ ] Events include all required data

---

## 7. Phase 6: Event Stream Panel (Week 11)

### 7.1 Objectives

- Real-time event visualization
- Filterable event stream
- Detailed event cards

### 7.2 Task Breakdown

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `EventStreamPanel` class | 6 hrs | EventBus |
| Implement collapsed stream view | 3 hrs | None |
| Implement expanded view | 4 hrs | None |
| Implement event cards (7 types) | 7 hrs | None |
| Implement filter bar | 3 hrs | None |
| Add keyboard handling (Ctrl+E) | 2 hrs | Phase 1 keyboard |
| Layout integration | 4 hrs | TUI layout |
| Integration testing | 5 hrs | All features |

**Total:** 34 hours

### 7.3 Verification

- [ ] Events appear within 100ms
- [ ] Filter by category works
- [ ] Pause/resume stream works
- [ ] Event cards show correct data
- [ ] Scroll/navigation works

---

## 8. Phase 7: Advanced Features (Week 12+)

### 8.1 Parallel Dashboard

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `ParallelExecutionDashboard` class | 6 hrs | None |
| Implement active sessions section | 4 hrs | status.json |
| Implement constraints section | 4 hrs | cmdNext() |
| Implement commit queue section | 4 hrs | git-queue |
| Add keyboard handling | 2 hrs | Phase 1 keyboard |

**Total:** 20 hours

### 8.2 Multi-Plan View

| Task | Effort | Dependencies |
|------|--------|--------------|
| Create `PlanRegistry` class | 6 hrs | None |
| Plan scanning and status loading | 4 hrs | status.json |
| Create `MultiPlanView` class | 6 hrs | Registry |
| Plan selector popup | 4 hrs | None |
| Dashboard view | 6 hrs | None |
| Plan switching | 2 hrs | None |
| Keyboard handling | 2 hrs | Phase 1 keyboard |
| Comparison view (optional) | 4 hrs | None |

**Total:** 33 hours

### 8.3 Verification

- [ ] Multiple sessions tracked
- [ ] Commit queue visible
- [ ] Plan switching works
- [ ] Progress visible across plans
- [ ] No conflicts between panels

---

## 9. Risk Mitigation

### 9.1 Critical Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| IPC complexity | HIGH | HIGH | File-based IPC first, upgrade later |
| Performance degradation | MEDIUM | HIGH | Profile each phase, optimize |
| Keyboard conflicts | MEDIUM | MEDIUM | Document all mappings upfront |
| Layout overflow | LOW | MEDIUM | Responsive layouts, scroll |

### 9.2 Contingency Plans

**If IPC fails:**
- Fall back to read-only control panel
- Use file-based state synchronization
- Defer control features to later release

**If performance degrades:**
- Reduce refresh rate to 1-2 seconds
- Implement lazy loading for panels
- Add panel visibility toggles

---

## 10. Success Criteria

### 10.1 Phase Success Criteria

| Phase | Criteria |
|-------|----------|
| Phase 1 | All 19 quick wins visible, no lag |
| Phase 2 | 3 panels toggle correctly |
| Phase 3 | IPC commands work <100ms |
| Phase 4 | Full orchestrator control |
| Phase 5 | Events captured and stored |
| Phase 6 | Real-time stream visible |
| Phase 7 | Multi-plan switching works |

### 10.2 Overall Success Criteria

- [ ] User can answer "why is this task blocked?" from TUI
- [ ] User can pause/resume orchestrator from TUI
- [ ] User can see real-time events without terminal scrollback
- [ ] User can switch between plans without restart
- [ ] All features work on Linux, macOS, WSL2
- [ ] TUI refresh remains <100ms with all panels

---

## 11. Documentation Deliverables

### 11.1 During Implementation

| Document | Phase | Location |
|----------|-------|----------|
| Keyboard Mapping Reference | 1 | `docs/TUI-KEYBOARD.md` |
| Panel Architecture | 2 | `docs/TUI-PANELS.md` |
| IPC Protocol Spec | 3 | `docs/IPC-PROTOCOL.md` |
| Event Types Reference | 5 | `docs/EVENT-TYPES.md` |

### 11.2 Final Documentation

| Document | Purpose |
|----------|---------|
| TUI User Guide | End-user documentation |
| TUI Developer Guide | Extension/customization guide |
| Panel Contribution Guide | How to add new panels |

---

## 12. Next Steps

### 12.1 Immediate Actions

1. **Approve Roadmap** - Review with stakeholders
2. **Create Amendment PR** - Update tui-integration-implementation.md
3. **Create New Plan** - tui-workflow-expansion.md
4. **Begin Phase 1** - Quick wins implementation

### 12.2 Tracking

- Track progress in status.json for both plans
- Weekly status updates
- Demo at each milestone

---

**End of Implementation Roadmap**
