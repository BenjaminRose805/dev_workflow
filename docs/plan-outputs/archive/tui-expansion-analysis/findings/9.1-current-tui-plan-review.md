# Task 9.1: Current TUI Plan Phases and Panels Review

**Date:** 2025-12-26
**Source:** `docs/plans/tui-integration-implementation.md`
**Purpose:** Extract all planned panels and features for gap analysis comparison

---

## Executive Summary

The current TUI implementation plan has **5 phases** with **24 pending tasks**. It defines **13 panels/components** across keyboard navigation, information display, command integration, and advanced visualization. This review catalogs these for comparison with the orchestrator features identified in Phase 8.

---

## Plan Overview

| Attribute | Value |
|-----------|-------|
| **Plan File** | `docs/plans/tui-integration-implementation.md` |
| **Priority** | P0 (Critical Path) |
| **Total Phases** | 5 |
| **Total Tasks** | 24+ (nested subtasks) |
| **Status** | 24 pending |
| **Analysis Reference** | `docs/plan-outputs/tui-command-integration-analysis/` |

---

## Phase 1: Keyboard Foundation

**Objective:** Enable keyboard-driven TUI interaction with navigation and help.
**Effort:** ~1 week | **Value:** 30%

### Components Planned

| Component | Location | Status |
|-----------|----------|--------|
| `KeyboardHandler` class | `scripts/tui/keyboard.py` | Pending |
| Key mapping configuration | `scripts/tui/keyboard.py` | Pending |
| Mode system (NORMAL, COMMAND, SEARCH) | `scripts/tui/keyboard.py` | Pending |
| Help overlay | `scripts/tui/overlays.py` | Pending |
| Selection state (cursor) | `scripts/lib/tui.py` | Pending |

### Features Planned

| Feature | Description |
|---------|-------------|
| Navigation | j/k/arrow keys for vertical movement |
| Panel switching | Tab key to move between panels |
| Help toggle | `?` key shows keybinding reference |
| Mode exit | Escape key exits current mode |
| Threaded input | Non-blocking stdin reader |

---

## Phase 2: Quick Win Panels

**Objective:** Add high-value, low-effort information panels.
**Effort:** ~3 days | **Value:** 60% (cumulative)
**Execution Note:** Tasks 2.1-2.6 are [SEQUENTIAL]

### Panels Planned

| Panel | Class | Purpose |
|-------|-------|---------|
| Phase Progress Bars | `PhaseProgressPanel` | Mini progress bars per phase |
| Upcoming Tasks | `UpcomingPanel` | Next tasks from `get_next_tasks()` |
| Retry History | In `InProgressPanel` | `[Retry N/3]` suffix, color-coded |
| Inline Blockers | In `InProgressPanel` | `[Blocked by: X.Y]` indicator |
| Run History | `RunHistoryPanel` | Run #, start time, duration |

### Features Planned

| Feature | Description |
|---------|-------------|
| VERIFY task highlighting | Different color for VERIFY tasks |
| Panel toggle keys | 1-5 number keys toggle visibility |
| Dynamic layout | Layout adapts to visible panels |
| Expandable errors | Show last error message on selection |

---

## Phase 3: Command Integration

**Objective:** Enable slash command execution from TUI.
**Effort:** ~1 week | **Value:** 80% (cumulative)

### Components Planned

| Component | Location | Purpose |
|-----------|----------|---------|
| Command Palette Modal | `scripts/tui/command_palette.py` | `:` key opens command list |
| Task Picker Modal | `scripts/tui/task_picker.py` | Task selection for commands |
| Command Runner | `scripts/tui/command_runner.py` | Subprocess execution |

### Features Planned

| Feature | Description |
|---------|-------------|
| Fuzzy filter | Filter commands as user types |
| Tab completion | Complete command names |
| Multi-select | Space key for batch commands |
| Task action keys | e/i/v/s/f/d for explain/implement/verify/skip/findings/deps |
| Output streaming | Real-time output to activity panel |

---

## Phase 4: Advanced Visualization

**Objective:** Rich workflow visualization for complex plans.
**Effort:** ~1-2 weeks | **Value:** 95% (cumulative)
**Execution Note:** Tasks 4.1-4.5 are [SEQUENTIAL]

### Panels Planned

| Panel | Class | Purpose |
|-------|-------|---------|
| Dependency Graph | `DependencyGraphPanel` | Box-drawing dependency tree |
| Parallel Agent Tracker | `AgentTrackerPanel` | Agent progress bars |
| Subtask Tree | `SubtaskTreePanel` | Indented X.Y.Z tree view |
| Findings Browser | `FindingsBrowserModal` | Full-screen markdown viewer |
| Artifact Browser | `ArtifactBrowserPanel` | List findings with preview |

### Features Planned

| Feature | Description |
|---------|-------------|
| Color-coding by status | Green=complete, yellow=in_progress, dim=pending |
| Fan-in status | "Waiting for N/M agents" display |
| Collapse/expand | +/- keys for subtask groups |
| Markdown rendering | Rich Markdown component |
| External editor | Open with `$EDITOR` on Enter |

---

## Phase 5: Polish and Enhancement

**Objective:** Production quality with edge case handling.
**Effort:** Varies | **Value:** 100%
**Execution Note:** Tasks 5.2 and 5.4 are [SEQUENTIAL]

### Features Planned

| Feature | Location | Description |
|---------|----------|-------------|
| Search Mode | `scripts/tui/keyboard.py` | `/` key, highlight matches |
| Responsive Layouts | `scripts/lib/tui.py` | Adapt to terminal size |
| Config Persistence | `scripts/tui/config.py` | Save panel preferences |
| Focus Mode | `scripts/lib/tui.py` | `F` key maximizes panel |
| Error Handling | Multiple | Graceful failures |

### Layout Variants

| Variant | Condition | Changes |
|---------|-----------|---------|
| Compact | <24 rows | Hide low-priority panels |
| Standard | 40+ rows | Full panel display |
| Focus | User toggle | Maximize selected panel |

---

## Complete Panel Inventory

### Information Panels (Display Only)

| Panel Name | Status | Data Source |
|------------|--------|-------------|
| Header | Existing | Orchestrator state |
| Progress Bar | Existing | status.json summary |
| Activity | Existing | StreamingClaudeRunner |
| In Progress | Existing | status.json tasks |
| Recent Completions | Existing | status.json tasks |
| Footer | Existing | Activity stats |
| Phase Progress | Planned | `phases` command |
| Upcoming Tasks | Planned | `next` command |
| Run History | Planned | status.json runs |
| Dependency Graph | Planned | `deps` command |
| Agent Tracker | Planned | Claude stream parsing |
| Subtask Tree | Planned | status.json tasks |
| Artifact Browser | Planned | Findings directory |

### Interactive Components

| Component | Status | Trigger |
|-----------|--------|---------|
| Help Overlay | Planned | `?` key |
| Command Palette | Planned | `:` key |
| Task Picker | Planned | From commands |
| Findings Browser | Planned | `f` key |
| Error Detail Modal | Not in plan | N/A |
| Pause/Resume Modal | Not in plan | N/A |
| Stuck Detection Panel | Not in plan | N/A |
| Constraint Visualization | Not in plan | N/A |

---

## Gap Identification Preview

Based on Phase 8 analysis, these features are **NOT in the current TUI plan**:

| Missing Feature | Phase 8 Source | Impact |
|-----------------|----------------|--------|
| Pause/Resume/Stop controls | 8.5 Control mapping | HIGH |
| Stuck task intervention panel | 8.4 Stuck analysis | HIGH |
| Sequential constraint visualization | 8.2 Gap analysis | HIGH |
| File conflict badges | 8.2 Gap analysis | MEDIUM |
| Batch composition explainer | 8.3 Events | MEDIUM |
| IPC command display | 8.3 Events | LOW |
| Multi-plan dashboard | 8.5 Control mapping | MEDIUM |
| Threshold adjustment controls | 8.4 Stuck analysis | LOW |
| Event bus architecture | 8.3 Events | MEDIUM |

---

## Success Criteria from Current Plan

### Functional Requirements

- [ ] Keyboard navigation works without mouse
- [ ] All 6 new panels display correct data
- [ ] Command palette executes plan commands
- [ ] Task actions (e/i/v/s/f/d) work on selected tasks
- [ ] Findings browser renders markdown correctly
- [ ] Dependency graph shows task relationships

### Quality Requirements

- [ ] No input lag (keyboard response < 100ms)
- [ ] No visual glitches during updates
- [ ] Graceful handling of large plans (100+ tasks)
- [ ] Memory usage stable over long sessions

### Compatibility Requirements

- [ ] Works on Linux, macOS, WSL2
- [ ] Works in 80x24 minimum terminal size
- [ ] Backward compatible with existing TUI usage
- [ ] No breaking changes to CLI/JSON modes

---

## Related Documents

- **Analysis Reference:** `docs/plan-outputs/tui-command-integration-analysis/`
- **Panel Designs:** `findings/3-1-tui-panel-extensions-design.md`
- **Data Contracts:** `findings/3-2-command-tui-data-contracts.md`
- **Keyboard Design:** `findings/3-3-keyboard-navigation-command-palette.md`
- **Architecture:** `findings/3-6-architecture-proposal-complete.md`
- **Priority Matrix:** `findings/3-5-integration-priority-matrix.md`

---

## Notes for Gap Analysis (Task 9.2-9.5)

This review provides the baseline for comparing against:

1. **Git workflow features** (Phase 1 inventory) → Compare in Task 9.2
2. **Parallel/sequential features** (Phases 2-7) → Compare in Task 9.3
3. **Orchestrator features** (Phase 8) → Compare in Task 9.4
4. **Categorization** → Task 9.5

Key observations:
- Current plan focuses on **command execution** and **visualization**
- Missing: **execution control** (pause/resume/stop)
- Missing: **constraint visualization** (sequential chains)
- Missing: **stuck detection UI** (intervention controls)
- Missing: **multi-plan support** (dashboard, switching)

---

**End of Review**
