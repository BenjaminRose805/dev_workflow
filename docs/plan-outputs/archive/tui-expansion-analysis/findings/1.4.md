# Task 1.4: Map Git Features to Potential TUI Panels/Actions

## Summary

Mapping of inventoried git workflow features to TUI panels and user actions, based on review of current TUI implementation (`scripts/lib/tui.py`) and existing TUI plan (`tui-integration-implementation.md`).

## Current TUI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEADER (size=5)                                             â”‚
â”‚ - Plan name, Phase, Iteration                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PROGRESS (size=3)                                           â”‚
â”‚ - Progress bar, Percentage, Task counts, Elapsed time       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ACTIVITY (size=10)                                          â”‚
â”‚ - Recent tool calls, Timestamps, Duration                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IN PROGRESS (tasks/left)      â”‚ COMPLETIONS (tasks/right)   â”‚
â”‚ - Tasks currently working     â”‚ - Recently completed        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOOTER (size=2)                                             â”‚
â”‚ - Status message, Tool stats                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Git Feature â†’ TUI Panel Mapping

### Category 1: Branch Status Panel (NEW)

**Proposed Panel:** Git Status Panel

**Location:** Add as row in header or below footer

**Data Source:** `getGitInfo()` from status-cli.js

| Feature | Display | TUI Element |
|---------|---------|-------------|
| Current branch | `Branch: plan/my-feature âœ“` | Text with status icon |
| Uncommitted count | `2 uncommitted files` | Badge (red if >0) |
| Commits ahead | `5 commits ahead of main` | Counter |
| Last commit | `abc1234 [plan] task 1.1: ...` | Truncated text |
| Branch validation | âœ“/âš /âœ— icon based on expected | Status badge |

**Mock Layout:**
```
â”Œâ”€ Git â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Branch: plan/my-feature âœ“  | 2 files  | 5 commits ahead      â”‚
â”‚ Last: abc1234 [plan] task 1.1: Add authentication            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Keyboard Actions:**
| Key | Action |
|-----|--------|
| `g` | Toggle git panel visibility |
| `b` | Open branch menu (requires command palette) |
| `s` | Show git status detail |

### Category 2: Completion Dashboard Integration

**Where:** Extend existing progress/header panels or new overlay

**Features:**
| Feature | When Shown | Display |
|---------|------------|---------|
| Pre-completion check | Before `/plan:complete` | Checklist overlay |
| Merge strategy | During complete flow | Radio selector |
| Conflict resolution | When conflicts detected | Modal dialog |
| Archive browser | After completion | History panel |

**Pre-Completion Check Panel:**
```
â”Œâ”€ Complete Plan Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ All tasks completed (15/15)                                â”‚
â”‚ âœ“ On correct branch (plan/my-feature)                        â”‚
â”‚ âš  2 uncommitted changes                                      â”‚
â”‚ âœ“ No merge conflicts with main                               â”‚
â”‚                                                              â”‚
â”‚ Ready to complete. Press [c] to continue or [q] to cancel.   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Category 3: Footer Enhancement

**Extend existing FOOTER panel:**

Current:
```
STATUS: Working on task 1.1  |  Tools: 45  |  Agents: 3  |  Edits: 12
```

Proposed:
```
STATUS: Working on task 1.1  |  Tools: 45  |  âš¡ plan/my-feature +5  |  2 uncommitted
```

**Git indicators in footer:**
| Indicator | Meaning |
|-----------|---------|
| `âš¡ branch +N` | Commits ahead of base |
| `2 uncommitted` | Uncommitted files |
| `âŸ³` | Sync in progress |
| `âš ` | Not on plan branch |

### Category 4: Activity Stream Enhancement

**Extend existing ACTIVITY panel:**

Add git operations to activity stream:
```
[14:30:15] [OK] Bash: git add -A                        0.1s
[14:30:15] [OK] Bash: git commit -m "[plan] task..."    0.3s
[14:30:16] ...  Bash: git push                          ...
```

**New activity types:**
| Type | Display |
|------|---------|
| Commit | `âœ“ Committed [plan] task 1.1: ...` |
| Push | `â†‘ Pushed to origin/plan/...` |
| Stash | `ğŸ“¦ Stashed 2 files` |
| Branch switch | `â‡„ Switched to plan/other` |

### Category 5: Header Enhancement

**Extend existing HEADER panel:**

Current:
```
PLAN ORCHESTRATOR
Plan: my-plan
Phase: Phase 1: Core Implementation  |  Iteration: 3/50
```

Proposed:
```
PLAN ORCHESTRATOR                        âš¡ plan/my-feature âœ“
Plan: my-plan
Phase: Phase 1: Core Implementation  |  Iteration: 3/50
```

Add branch badge to top-right of header.

## Feature Priority Matrix

| Feature | Panel Type | Effort | Value | Priority |
|---------|------------|--------|-------|----------|
| Branch badge in header | Enhance existing | Low | High | P0 |
| Uncommitted indicator | Enhance footer | Low | High | P0 |
| Last commit in footer | Enhance footer | Low | Medium | P1 |
| Git commits in activity | Enhance existing | Medium | Medium | P1 |
| Git status panel | New panel | Medium | High | P1 |
| Pre-completion check | Overlay/modal | High | High | P2 |
| Merge strategy selector | Overlay/modal | High | Medium | P2 |
| Conflict resolution modal | Overlay/modal | High | High | P2 |
| Archive browser panel | New panel | High | Low | P3 |
| Branch switcher | Overlay/modal | High | Low | P3 |

## Integration with Existing TUI Plan

### Already Planned in tui-integration-implementation.md

| Feature | Where in Plan | Gap? |
|---------|---------------|------|
| Keyboard navigation | Phase 1 | No |
| Panel toggle (1-5 keys) | Phase 2.6 | No |
| Command palette | Not in plan | Yes - needed for git commands |
| Modal overlays | Phase 1.3 (help) | Partial - extend for git |

### Recommended Additions to TUI Plan

1. **Quick Win: Git Footer Info (1-2 hours)**
   - Add branch + uncommitted to footer
   - Minimal layout change

2. **Medium: Git Status Row (4-6 hours)**
   - New collapsible row below header
   - Toggle with `g` key

3. **Large: Completion Flow Overlays (1-2 days)**
   - Pre-completion checklist
   - Conflict resolution modal
   - Merge strategy selector

## Data Contract for Git Panel

```json
{
  "git": {
    "available": true,
    "branch": "plan/my-feature",
    "expectedBranch": "plan/my-feature",
    "branchValid": true,
    "uncommittedCount": 2,
    "uncommittedFiles": ["src/file.ts", "test.ts"],
    "commitCount": 5,
    "lastCommit": {
      "sha": "abc1234",
      "message": "[plan] task 1.1: Add authentication"
    },
    "remote": {
      "configured": true,
      "ahead": 5,
      "behind": 0
    }
  }
}
```

## Recommended Implementation Order

1. **Phase A: Minimal Git Awareness (2-4 hours)**
   - Add git info to footer (branch, uncommitted)
   - No new panels, minimal layout change

2. **Phase B: Git Status Row (1 day)**
   - New collapsible row with full git info
   - Toggle visibility with `g` key
   - Integrate with keyboard handler

3. **Phase C: Completion Flow (2-3 days)**
   - Pre-completion checklist overlay
   - Conflict detection and resolution modal
   - Merge strategy selector

4. **Phase D: Advanced Git Features (3-5 days)**
   - Archive browser panel
   - Branch switcher/creator
   - Stash management
   - Commit queue visualization
