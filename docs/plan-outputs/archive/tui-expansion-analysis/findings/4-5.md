# Task 4.5: Mapping Dependency System to TUI Visualization

**Analysis Plan:** TUI Expansion Analysis
**Task Number:** 4.5
**Date:** 2025-12-26
**Scope:** Map dependency data to concrete TUI visualization opportunities

---

## Executive Summary

The dependency system provides rich data for TUI visualization. All required data is already available through `buildDependencyGraph()` and the `deps` command. This document identifies six panel types for surfacing dependency information in the TUI.

**Key Finding:** Implementation requires UI layer only - all backend data sources exist.

---

## 1. Available Dependency Data

### 1.1 Data Sources

| Source | Command/Function | Data |
|--------|------------------|------|
| Dependency graph | `buildDependencyGraph()` | Complete task dependency map |
| Single task deps | `deps --task X.Y` | Task-specific dependency details |
| Global dep stats | `deps` command | Summary + critical path |
| Task status | `next` command | Dependency satisfaction state |

### 1.2 Dependency Graph Structure

```javascript
{
  "1.1": {
    dependencies: [],           // Tasks this depends on
    dependents: ["1.3"],        // Tasks waiting for this
    inDegree: 0                 // Count for scheduling
  },
  "1.3": {
    dependencies: ["1.1", "1.2"],
    dependents: ["2.1"],
    inDegree: 2
  }
}
```

### 1.3 Single Task Query Output

```json
{
  "task": { "id": "1.3", "status": "pending" },
  "dependencies": [
    { "id": "1.1", "status": "completed" },
    { "id": "1.2", "status": "in_progress" }
  ],
  "dependents": [
    { "id": "2.1", "status": "pending" }
  ],
  "blockedBy": ["1.2"],
  "isReady": false
}
```

---

## 2. Proposed TUI Panels

### 2.1 Panel Type 1: Inline "Blocked By" Indicators

**Purpose:** Quick visual feedback on why tasks can't start

**Display:**
```
┌──────────────────────────────────────────────────┐
│ IN PROGRESS                                      │
├──────────────────────────────────────────────────┤
│ 1.3: Implement core logic [Blocked by: 1.2]     │
│ 2.2: Create API endpoints                        │
│ 3.1: Write unit tests [Blocked by: 2.2]         │
└──────────────────────────────────────────────────┘
```

**Implementation:** Modify `InProgressPanel` to query dependency graph
**Effort:** LOW (2-3 hours)

---

### 2.2 Panel Type 2: Dependency Tree View

**Purpose:** Show task dependencies as hierarchical tree

**Display:**
```
┌────────────────────────────────────────┐
│ DEPENDENCY TREE (Task 2.1)             │
├────────────────────────────────────────┤
│ ✓ 1.1: Initialize [completed]         │
│   ├─ 1.3: Implement [pending]         │
│   │   └─ 2.1: Build API [pending]     │
│   │       ├─ 2.2: Endpoints [pending] │
│   │       └─ 3.1: Tests [pending]     │
│   └─ 1.4: Config [completed]          │
│                                        │
│ Root → 1.1, 1.2                        │
│ Leaf → 3.2, 4.1                        │
└────────────────────────────────────────┘
```

**Implementation:** New panel with tree traversal algorithm
**Effort:** MEDIUM (4-6 hours)

---

### 2.3 Panel Type 3: Critical Path Highlighting

**Purpose:** Show longest dependency chain affecting completion time

**Display:**
```
┌────────────────────────────────────────┐
│ CRITICAL PATH (5 steps, ~2 hours)      │
├────────────────────────────────────────┤
│ 1.1: Initialize          [✓ 5 min]    │
│   ↓ (dependency)                      │
│ 1.3: Implement           [⏳ 45 min]  │
│   ↓ (blocked on 1.3)                  │
│ 2.1: Build API           [◯ pending]  │
│   ↓                                   │
│ 3.1: Deploy              [◯ pending]  │
│                                        │
│ Progress: 2/5 (40%)                   │
│ Est. remaining: ~1h 15min             │
└────────────────────────────────────────┘
```

**Data Source:** `criticalPath` from deps command
**Effort:** MEDIUM (5-7 hours)

---

### 2.4 Panel Type 4: "Blocking" Indicators

**Purpose:** Show which tasks are waiting on currently selected task

**Display:**
```
┌────────────────────────────────────────┐
│ TASK: 1.3 - Implement core logic       │
├────────────────────────────────────────┤
│ Status: in_progress (45 min elapsed)   │
│                                        │
│ Blocking these tasks:                  │
│ • 2.1: Build API (pending)             │
│ • 2.3: Integration tests (pending)     │
│                                        │
│ 3 tasks waiting on 1.3 completion      │
└────────────────────────────────────────┘
```

**Data Source:** `dependents` field from graph
**Effort:** LOW (2-3 hours)

---

### 2.5 Panel Type 5: Circular Dependency Warnings

**Purpose:** Alert to malformed plans

**Display:**
```
╔════════════════════════════════════════╗
║ ⚠ CIRCULAR DEPENDENCY DETECTED        ║
║ Cycle: 1.1 → 1.3 → 1.2 → 1.1         ║
║ These tasks cannot complete!          ║
║ Fix: Edit plan to break the cycle     ║
╚════════════════════════════════════════╝
```

**Data Source:** `detectDependencyCycles()` on startup
**Effort:** LOW (1-2 hours)

---

### 2.6 Panel Type 6: Dependency Matrix (Advanced)

**Purpose:** Show task × task dependency relationships

**Display:**
```
┌─────────────────────────────────────────────────┐
│ DEPENDENCY MATRIX (8 tasks with deps)           │
├──────┬──────┬──────┬──────┬──────┬──────────────┤
│Task  │1.1   │1.2   │1.3   │2.1   │Type         │
├──────┼──────┼──────┼──────┼──────┼──────────────┤
│1.1   │      │      │      │      │Root         │
│1.3   │  ✓   │  ✓   │      │      │Depends      │
│2.1   │      │  ⚠   │  ✓   │      │Conflict+Dep │
└──────┴──────┴──────┴──────┴──────┴──────────────┘

✓ = Dependency  ⚠ = File conflict
```

**Effort:** MEDIUM-HIGH (6-8 hours)

---

## 3. Data Refresh Strategy

### Refresh Triggers

| Panel | Refresh Frequency | Trigger |
|-------|-------------------|---------|
| Blocker indicators | On task status change | Instant |
| Critical path | Every 5-10 seconds | Timer |
| Dependency tree | On-demand (selection) | User action |
| Matrix view | Every 10 seconds | Timer |

### Caching Recommendation

```python
# Cache graph for 5 seconds
last_graph_refresh = time.time()
cached_graph = None

def get_dependency_graph(force=False):
    if force or time.time() - last_graph_refresh > 5:
        cached_graph = extract_graph(status)
        last_graph_refresh = time.time()
    return cached_graph
```

---

## 4. Keyboard Navigation

| Key | Action | Location |
|-----|--------|----------|
| `d` | Show dependencies of selected task | Detail view |
| `D` | Toggle dependency graph panel | Main layout |
| `Ctrl+D` | Show critical path panel | Main layout |
| `→` | Expand subtask / show dependents | Tree view |
| `←` | Collapse subtask | Tree view |
| `Shift+D` | Toggle dependency matrix | Main layout |

---

## 5. Integration with Existing TUI Plan

### Mapping to tui-integration-implementation.md

| Existing Task | New Enhancement | Effort |
|---------------|-----------------|--------|
| 2.4 Inline Blockers | Already planned | - |
| 4.1 Dependency Graph | Add critical path | +2 hours |
| Phase 5 Polish | Add matrix, interactions | +8 hours |

### New Tasks to Add

```markdown
- [ ] 2.7 Add Circular Dependency Warning (startup check)
- [ ] 2.8 Add "Blocking" indicators (reverse deps)
- [ ] 4.6 Implement Critical Path Timeline Panel
- [ ] 5.6 Enhance Dependency Interaction (navigation)
- [ ] 5.7 Dependency Matrix Panel (optional, Shift+D)
```

### Decision: Amend Existing Plan

**AMEND tui-integration-implementation.md** because:
- Only 3-5 new tasks needed (within <15 threshold)
- No new architectural components
- Fits naturally into existing phases

---

## 6. Priority Ranking

### Tier 1: Implement Immediately (Quick Wins)

| Rank | Enhancement | Effort | Value | ROI |
|------|-------------|--------|-------|-----|
| 1 | Inline blockers (2.4) | LOW | HIGH | 9.0 |
| 2 | Circular dep warning | LOW | HIGH | 9.0 |
| 3 | "Blocking" indicators | LOW | MEDIUM | 8.0 |

**Total:** ~5-7 hours

### Tier 2: Medium Term

| Rank | Enhancement | Effort | Value | ROI |
|------|-------------|--------|-------|-----|
| 4 | Dependency tree (4.1) | MEDIUM | HIGH | 7.5 |
| 5 | Critical path panel | MEDIUM | HIGH | 7.5 |

**Total:** ~15-20 hours

### Tier 3: Nice to Have

| Rank | Enhancement | Effort | Value | ROI |
|------|-------------|--------|-------|-----|
| 6 | Matrix view | MEDIUM-HIGH | MEDIUM | 5.5 |

---

## 7. Implementation Requirements

### Required Code Changes

| File | Change | Effort |
|------|--------|--------|
| `scripts/lib/tui.py` | Load graph from status.json | 1 hour |
| `scripts/lib/tui.py` | Render blocker indicators | 1 hour |
| `scripts/lib/tui.py` | New critical path panel | 2 hours |
| `scripts/tui/panels.py` | Tree panel implementation | 3 hours |
| `scripts/tui/keyboard.py` | Dependency navigation keys | 1 hour |

**Total:** ~8.5 hours for Tier 1+2

### Data Quality Considerations

| Edge Case | Handling |
|-----------|----------|
| Missing dependencies | Show ⚠ warning icon |
| Large graphs (100+ tasks) | Limit tree depth, lazy expansion |
| Circular references | Show error, block orchestration |

---

## 8. Summary

### Available Now
- Complete dependency data from `buildDependencyGraph()`
- Cycle detection via `detectDependencyCycles()`
- Task-level deps from `deps --task` command

### Proposed Panels (6 total)
1. Inline blockers (LOW effort, HIGH value)
2. Dependency tree (MEDIUM effort, HIGH value)
3. Critical path (MEDIUM effort, HIGH value)
4. Blocking indicators (LOW effort, MEDIUM value)
5. Cycle warnings (LOW effort, HIGH value)
6. Matrix view (MEDIUM-HIGH effort, MEDIUM value)

### Recommended Implementation Order
1. Inline blockers + cycle warnings (Phase 2)
2. Dependency tree + critical path (Phase 4)
3. Matrix view + advanced navigation (Phase 5)

**Decision: AMEND existing TUI plan** with 3-5 new tasks across phases.
