# Task 6.5: Multi-Plan Execution to TUI Visualization Mapping

## Summary

This analysis maps the multi-plan execution capabilities to concrete TUI visualization opportunities, building on the isolation, worktree, and orchestration analyses.

## Available Data Sources

### 1. Aggregate Status Command
**Command:** `node scripts/status-cli.js all-plans [--json]`

**Output Structure** (from `status-cli.js:1877-2019`):
```json
{
  "plans": [
    {
      "planPath": "docs/plans/feature-auth.md",
      "planName": "Feature Authentication",
      "location": "main",
      "worktreePath": null,
      "summary": {
        "totalTasks": 15,
        "completed": 10,
        "pending": 4,
        "in_progress": 1,
        "failed": 0
      },
      "currentPhase": "Phase 2: Implementation",
      "lastUpdated": "2024-12-26T10:30:00Z"
    }
  ],
  "aggregate": {
    "totalPlans": 2,
    "totalTasks": 30,
    "totalCompleted": 20,
    "totalPending": 8,
    "totalInProgress": 2,
    "totalFailed": 0,
    "overallPercentage": 67
  },
  "worktrees": [...],
  "orchestrators": [...]
}
```

### 2. Orchestrator Registry
**File:** `.claude/orchestrator-registry.json`

Provides running instance information:
- Instance ID, PID
- Plan path and worktree path
- Status (running/stopping/stopped/crashed)
- Last heartbeat timestamp

### 3. Per-Plan Status Files
**Pattern:** `docs/plan-outputs/{plan-name}/status.json`

Provides detailed task-level progress for each plan.

## TUI Panel Designs

### 1. Multi-Plan Dashboard (Primary View)

**Purpose:** At-a-glance view of all active plans

```
â”Œâ”€ Active Plans â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚ Plan                         Progress            Phase         Status  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ âš™ feature-auth              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%    Phase 2      running  â”‚
â”‚   main repo                  12/15 tasks         1 in_progress        â”‚
â”‚                                                                        â”‚
â”‚ âš™ api-refactor              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 60%    Phase 3      running  â”‚
â”‚   worktrees/plan-api-refac   9/15 tasks          2 in_progress        â”‚
â”‚                                                                        â”‚
â”‚ â—¯ tui-expansion             [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 44%    Phase 6      idle     â”‚
â”‚   main repo                  25/57 tasks         0 in_progress        â”‚
â”‚                                                                        â”‚
â”œâ”€ Aggregate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total: 3 plans | 46/87 tasks (53%) | 3 in_progress | 0 failed         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data mapping:**
- `plans[].planName` â†’ Plan name
- `plans[].summary` â†’ Progress bar and counts
- `plans[].currentPhase` â†’ Phase column
- `plans[].location` â†’ Location indicator
- `orchestrators[]` â†’ Running status icon

### 2. Plan Switcher Panel

**Purpose:** Quick navigation between plans

```
â”Œâ”€ Plan Switcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â†‘/â†“ Navigate  Enter: Focus  Tab: Switch pane          â”‚
â”‚                                                         â”‚
â”‚ â— feature-auth ........... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%  running   â”‚
â”‚ â—‹ api-refactor ........... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 60%  running   â”‚
â”‚ â—‹ tui-expansion .......... [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 44%  idle      â”‚
â”‚                                                         â”‚
â”‚ Recent activity:                                       â”‚
â”‚   feature-auth: task 2.3 completed (2m ago)            â”‚
â”‚   api-refactor: task 3.1 started (1m ago)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Keyboard shortcuts:**
- `â†‘/â†“` - Navigate between plans
- `Enter` - Expand selected plan (switch focus)
- `Tab` - Switch between dashboard panes
- `1-9` - Quick jump to plan by number

### 3. Cross-Plan Progress Comparison

**Purpose:** Visual comparison of plan progress

```
â”Œâ”€ Progress Comparison â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚ feature-auth    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  80%       â”‚
â”‚ api-refactor    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  60%       â”‚
â”‚ tui-expansion   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  44%       â”‚
â”‚                                                                        â”‚
â”‚ Completion rate (tasks/hour):                                          â”‚
â”‚   feature-auth: 4.2 | api-refactor: 2.8 | tui-expansion: 3.5          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Unified Event Stream

**Purpose:** Real-time feed of events across all plans

```
â”Œâ”€ Event Stream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filter: [All] [feature-auth] [api-refactor] [tui-expansion]           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 10:32:15 [feature-auth]   âœ“ Task 2.3 completed (auth middleware)      â”‚
â”‚ 10:32:10 [api-refactor]   â³ Task 3.1 started (route handlers)        â”‚
â”‚ 10:31:55 [feature-auth]   â³ Task 2.4 started (session handling)      â”‚
â”‚ 10:31:45 [api-refactor]   âœ“ Task 2.5 completed                        â”‚
â”‚ 10:31:30 [tui-expansion]  âœ“ Task 6.1 completed                        â”‚
â”‚ 10:31:20 [feature-auth]   ğŸ“¦ Commit: [feature-auth] task 2.2          â”‚
â”‚ 10:31:15 [api-refactor]   ğŸ“¦ Commit: [api-refactor] task 2.4          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Event types:**
- Task started (â³)
- Task completed (âœ“)
- Task failed (âœ—)
- Git commit (ğŸ“¦)
- Phase transition (ğŸ“)
- Orchestrator pause/resume (â¸/â–¶)

### 5. Plan Priority/Resource Allocation Controls

**Purpose:** Manage resource distribution between plans

```
â”Œâ”€ Resource Allocation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Max concurrent orchestrators: 3                                        â”‚
â”‚                                                                        â”‚
â”‚ Plan               Priority   Batch Size   Timeout                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ feature-auth       HIGH       5 tasks      600s                        â”‚
â”‚ api-refactor       MEDIUM     3 tasks      600s                        â”‚
â”‚ tui-expansion      LOW        2 tasks      300s                        â”‚
â”‚                                                                        â”‚
â”‚ [Rebalance]  [Pause Low Priority]  [Settings]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Worktree Status Panel

**Purpose:** Monitor worktree health and conflicts

```
â”Œâ”€ Worktrees â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Active: 2/3 (max)                                                      â”‚
â”‚                                                                        â”‚
â”‚ Worktree                    Branch              Last Sync              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ plan-api-refactor           plan/api-refactor   5 min ago              â”‚
â”‚ plan-feature-auth           plan/feature-auth   2 min ago              â”‚
â”‚                                                                        â”‚
â”‚ âš  Potential conflicts:                                                â”‚
â”‚   src/api.ts modified by both api-refactor and feature-auth           â”‚
â”‚                                                                        â”‚
â”‚ [View Conflicts] [Rebase All] [Clean Stale]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Refresh Strategy

### Polling Intervals

| Data Source | Interval | Method |
|-------------|----------|--------|
| `all-plans` aggregate | 5 seconds | Poll command |
| Per-plan status.json | 2 seconds | File watch |
| Orchestrator registry | 10 seconds | File watch |
| Event stream | Real-time | Log tail / IPC |

### Efficient Updates

1. **Differential Updates**
   - Only update TUI elements that changed
   - Compare `lastUpdatedAt` timestamps

2. **Lazy Loading**
   - Load full status only for focused plan
   - Use summary data for inactive plans

3. **Caching**
   - Cache plan list between refreshes
   - Invalidate on registry change

## Integration with Existing TUI

### Current TUI Structure (`scripts/lib/tui.py`)
The existing TUI focuses on single-plan orchestration with:
- Progress bar
- Current phase
- Task lists (in_progress, recent_completions)
- Activity feed

### Multi-Plan Extensions

| Existing Panel | Multi-Plan Extension |
|----------------|---------------------|
| Progress bar | Aggregate progress + per-plan bars |
| Phase display | Current phase per plan |
| Task lists | Unified event stream |
| Activity feed | Cross-plan event filtering |

### New TUI Modes

1. **Dashboard Mode** (default)
   - Multi-plan overview
   - Aggregate statistics
   - Quick navigation

2. **Focus Mode** (existing)
   - Single-plan detail view
   - Full task lists
   - Tool activity

3. **Comparison Mode** (new)
   - Side-by-side plan progress
   - Conflict visualization
   - Resource comparison

## Implementation Priority

| Panel | Priority | Effort | Dependencies |
|-------|----------|--------|--------------|
| Multi-Plan Dashboard | HIGH | Medium | `all-plans` command |
| Plan Switcher | HIGH | Low | Dashboard |
| Unified Event Stream | MEDIUM | Medium | Per-plan status files |
| Progress Comparison | MEDIUM | Low | Dashboard |
| Resource Controls | LOW | High | Worktree Phase 9 |
| Worktree Status | LOW | Medium | Worktree Phase 2 |

## Key Implementation References

| File | Location | Purpose |
|------|----------|---------|
| `status-cli.js:1872-2019` | `cmdAllPlans()` | Aggregate data |
| `orchestrator_registry.py` | All | Instance tracking |
| `tui.py` | Entire file | Existing TUI base |
| `plan_orchestrator.py:547-575` | Callbacks | TUI update hooks |
