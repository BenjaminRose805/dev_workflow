# CLI Commands Documentation

This document provides a comprehensive reference for all CLI commands in the orchestrator system.

## 1. status-cli.js Commands

### `status`
Show current plan status in JSON format.

**Usage:**
```bash
node scripts/status-cli.js status
```

**Output (JSON):**
```json
{
  "planPath": "docs/plans/my-plan.md",
  "planName": "My Plan",
  "currentPhase": "Phase 1: Setup",
  "lastUpdatedAt": "2025-12-24T10:00:00.000Z",
  "summary": {
    "totalTasks": 10,
    "completed": 3,
    "pending": 5,
    "in_progress": 1,
    "failed": 1,
    "skipped": 0
  },
  "tasks": [
    {
      "id": "1.1",
      "phase": "Phase 1: Setup",
      "description": "Task description",
      "status": "completed"
    }
  ]
}
```

---

### `init`
Initialize output directory and status.json for a plan.

**Usage:**
```bash
node scripts/status-cli.js init
```

**Output (JSON):**
```json
{
  "success": true,
  "planPath": "docs/plans/my-plan.md",
  "outputDir": "docs/plan-outputs/my-plan",
  "structure": {
    "statusJson": "docs/plan-outputs/my-plan/status.json",
    "findingsDir": "docs/plan-outputs/my-plan/findings",
    "timestampsDir": "docs/plan-outputs/my-plan/timestamps"
  },
  "taskCount": 10,
  "initialized": true
}
```

---

### `mark-started <task-id>`
Mark a task as in_progress.

**Usage:**
```bash
node scripts/status-cli.js mark-started 1.1
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "status": "in_progress"
}
```

**Errors:**
```
Error: Task ID is required. Usage: mark-started <task-id>
Error: Failed to mark task 99.99 as started. Task may not exist.
```

---

### `mark-complete <task-id> [--notes "..."]`
Mark a task as completed with optional notes.

**Usage:**
```bash
node scripts/status-cli.js mark-complete 1.1 --notes "Implementation finished"
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "status": "completed",
  "notes": "Implementation finished"
}
```

---

### `mark-failed <task-id> [--error "..."]`
Mark a task as failed with optional error message.

**Usage:**
```bash
node scripts/status-cli.js mark-failed 1.1 --error "Build error: missing dependency"
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "status": "failed",
  "error": "Build error: missing dependency"
}
```

---

### `mark-skipped <task-id> [--reason "..."]`
Mark a task as skipped with optional reason.

**Usage:**
```bash
node scripts/status-cli.js mark-skipped 1.1 --reason "Not applicable to current scope"
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "status": "skipped",
  "reason": "Not applicable to current scope"
}
```

---

### `next [count]`
Get next recommended tasks (default: 5).

**Usage:**
```bash
node scripts/status-cli.js next 3
```

**Output (JSON):**
```json
{
  "planPath": "docs/plans/my-plan.md",
  "currentPhase": "Phase 1: Setup",
  "inProgress": [
    { "id": "1.2", "description": "Current task" }
  ],
  "nextTasks": [
    { "id": "1.3", "phase": "Phase 1: Setup", "description": "Next task" },
    { "id": "1.4", "phase": "Phase 1: Setup", "description": "Following task" }
  ],
  "summary": { "totalTasks": 10, "completed": 2, "pending": 6 }
}
```

---

### `progress`
Show formatted progress bar (human-readable output).

**Usage:**
```bash
node scripts/status-cli.js progress
```

**Output (Text):**
```
Plan: My Plan
Progress: [████████████████░░░░░░░░░░░░░░░░░░░░░░░░] 40%

  ✓ Completed: 4
  ◯ Pending: 5
  ⏳ In Progress: 1
  ✗ Failed: 0
  ⊘ Skipped: 0

Total: 10 tasks
Current Phase: Phase 1: Setup
Last Updated: 12/24/2025, 10:00:00 AM
```

---

### `validate`
Validate and repair status.json.

**Usage:**
```bash
node scripts/status-cli.js validate
```

**Output (JSON):**
```json
{
  "valid": true,
  "issuesFound": 0,
  "issuesFixed": 0,
  "issues": [],
  "summary": { "totalTasks": 10, "completed": 4, "pending": 6 }
}
```

---

### `sync-check`
Compare markdown checkboxes vs status.json (read-only).

**Usage:**
```bash
node scripts/status-cli.js sync-check
```

**Output (JSON):**
```json
{
  "planPath": "docs/plans/my-plan.md",
  "statusJsonTasks": 10,
  "markdownTasks": 10,
  "inSync": true,
  "discrepancies": [],
  "onlyInStatusJson": [],
  "onlyInMarkdown": [],
  "summary": {
    "discrepancyCount": 0,
    "onlyInStatusJsonCount": 0,
    "onlyInMarkdownCount": 0
  },
  "recommendation": "Files are in sync."
}
```

---

### `write-findings <task-id> --file <path> | --stdin | --content "..."`
Write findings for a task.

**Usage:**
```bash
node scripts/status-cli.js write-findings 1.1 --content "Findings here"
node scripts/status-cli.js write-findings 1.1 --file findings.md
echo "Findings" | node scripts/status-cli.js write-findings 1.1 --stdin
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "findingsPath": "docs/plan-outputs/my-plan/findings/1-1.md"
}
```

---

### `read-findings <task-id>`
Read findings for a task (outputs raw content).

**Usage:**
```bash
node scripts/status-cli.js read-findings 1.1
```

**Output (Text):**
```
# Findings for Task 1.1
...raw content of findings file...
```

---

### `start-run`
Start a new execution run.

**Usage:**
```bash
node scripts/status-cli.js start-run
```

**Output (JSON):**
```json
{
  "success": true,
  "runId": "run-1735041600000"
}
```

---

### `complete-run <run-id> --completed N --failed N`
Complete an execution run with stats.

**Usage:**
```bash
node scripts/status-cli.js complete-run run-1735041600000 --completed 5 --failed 1
```

**Output (JSON):**
```json
{
  "success": true,
  "runId": "run-1735041600000",
  "completed": 5,
  "failed": 1
}
```

---

### `retryable`
Get failed tasks that can be retried.

**Usage:**
```bash
node scripts/status-cli.js retryable
```

**Output (JSON):**
```json
{
  "count": 2,
  "tasks": [
    { "id": "1.1", "retryCount": 1, "maxRetries": 3, "error": "..." }
  ]
}
```

---

### `exhausted`
Get failed tasks with no retries left.

**Usage:**
```bash
node scripts/status-cli.js exhausted
```

**Output (JSON):**
```json
{
  "count": 1,
  "tasks": [
    { "id": "2.1", "retryCount": 3, "maxRetries": 3, "error": "..." }
  ]
}
```

---

### `increment-retry <task-id> [--error "..."]`
Increment retry count for a failed task.

**Usage:**
```bash
node scripts/status-cli.js increment-retry 1.1 --error "Retry attempt failed"
```

**Output (JSON):**
```json
{
  "success": true,
  "taskId": "1.1",
  "retryCount": 2,
  "canRetry": true
}
```

---

### `detect-stuck`
Detect and mark stuck tasks as failed.

**Usage:**
```bash
node scripts/status-cli.js detect-stuck
```

**Output (JSON):**
```json
{
  "thresholdMinutes": 30,
  "stuckCount": 1,
  "stuckTasks": [
    { "id": "1.1", "stuckSince": "2025-12-24T09:00:00.000Z" }
  ]
}
```

---

## 2. plan-orchestrator.js Commands

### `status`
Get overall plan status summary.

**Usage:**
```bash
node scripts/plan-orchestrator.js status
```

**Output (JSON):**
```json
{
  "planPath": "docs/plans/my-plan.md",
  "planName": "My Plan",
  "source": "status.json",
  "total": 10,
  "completed": 4,
  "inProgress": 1,
  "failed": 1,
  "skipped": 0,
  "pending": 4,
  "percentage": 40,
  "currentPhase": "Phase 1: Setup"
}
```

---

### `next [count]`
Get next recommended tasks (default: 3).

**Usage:**
```bash
node scripts/plan-orchestrator.js next 5
```

**Output (JSON):**
```json
{
  "count": 3,
  "tasks": [
    {
      "id": "1.2",
      "description": "In progress task",
      "phase": 1,
      "status": "in_progress",
      "reason": "in_progress - should be completed first"
    },
    {
      "id": "1.3",
      "description": "Pending task",
      "phase": 1,
      "status": "pending",
      "reason": "pending - ready to implement"
    }
  ]
}
```

---

### `check <task-id>`
Check if a specific task can be started.

**Usage:**
```bash
node scripts/plan-orchestrator.js check 1.3
```

**Output (JSON):**
```json
{
  "task": {
    "id": "1.3",
    "description": "Task description",
    "status": "pending"
  },
  "canStart": true,
  "blockers": [],
  "phase": "Phase 1: Setup"
}
```

---

### `phases`
List all phases with completion status.

**Usage:**
```bash
node scripts/plan-orchestrator.js phases
```

**Output (JSON):**
```json
{
  "phases": [
    {
      "number": 1,
      "title": "Setup",
      "total": 3,
      "completed": 2,
      "percentage": 67,
      "status": "in_progress"
    },
    {
      "number": 2,
      "title": "Implementation",
      "total": 5,
      "completed": 0,
      "percentage": 0,
      "status": "pending"
    }
  ]
}
```

---

## 3. plan-runner.sh Commands

### `status`
Show current plan status (delegates to plan-orchestrator.js).

**Usage:**
```bash
./scripts/plan-runner.sh status
```

---

### `next [count]`
Get next N tasks (delegates to plan-orchestrator.js).

**Usage:**
```bash
./scripts/plan-runner.sh next 3
```

---

### `check <task-id>`
Check if a task can be started.

**Usage:**
```bash
./scripts/plan-runner.sh check 1.1
```

---

### `phases`
List all phases with status.

**Usage:**
```bash
./scripts/plan-runner.sh phases
```

---

### `explain <task-id>`
Output command to explain a task.

**Usage:**
```bash
./scripts/plan-runner.sh explain 1.1
```

**Output:**
```
Run: /plan:explain 1.1
```

---

### `implement <task-id>`
Output command to implement a task.

**Usage:**
```bash
./scripts/plan-runner.sh implement 1.1
```

**Output:**
```
Run: /plan:implement 1.1
```

---

### `verify <task-id>`
Output command to verify a task.

**Usage:**
```bash
./scripts/plan-runner.sh verify 1.1
```

**Output:**
```
Run: /plan:verify 1.1
```

---

### `split <task-id>`
Output command to split a task.

**Usage:**
```bash
./scripts/plan-runner.sh split 1.1
```

**Output:**
```
Run: /plan:split 1.1
```

---

### `phase <N>`
Show tasks in a specific phase.

**Usage:**
```bash
./scripts/plan-runner.sh phase 1
```

**Output (JSON):**
```json
{
  "phase": 1,
  "tasks": [
    { "id": "1.1", "description": "Task 1", "completed": true },
    { "id": "1.2", "description": "Task 2", "completed": false }
  ]
}
```

---

### `run <task-id>`
Show full execution cycle commands.

**Usage:**
```bash
./scripts/plan-runner.sh run 1.1
```

**Output:**
```
Full execution cycle for task 1.1:
1. /plan:explain 1.1
2. /plan:implement 1.1
3. /plan:verify 1.1
```

---

### `help`
Show usage information.

**Usage:**
```bash
./scripts/plan-runner.sh help
```

---

## 4. Library Functions (API Reference)

### plan-pointer.js

| Function | Description | Returns |
|----------|-------------|---------|
| `getActivePlanPath()` | Get path from `.claude/current-plan.txt` | `string \| null` |
| `getActivePlanOutputPath()` | Get path from `.claude/current-plan-output.txt` | `string \| null` |
| `getPlanName(planPath)` | Extract plan name from path | `string \| null` |
| `getStatusPath()` | Get status.json path | `string \| null` |
| `hasActivePlan()` | Check if plan is set | `boolean` |

### status-manager.js

| Function | Description | Returns |
|----------|-------------|---------|
| `initializePlanStatus(planPath)` | Create output dir and status.json | `{success, status, error}` |
| `getStatus(planPath, initIfMissing)` | Get status, optionally init | `object \| null` |
| `formatProgress(planPath)` | Human-readable progress string | `string` |
| `getTaskStatus(planPath, taskId)` | Get single task | `object \| null` |
| `getTasksByPhase(planPath)` | Group tasks by phase | `object \| null` |
| `getIncompleteTasks(planPath)` | Get non-completed tasks | `Array` |
| `getTaskStatusWithFallback(planPath)` | Get tasks (status.json or markdown) | `{tasks, source, summary}` |
| `markTaskStarted(planPath, taskId)` | Set task to in_progress | `boolean` |
| `markTaskCompleted(planPath, taskId, findings)` | Set task to completed | `boolean` |
| `markTaskFailed(planPath, taskId, error)` | Set task to failed | `boolean` |
| `markTaskSkipped(planPath, taskId, reason)` | Set task to skipped | `boolean` |
| `startRun(planPath)` | Start execution run | `string` (runId) |
| `completeRun(planPath, runId, completed, failed)` | Complete execution run | `boolean` |
| `getRunHistory(planPath)` | Get run history | `Array` |
| `formatRunHistory(planPath)` | Human-readable run history | `string` |

### plan-output-utils.js

| Function | Description | Returns |
|----------|-------------|---------|
| `getOutputDir(planPath)` | Get output directory path | `string` |
| `getStatusPath(planPath)` | Get status.json path | `string` |
| `getFindingsDir(planPath)` | Get findings directory path | `string` |
| `getTimestampsDir(planPath)` | Get timestamps directory path | `string` |
| `loadStatus(planPath)` | Load status.json | `object \| null` |
| `saveStatus(planPath, status)` | Save status.json | `boolean` |
| `updateTaskStatus(planPath, taskId, status, extras)` | Update task status | `boolean` |
| `writeFindings(planPath, taskId, content)` | Write findings file | `string` (path) |
| `readFindings(planPath, taskId)` | Read findings file | `string \| null` |
| `recalculateSummary(status)` | Calculate summary from tasks | `object` |
| `validateSummary(status, autoFix)` | Validate summary matches tasks | `{valid, mismatches}` |
| `ensureSummaryKeys(summary)` | Add missing summary keys | `object` |
| `getProgress(planPath)` | Get progress info | `object` |
| `getRetryableTasks(planPath)` | Get retryable failed tasks | `Array` |
| `getExhaustedTasks(planPath)` | Get exhausted failed tasks | `Array` |
| `incrementRetryCount(planPath, taskId, error)` | Increment retry | `object` |
| `detectAndMarkStuckTasks(planPath)` | Find and mark stuck tasks | `Array` |

---

## Exit Codes

All CLI commands follow these exit code conventions:

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | Error (invalid args, task not found, etc.) |
