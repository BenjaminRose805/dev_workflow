{
  "planPath": "docs/plans/implement-workflow-composition.md",
  "planName": "Implementation Plan: Workflow Composition",
  "createdAt": "2025-12-23T04:59:27.210Z",
  "lastUpdatedAt": "2025-12-23T04:59:27.210Z",
  "currentPhase": "Phase 1: Workflow Reference System",
  "tasks": [
    {
      "id": "1.1",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.1 Design `workflow_ref` step type schema for referencing external workflow templates",
      "status": "pending"
    },
    {
      "id": "1.2",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.2 Implement workflow loader to resolve and parse referenced workflow files",
      "status": "pending"
    },
    {
      "id": "1.3",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.3 Create workflow registry to cache loaded workflow definitions",
      "status": "pending"
    },
    {
      "id": "1.4",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.4 Implement workflow version resolution (explicit version vs latest)",
      "status": "pending"
    },
    {
      "id": "1.5",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.5 Add circular reference detection to prevent infinite composition loops",
      "status": "pending"
    },
    {
      "id": "1.6",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.6 Create workflow input/output binding validation between parent and child",
      "status": "pending"
    },
    {
      "id": "1.7",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.7 Implement workflow path resolution (relative, absolute, registry-based)",
      "status": "pending"
    },
    {
      "id": "1.8",
      "phase": "Phase 1: Workflow Reference System",
      "description": "1.8 Add workflow metadata extraction (name, version, inputs, outputs)",
      "status": "pending"
    },
    {
      "id": "1.9",
      "phase": "Phase 1: Workflow Reference System",
      "description": "**VERIFY 1**: Unit tests pass for workflow reference resolution. Can load `workflow: discovery-clarification` and validate input/output compatibility. Circular reference detected and rejected.",
      "status": "pending"
    },
    {
      "id": "2.1",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.1 Implement sequential workflow chaining with `depends_on` between workflow refs",
      "status": "pending"
    },
    {
      "id": "2.2",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.2 Create output-to-input binding syntax: `${steps.discover.outputs.requirements}`",
      "status": "pending"
    },
    {
      "id": "2.3",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.3 Implement execution engine changes to wait for workflow completion before next step",
      "status": "pending"
    },
    {
      "id": "2.4",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.4 Add status propagation from child workflow to parent step",
      "status": "pending"
    },
    {
      "id": "2.5",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.5 Create progress tracking for sequential pipeline (current step, total steps)",
      "status": "pending"
    },
    {
      "id": "2.6",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.6 Implement artifact path resolution for cross-workflow references",
      "status": "pending"
    },
    {
      "id": "2.7",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.7 Add pipeline visualization showing workflow chain",
      "status": "pending"
    },
    {
      "id": "2.8",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "2.8 Create checkpoint support for resuming failed pipelines",
      "status": "pending"
    },
    {
      "id": "2.9",
      "phase": "Phase 2: Sequential Composition (Pipelines)",
      "description": "**VERIFY 2**: Test pipeline: discovery → design → implement executes sequentially. Output from discovery feeds into design inputs. Pipeline resumes from checkpoint after failure.",
      "status": "pending"
    },
    {
      "id": "3.1",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.1 Implement `type: parallel` step containing multiple sub-workflows",
      "status": "pending"
    },
    {
      "id": "3.2",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.2 Create parallel execution engine launching N workflows concurrently",
      "status": "pending"
    },
    {
      "id": "3.3",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.3 Add configurable max concurrent workflows (default: 5)",
      "status": "pending"
    },
    {
      "id": "3.4",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.4 Implement output collection from parallel branches",
      "status": "pending"
    },
    {
      "id": "3.5",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.5 Create `${steps.parallel_step.outputs[*]}` syntax for collecting all outputs",
      "status": "pending"
    },
    {
      "id": "3.6",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.6 Implement waiting strategies: `all`, `any`, `threshold(N)`",
      "status": "pending"
    },
    {
      "id": "3.7",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.7 Add partial success handling with configurable minimum success rate",
      "status": "pending"
    },
    {
      "id": "3.8",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.8 Create branch isolation ensuring parallel workflows don't share state",
      "status": "pending"
    },
    {
      "id": "3.9",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.9 Implement progress reporting for parallel execution (N of M complete)",
      "status": "pending"
    },
    {
      "id": "3.10",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "3.10 Add timeout handling for slow parallel branches",
      "status": "pending"
    },
    {
      "id": "3.11",
      "phase": "Phase 3: Parallel Composition (Fan-Out)",
      "description": "**VERIFY 3**: Three validation workflows run in parallel. All must complete before aggregation step. One failure with `threshold(2)` still proceeds. Progress shows \"2 of 3 complete\".",
      "status": "pending"
    },
    {
      "id": "4.1",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.1 Implement condition expression on workflow ref steps",
      "status": "pending"
    },
    {
      "id": "4.2",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.2 Add `condition: ${steps.assess.scope == 'minor'}` evaluation before execution",
      "status": "pending"
    },
    {
      "id": "4.3",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.3 Create mutually exclusive branch detection and validation",
      "status": "pending"
    },
    {
      "id": "4.4",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.4 Implement step skipping with status `skipped` (not `failed`)",
      "status": "pending"
    },
    {
      "id": "4.5",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.5 Add `else` workflow support for if-then-else patterns",
      "status": "pending"
    },
    {
      "id": "4.6",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.6 Create condition evaluation logging for debugging",
      "status": "pending"
    },
    {
      "id": "4.7",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.7 Implement fallback chain pattern (try A, if fail try B, etc.)",
      "status": "pending"
    },
    {
      "id": "4.8",
      "phase": "Phase 4: Conditional Composition",
      "description": "4.8 Add condition coverage validation (ensure all paths handled)",
      "status": "pending"
    },
    {
      "id": "4.9",
      "phase": "Phase 4: Conditional Composition",
      "description": "**VERIFY 4**: Conditional workflow routes to `simple-release` when scope=minor, `comprehensive-release` when scope=major. Skipped branch shows status `skipped`. Fallback chain tries 3 alternatives.",
      "status": "pending"
    },
    {
      "id": "5.1",
      "phase": "Phase 5: Loop Composition",
      "description": "5.1 Implement `type: loop` step referencing a workflow to iterate",
      "status": "pending"
    },
    {
      "id": "5.2",
      "phase": "Phase 5: Loop Composition",
      "description": "5.2 Create loop configuration: `max_iterations`, `exit_condition`",
      "status": "pending"
    },
    {
      "id": "5.3",
      "phase": "Phase 5: Loop Composition",
      "description": "5.3 Add loop context variables: `loop.index`, `loop.iteration`, `loop.previous_output`",
      "status": "pending"
    },
    {
      "id": "5.4",
      "phase": "Phase 5: Loop Composition",
      "description": "5.4 Implement exit condition evaluation after each iteration",
      "status": "pending"
    },
    {
      "id": "5.5",
      "phase": "Phase 5: Loop Composition",
      "description": "5.5 Create loop state tracking (current iteration, outputs history)",
      "status": "pending"
    },
    {
      "id": "5.6",
      "phase": "Phase 5: Loop Composition",
      "description": "5.6 Implement break on condition (`break_on_success`, `break_on_failure`)",
      "status": "pending"
    },
    {
      "id": "5.7",
      "phase": "Phase 5: Loop Composition",
      "description": "5.7 Add loop output aggregation (collect all iteration results)",
      "status": "pending"
    },
    {
      "id": "5.8",
      "phase": "Phase 5: Loop Composition",
      "description": "5.8 Create safety limit enforcement (max_iterations required)",
      "status": "pending"
    },
    {
      "id": "5.9",
      "phase": "Phase 5: Loop Composition",
      "description": "5.9 Implement loop progress reporting",
      "status": "pending"
    },
    {
      "id": "5.10",
      "phase": "Phase 5: Loop Composition",
      "description": "**VERIFY 5**: Refinement loop executes until quality_score >= 0.85 or max 5 iterations. Loop context accessible in child workflow. Outputs from all iterations collected.",
      "status": "pending"
    },
    {
      "id": "6.1",
      "phase": "Phase 6: Nested Composition",
      "description": "6.1 Implement nested parallel blocks within workflows",
      "status": "pending"
    },
    {
      "id": "6.2",
      "phase": "Phase 6: Nested Composition",
      "description": "6.2 Create scope isolation for nested workflows (can't access sibling scope)",
      "status": "pending"
    },
    {
      "id": "6.3",
      "phase": "Phase 6: Nested Composition",
      "description": "6.3 Add variable shadowing support (inner can override outer scope)",
      "status": "pending"
    },
    {
      "id": "6.4",
      "phase": "Phase 6: Nested Composition",
      "description": "6.4 Implement depth limit for nesting (default: 5 levels)",
      "status": "pending"
    },
    {
      "id": "6.5",
      "phase": "Phase 6: Nested Composition",
      "description": "6.5 Create scope chain visualization for debugging",
      "status": "pending"
    },
    {
      "id": "6.6",
      "phase": "Phase 6: Nested Composition",
      "description": "6.6 Add output promotion from nested to parent scope",
      "status": "pending"
    },
    {
      "id": "6.7",
      "phase": "Phase 6: Nested Composition",
      "description": "6.7 Implement nested error propagation rules",
      "status": "pending"
    },
    {
      "id": "6.8",
      "phase": "Phase 6: Nested Composition",
      "description": "6.8 Create nested execution graph visualization",
      "status": "pending"
    },
    {
      "id": "6.9",
      "phase": "Phase 6: Nested Composition",
      "description": "**VERIFY 6**: Three-level nested workflow executes correctly. Inner workflow cannot access sibling's steps. Variable shadowing works (inner `version` overrides outer). Depth limit enforced.",
      "status": "pending"
    },
    {
      "id": "7.1",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.1 Implement explicit artifact binding: `inputs: { architecture: ${steps.design.outputs.architecture} }`",
      "status": "pending"
    },
    {
      "id": "7.2",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.2 Create artifact transformation support for type conversion",
      "status": "pending"
    },
    {
      "id": "7.3",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.3 Implement shared read-only artifact pattern for parallel branches",
      "status": "pending"
    },
    {
      "id": "7.4",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.4 Add artifact compatibility validation (type, version checking)",
      "status": "pending"
    },
    {
      "id": "7.5",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.5 Create artifact snapshot mechanism for immutable handoff",
      "status": "pending"
    },
    {
      "id": "7.6",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.6 Implement artifact versioning for composition tracking",
      "status": "pending"
    },
    {
      "id": "7.7",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.7 Add artifact provenance tracking (which workflow created it)",
      "status": "pending"
    },
    {
      "id": "7.8",
      "phase": "Phase 7: Artifact Handoff",
      "description": "7.8 Create artifact merge strategies for fan-in scenarios",
      "status": "pending"
    },
    {
      "id": "7.9",
      "phase": "Phase 7: Artifact Handoff",
      "description": "**VERIFY 7**: Artifact flows from design to implementation workflow. Parallel branches read same artifact without conflict. Artifact version mismatch detected and reported.",
      "status": "pending"
    },
    {
      "id": "8.1",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.1 Implement global scope (inputs, env, config) accessible to all workflows",
      "status": "pending"
    },
    {
      "id": "8.2",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.2 Create workflow scope containing steps and outputs",
      "status": "pending"
    },
    {
      "id": "8.3",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.3 Implement sub-workflow scope with own inputs/steps/outputs",
      "status": "pending"
    },
    {
      "id": "8.4",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.4 Add scope isolation (parallel workflows cannot reference each other)",
      "status": "pending"
    },
    {
      "id": "8.5",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.5 Create explicit output declaration requirement for cross-boundary access",
      "status": "pending"
    },
    {
      "id": "8.6",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.6 Implement variable shadowing rules (inner shadows outer)",
      "status": "pending"
    },
    {
      "id": "8.7",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.7 Add scope validation at composition time (not runtime)",
      "status": "pending"
    },
    {
      "id": "8.8",
      "phase": "Phase 8: Scoping Rules",
      "description": "8.8 Create scope debugging tools (show variable resolution chain)",
      "status": "pending"
    },
    {
      "id": "8.9",
      "phase": "Phase 8: Scoping Rules",
      "description": "**VERIFY 8**: Variable from global scope accessible in sub-workflow. Parallel workflow A cannot access workflow B's steps. Explicit output crossing scope boundary works.",
      "status": "pending"
    },
    {
      "id": "9.1",
      "phase": "Phase 9: Error Handling",
      "description": "9.1 Implement error propagation from child workflow to parent",
      "status": "pending"
    },
    {
      "id": "9.2",
      "phase": "Phase 9: Error Handling",
      "description": "9.2 Create `on_error: continue` for optional workflow steps",
      "status": "pending"
    },
    {
      "id": "9.3",
      "phase": "Phase 9: Error Handling",
      "description": "9.3 Implement `on_error: fallback` with fallback workflow definition",
      "status": "pending"
    },
    {
      "id": "9.4",
      "phase": "Phase 9: Error Handling",
      "description": "9.4 Add `on_error: recover` with recovery workflow steps",
      "status": "pending"
    },
    {
      "id": "9.5",
      "phase": "Phase 9: Error Handling",
      "description": "9.5 Create error context variables: `error.code`, `error.message`, `error.step`",
      "status": "pending"
    },
    {
      "id": "9.6",
      "phase": "Phase 9: Error Handling",
      "description": "9.6 Implement error configuration for different composition types:",
      "status": "pending"
    },
    {
      "id": "9.7",
      "phase": "Phase 9: Error Handling",
      "description": "9.7 Add error boundary isolation (error in sub-workflow doesn't crash parent)",
      "status": "pending"
    },
    {
      "id": "9.8",
      "phase": "Phase 9: Error Handling",
      "description": "9.8 Create error aggregation for parallel composition failures",
      "status": "pending"
    },
    {
      "id": "9.9",
      "phase": "Phase 9: Error Handling",
      "description": "**VERIFY 9**: Error in sub-workflow captured by parent. `on_error: continue` proceeds despite failure. Parallel with `fail_fast` stops on first error. Error context accessible in recovery workflow.",
      "status": "pending"
    },
    {
      "id": "10.1",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.1 Update workflow schema with all composition constructs",
      "status": "pending"
    },
    {
      "id": "10.2",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.2 Create JSON schema validation for composition patterns",
      "status": "pending"
    },
    {
      "id": "10.3",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.3 Implement composition-aware plan parser",
      "status": "pending"
    },
    {
      "id": "10.4",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.4 Add execution engine support for all composition types",
      "status": "pending"
    },
    {
      "id": "10.5",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.5 Create status output format showing composition hierarchy",
      "status": "pending"
    },
    {
      "id": "10.6",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.6 Implement execution visualization for composed workflows",
      "status": "pending"
    },
    {
      "id": "10.7",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.7 Add plan validation for composition anti-patterns",
      "status": "pending"
    },
    {
      "id": "10.8",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.8 Create example plans demonstrating each composition pattern",
      "status": "pending"
    },
    {
      "id": "10.9",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.9 Write user documentation for composition syntax",
      "status": "pending"
    },
    {
      "id": "10.10",
      "phase": "Phase 10: Integration and Documentation",
      "description": "10.10 Document performance considerations (nesting depth, parallel limits)",
      "status": "pending"
    },
    {
      "id": "10.11",
      "phase": "Phase 10: Integration and Documentation",
      "description": "**VERIFY 10**: All composition patterns validate against schema. Complex workflow combining pipeline, parallel, conditional, and loop executes correctly. Status shows full composition hierarchy.",
      "status": "pending"
    },
    {
      "id": "11.1",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.1 Create `feature-complete` template using all composition patterns",
      "status": "pending"
    },
    {
      "id": "11.2",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.2 Implement discovery phase as sequential workflow",
      "status": "pending"
    },
    {
      "id": "11.3",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.3 Add parallel implementation phase (backend, frontend, docs, deploy prep)",
      "status": "pending"
    },
    {
      "id": "11.4",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.4 Create validation phase with conditional release",
      "status": "pending"
    },
    {
      "id": "11.5",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.5 Implement error handling with recovery workflows",
      "status": "pending"
    },
    {
      "id": "11.6",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.6 Add approval gates at critical composition points",
      "status": "pending"
    },
    {
      "id": "11.7",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "11.7 Create end-to-end test for feature development workflow",
      "status": "pending"
    },
    {
      "id": "11.8",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "**VERIFY 11**: Feature development workflow executes: discovery → design → parallel(implement, document, deploy-prep) → validation → conditional(release). All patterns working together.",
      "status": "pending"
    },
    {
      "id": "11.9",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Sequential composition (pipelines) executes workflows in order with artifact handoff",
      "status": "pending"
    },
    {
      "id": "11.10",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Parallel composition (fan-out) runs N workflows concurrently with configurable limits",
      "status": "pending"
    },
    {
      "id": "11.11",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Conditional composition routes to correct workflow based on expression evaluation",
      "status": "pending"
    },
    {
      "id": "11.12",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Loop composition iterates until exit condition with safety limits",
      "status": "pending"
    },
    {
      "id": "11.13",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Nested composition supports 5 levels deep with proper scope isolation",
      "status": "pending"
    },
    {
      "id": "11.14",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Artifact handoff validates compatibility and supports transformation",
      "status": "pending"
    },
    {
      "id": "11.15",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Scoping rules isolate parallel workflows and allow explicit output crossing",
      "status": "pending"
    },
    {
      "id": "11.16",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Error handling supports continue, fallback, and recover patterns",
      "status": "pending"
    },
    {
      "id": "11.17",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Schema validates all composition patterns",
      "status": "pending"
    },
    {
      "id": "11.18",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Feature development template demonstrates real-world composition",
      "status": "pending"
    },
    {
      "id": "11.19",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Documentation covers syntax, patterns, and anti-patterns",
      "status": "pending"
    },
    {
      "id": "11.20",
      "phase": "Phase 11: Feature Development Workflow Template",
      "description": "Test suite covers all composition scenarios with >90% coverage",
      "status": "pending"
    }
  ],
  "runs": [],
  "summary": {
    "totalTasks": 115,
    "completed": 0,
    "pending": 115,
    "failed": 0,
    "skipped": 0
  }
}