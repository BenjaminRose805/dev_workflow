# Agent D1 Findings: Core Documentation

## Summary

The core documentation consists of three major files (ARCHITECTURE.md, ORCHESTRATOR.md, implementation-plans.md) and three architectural documents that together total 1,462 lines across 8 files. Analysis reveals:

- **2 distinct systems being documented**: Idea-to-Code (Next.js chat interface, 898 lines) vs Plan Orchestrator (execution framework, 423 lines)
- **Moderate DRY violations**: Overlapping explanations of status.json, artifact concepts, and system components
- **Broken/incorrect references**: Several relative path references that don't resolve correctly
- **Terminology inconsistencies**: Mixed usage of "commands," "plans," and "artifacts" across documents
- **Scope misalignment**: ARCHITECTURE.md documents an unrelated Next.js application instead of the dev_workflow system itself

---

## DRY Violations

### 1. Status.json Documentation Duplicated

**Locations:**
- `docs/ORCHESTRATOR.md:195-303` (423 lines, detailed specification)
- `docs/architecture/orchestrator-system.md:254-304` (51 lines, identical schema)

**Description:** The status.json format and schema are documented identically in both files, with the orchestrator-system.md being a complete duplicate of the ORCHESTRATOR.md content.

**Recommendation:** Keep definition in ORCHESTRATOR.md (primary reference), convert orchestrator-system.md to an abbreviated overview with link to ORCHESTRATOR.md.

---

### 2. Artifact Compatibility Matrix Scattered Across Multiple Documents

**Locations:**
- `docs/architecture/artifact-compatibility-matrix.md:1-824` (824 lines, comprehensive)
- `docs/implementation-plans.md:1-141` (141 lines, summary)
- `docs/architecture/command-dependency-graph.md:850-1111` (261 lines of Mermaid diagrams)

**Description:** The artifact flow and command dependencies are explained three times with overlapping content. Lines 850-1111 of command-dependency-graph.md repeat the producer-consumer relationships defined in artifact-compatibility-matrix.md sections 1-4.

**Recommendation:** Create a single source of truth document. Link implementation-plans.md and command-dependency-graph.md to artifact-compatibility-matrix.md.

---

### 3. Lock Management and Retry Logic Documented Twice

**Locations:**
- `docs/ORCHESTRATOR.md:319-387` (Troubleshooting section)
- `docs/architecture/orchestrator-system.md:306-326` (Configuration section)

**Description:** Lock timeout settings, stale lock detection, and retry backoff strategies are explained identically in both documents.

**Recommendation:** Consolidate into single reference table in ORCHESTRATOR.md with abbreviated version in orchestrator-system.md.

---

### 4. Workflow Entry Points Documented Multiple Ways

**Locations:**
- `docs/architecture/orchestrator-system.md:6-127` (ASCII diagram)
- `docs/ORCHESTRATOR.md:28-61` (Similar diagram)
- `docs/claude-commands/ARCHITECTURE.md:31-62` (Text description)

**Description:** The same system entry points (/plan:implement, /plan:batch, /plan:orchestrate, etc.) are described in three formats with slight variations in detail.

**Recommendation:** Standardize on single diagram format and reference it from other docs.

---

### 5. Plan System Concepts Explained in Multiple Places

**Locations:**
- `docs/ORCHESTRATOR.md:285-316` (Two-file system explanation)
- `docs/architecture/orchestrator-system.md:104-125` (File system structure)
- `docs/implementation-plans.md:123-142` (Usage section)

**Description:** The concept of markdown plans vs status.json as source of truth is explained three times with redundant paragraphs.

**Recommendation:** Create shared "Plan System Overview" section, reference it from all documents.

---

## Bugs & Issues

### 1. ARCHITECTURE.md Documents Wrong Project

**Location:** `docs/ARCHITECTURE.md:1-898`

**Severity:** High

**Description:** ARCHITECTURE.md is a comprehensive 898-line document describing "Idea-to-Code" - a Next.js frontend chat interface with WebSocket communication to Claude Code processes. This is NOT the dev_workflow project. The document covers:
- Next.js App Router implementation
- React component hierarchy
- WebSocket/Socket.IO protocol
- Zustand state management
- Phase system (understand, explore, define, build, validate, deliver)

The file belongs in a different repository and is out of scope for the dev_workflow system.

**Recommendation:** Remove or relocate to the Idea-to-Code project repository. Replace with actual dev_workflow architecture documentation.

---

### 2. Broken Relative Path References in ORCHESTRATOR.md

**Location:** `docs/ORCHESTRATOR.md:421-423`

**Severity:** Medium

**Description:** Links use `../docs/` path format:
```
- [Plan Commands](../docs/claude-commands/) - `/plan:*` command reference
- [Plan Templates](../docs/plan-templates/) - Creating new plans
- [Architecture](../docs/architecture/) - System design documentation
```

These resolve incorrectly because ORCHESTRATOR.md is already in `/docs/`. Correct paths should be relative (e.g., `claude-commands/`) or absolute (e.g., `/docs/claude-commands/`).

**Recommendation:** Update to relative paths without `../docs/` prefix: `./claude-commands/`, `./plan-templates/`, `./architecture/`.

---

### 3. Outdated Path References in artifact-compatibility-matrix.md

**Location:** `docs/architecture/artifact-compatibility-matrix.md:819-824`

**Severity:** Medium

**Description:** References use absolute filesystem paths instead of relative doc paths:
```
- Implementation Plan: /architect - `/home/benjamin/tools/dev_workflow/docs/plans/implement-architect-command.md`
```

These paths include the full user home directory and are not portable across machines or deployment environments.

**Recommendation:** Replace with relative paths from docs root: `../plans/implement-architect-command.md` or inline documentation format.

---

### 4. Inconsistent Terminology Across Documents

**Location:** Multiple files

**Severity:** Medium

**Description:** Three overlapping terms used inconsistently:
- "commands" (in claude-commands, command-dependency-graph): Refers to `/architect`, `/design`, `/spec`, etc.
- "plans" (in implementation-plans): Refers to markdown files in docs/plans/ that define tasks
- "artifacts" (in artifact-compatibility-matrix): Refers to outputs from commands (architecture.md, design-spec.md, etc.)

The term "implementation plan" is used to refer to plans in docs/plans/, but this conflicts with the broader concept of "implementation" as a command. Example from implementation-plans.md:

```
| Plan | Purpose | Key Sub-commands |
| `implement-architect-command` | System architecture (C4 Model) | system, components, data, deployment, adr |
```

This uses "Plan" to describe both the overall markdown document AND a sub-item that's actually an implementation plan for a command.

**Recommendation:** Standardize terminology:
- Use "command" only for `/architect`, `/design`, etc.
- Use "plan" only for markdown task files
- Use "sub-command" for `/architect:adr`, `/design:api`, etc.
- Define terminology glossary in shared "Concepts" document

---

### 5. Incomplete ADR Location Reference

**Location:** `docs/architecture/artifact-compatibility-matrix.md:193`

**Severity:** Low

**Description:** References ADR location as:
```
**Location:** `docs/architecture/adr/NNNN-decision-name.md`
```

But the actual ADRs referenced in the project don't appear to be stored in this location. The document describes producing ADRs but doesn't provide guidance on where they should be stored or how they're discovered.

**Recommendation:** Verify ADR storage location and update documentation accordingly, or clarify that this is a template location for future use.

---

### 6. Missing Artifact Schema Validation Documentation

**Location:** `docs/architecture/artifact-compatibility-matrix.md:780-802`

**Severity:** Low

**Description:** Section "Validation Checklist" (lines 780-802) provides a validation checklist for artifact producers and consumers, but doesn't explain WHERE or HOW validation occurs (is it automated? manual? pre-commit?).

**Recommendation:** Add implementation details on artifact validation mechanisms.

---

## Inconsistencies

### 1. status.json Field Naming Conventions

**Files:** `docs/ORCHESTRATOR.md`, `docs/architecture/orchestrator-system.md`

**Description:** Field naming is inconsistent in comments vs actual schema:
- Line 271-281 of orchestrator-system.md shows "status" field values: `pending | in_progress | completed | failed | skipped`
- Line 263 shows "lastError" vs "lastErrorAt" - inconsistent camelCase usage
- Task duration field called "duration" but isn't consistently documented as milliseconds in all places

**Recommendation:**
1. Add field documentation table with type and description
2. Clarify that all timestamp fields use ISO-8601 format
3. Clarify that duration is always in milliseconds
4. Provide example task object

---

### 2. Artifact Metadata Field Inconsistency

**Files:** `docs/architecture/artifact-compatibility-matrix.md`

**Description:** Different artifact types show different metadata field patterns:
- `architecture.md` frontmatter (lines 54-56): `status: draft | in-review | approved | deprecated`
- `design-spec.md` frontmatter (lines 259): `status: draft | in-review | approved`
- Components in `components.json` (lines 95-102): No status field mentioned

Some artifacts include `related_artifacts` (lines 261-264) while others don't.

**Recommendation:** Create standardized artifact metadata schema that all artifact types must follow.

---

### 3. Retry Logic Naming Inconsistency

**Files:** `docs/ORCHESTRATOR.md:187`, `docs/architecture/orchestrator-system.md:314-315`

**Description:**
- ORCHESTRATOR.md uses: `mark-failed --error`, `increment-retry`
- orchestrator-system.md uses: `retryCount` field

Inconsistent naming between CLI command names and JSON field names makes it unclear if they refer to the same concept.

**Recommendation:** Add mapping table showing CLI command ↔ status.json field relationships.

---

### 4. Command Naming Convention Inconsistency

**Files:** `docs/architecture/command-dependency-graph.md`, `docs/implementation-plans.md`

**Description:**
- command-dependency-graph.md uses: `/architect`, `/design`, `/spec` (with forward slash)
- implementation-plans.md uses: `implement-architect-command`, `implement-design-command` (without slash, with "implement-" prefix)

These refer to the same commands but with different naming conventions.

**Recommendation:** Establish single naming convention and use consistently across all docs:
- `/architect` for command references (how users invoke it)
- `implement-architect-command` for plan names (how it's documented as an implementation task)

---

### 5. File Structure Formatting Inconsistency

**Files:** `docs/ARCHITECTURE.md:82-130` vs `docs/architecture/orchestrator-system.md:106-125`

**Description:**
- ARCHITECTURE.md shows project structure with tree format including `idea-to-code/` root
- orchestrator-system.md shows file system structure starting with `docs/plans/<plan-name>.md`

These represent completely different project structures, creating confusion about what is being documented.

**Recommendation:** Clearly separate "Idea-to-Code project structure" (if needed) from "dev_workflow project structure" with explicit section headers.

---

## Unused/Orphaned

### 1. Idea-to-Code Architecture (Entire ARCHITECTURE.md)

**Location:** `docs/ARCHITECTURE.md`

**Description:** This 898-line document comprehensively documents an "Idea-to-Code" system with:
- Next.js frontend with React components
- WebSocket/Socket.IO real-time communication
- Zustand state management
- 6-phase workflow (understand, explore, define, build, validate, deliver)
- Chat interface implementation

This is a complete application architecture that does NOT match the dev_workflow CLI system being documented in other files. The file appears to be from a different project and mistakenly placed in this repository.

**Recommendation:**
1. Verify if Idea-to-Code is meant to be part of this repository
2. If yes: Clarify relationship to dev_workflow system in introduction
3. If no: Move to appropriate repository or remove entirely
4. If kept: Update references from other docs that incorrectly link to it

---

### 2. Unused Plan Templates Directory

**Location:** `docs/plan-templates/`

**Description:** Directory contains 15+ template files but is not referenced in:
- ORCHESTRATOR.md (mentions "plan templates" at line 422 but doesn't explain how to use them)
- implementation-plans.md (doesn't mention templates)
- command-dependency-graph.md

The templates appear to be duplicate copies of the actual plans but prefixed with "implement-" (e.g., `implement-artifact-registry.md` template for the actual plan).

**Recommendation:**
1. Document purpose of plan-templates/ directory
2. Clarify difference between templates and actual plans
3. Add to ORCHESTRATOR.md under "Related Documentation"
4. Document how users should interact with templates

---

### 3. Partial/Incomplete Architecture Review Findings

**Location:** `docs/plan-outputs/architecture-review/findings/` (12+ files)

**Description:** Contains detailed analysis outputs (01-discovery.md through 12-3-executive-summary.md) but many are not referenced in the core documentation:
- findings/09-workflows.md (workflow patterns)
- findings/10-agents-hooks.md (agent designs)
- findings/11-roadmap.md (implementation roadmap)

These contain important information not captured in the main docs but are scattered across individual finding files.

**Recommendation:**
1. Consider consolidating high-value findings into core documentation
2. Create index of findings with summaries
3. Link from implementation-plans.md to relevant findings
4. Clean up findings that are fully superseded by newer docs

---

### 4. Disconnected Standards Documents

**Location:** `docs/standards/`

**Description:** Contains 3 standards documents:
- `artifact-type-registry.md` (partially referenced in artifact-compatibility-matrix.md line 824)
- `implementation-plan-standards.md` (not referenced anywhere)
- `subcommand-naming-reference.md` (not referenced in core docs)

These define important standards but have minimal integration with the main architectural documentation.

**Recommendation:**
1. Create "Standards & Conventions" section in main documentation
2. Link to all standards documents
3. Include standards checklist in implementation-plans.md
4. Update artifact-compatibility-matrix.md to reference artifact-type-registry.md in introduction

---

### 5. Orphaned claude-commands Documentation

**Location:** `docs/claude-commands/`

**Description:** Contains 2 files:
- `ARCHITECTURE.md` (100 lines, describes script layer and template system)
- `SCRIPTS.md` (200+ lines, comprehensive script reference)

These document the scripts/ directory but are only partially referenced:
- ORCHESTRATOR.md line 421 mentions "Plan Commands" but links to `../docs/claude-commands/`
- No reference from ARCHITECTURE.md or implementation-plans.md
- command-dependency-graph.md doesn't explain how scripts relate to commands

**Recommendation:**
1. Clarify relationship between:
   - `/plan:*` CLI commands (from Plan Orchestrator system)
   - `node scripts/` JavaScript commands
   - `/architect`, `/design`, etc. AI commands
2. Add "Tools & Scripts" section to main documentation
3. Fix cross-references

---

## Summary of Recommendations by Priority

### Critical (Fix First)

1. **Remove or relocate ARCHITECTURE.md** - Documents wrong project
2. **Consolidate duplicate status.json documentation** - Reduces confusion
3. **Fix relative path references** - Ensures links work correctly
4. **Standardize artifact metadata schema** - Prevents implementation errors

### High (Fix Soon)

5. **Create terminology glossary** - Clarify "command" vs "plan" vs "artifact"
6. **Consolidate duplicate artifact flow diagrams** - Single source of truth
7. **Clarify Idea-to-Code vs dev_workflow relationship** - Addresses scope confusion
8. **Document all standards in core docs** - Central reference

### Medium (Fix When Possible)

9. **Create artifacts validation mechanism docs** - Complete implementation guidance
10. **Index and cross-link findings** - Improve discoverability
11. **Document scripts vs commands relationship** - Clear separation of concerns
12. **Update ADR storage location** - Ensure artifacts can be found

### Low (Nice to Have)

13. **Add field documentation tables** - Improve clarity
14. **Document retry logic mapping** - CLI ↔ JSON correlation
15. **Consolidate entry points documentation** - Single diagram format
16. **Create plan system overview** - Shared reference section

---

**Total Issues Found:** 21
- DRY Violations: 5
- Bugs/Issues: 6
- Inconsistencies: 5
- Unused/Orphaned: 5
