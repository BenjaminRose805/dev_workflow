# Task 2.4: Branch Naming Convention Analysis

## Overview

This analysis evaluates branch naming conventions for the git workflow integration in the plan orchestration system. The goal is to establish a clear, scalable naming pattern that supports plan isolation, team collaboration, phase sub-branches, archive branches, and integration with git tooling and CI/CD systems.

## Context & Requirements

### System Constraints

- **Primary strategy:** Branch-per-plan (isolation, PR workflow, clean rollback)
- **Plan names:** `analyze-git-workflow`, `implement-authentication`, `cleanup-deprecated-code`
- **Phase structure:** Plans contain 3-10 phases
- **User scenarios:** Solo developers, team developers, OSS contributors
- **Special branches:** Archive, backup, phase sub-branches

### Key Goals

1. **Clarity:** Branch name reveals purpose
2. **Discoverability:** Easy to find branches with `git branch` or GitHub UI
3. **Uniqueness:** Avoid conflicts between plans/users/types
4. **Tool compatibility:** Works with git, GitHub, GitLab, CI/CD systems
5. **Scalability:** Supports multiple plans, users, and long-term archiving

---

## 1. Pattern Evaluation: `{type}/{plan-name}`

### Structure

```
{type}/{plan-name}
```

Where:
- `{type}`: Category prefix (e.g., `plan`, `feature`, `archive`, `backup`)
- `{plan-name}`: Kebab-case plan identifier

### Examples

```bash
# Active plan branches
plan/analyze-git-workflow
plan/implement-authentication
plan/cleanup-deprecated-code

# Archive branches
archive/analyze-git-workflow

# Backup branches
backup/analyze-git-workflow-2024-12-24
```

### Advantages

| Benefit | Impact |
|---------|--------|
| **Git-flow compatibility** | Matches industry standard (`feature/`, `bugfix/`) |
| **Namespace organization** | Type prefix groups related branches |
| **GitHub/GitLab UI** | Branch dropdown organizes by type folder |
| **CI/CD pattern matching** | Easy to match `plan/*` for automated workflows |
| **Tab completion** | `git checkout plan/<TAB>` shows all plan branches |
| **Clear semantics** | `plan/` signals orchestrator-managed branch |

### Disadvantages

| Drawback | Impact | Severity |
|----------|--------|----------|
| **Generic prefix** | Doesn't distinguish dev, team, or purpose | Low |
| **No user attribution** | Can't see who owns branch in list | Medium (team) |
| **Two-level limit** | Hard to add sub-categories | Medium |

### Git Commands

```bash
# List all plan branches
git branch -a | grep 'plan/'

# Checkout specific plan
git checkout plan/analyze-git-workflow

# Create new plan branch
git checkout -b plan/implement-auth

# Delete completed plan
git branch -D plan/implement-auth
```

### CI/CD Integration

```yaml
# .github/workflows/plan-tests.yml
on:
  push:
    branches:
      - 'plan/**'  # Match all plan branches
```

### Recommendation

**RECOMMENDED** as primary pattern.

---

## 2. Pattern Evaluation: `{plan-name}/phase-{N}`

### Structure

```
{plan-name}/phase-{N}
```

### Examples

```bash
# Plan branch
implement-authentication

# Phase sub-branches
implement-authentication/phase-0
implement-authentication/phase-1
implement-authentication/phase-2
```

### Advantages

| Benefit | Impact |
|---------|--------|
| **Hierarchical clarity** | Parent/child relationship visible |
| **Phase isolation** | Each phase can be developed independently |
| **Natural nesting** | Matches mental model |

### Disadvantages

| Drawback | Impact | Severity |
|----------|--------|----------|
| **Branch explosion** | 5-phase plan = 1 + 5 branches | Medium |
| **Management overhead** | Create, merge, delete 5+ branches | High |
| **Orphaned branches** | Phase branches left behind | High |

### Recommendation

**NOT RECOMMENDED** as default. Use **phase tags** instead:

```bash
git tag plan/implement-auth/phase-1-complete
```

---

## 3. Alternative Patterns

### 3.1 Flat Pattern: `plan-{plan-name}`

**Examples:**
```bash
plan-analyze-git-workflow
archive-analyze-git-workflow
```

**Recommendation:** NOT RECOMMENDED. Modern git workflows use namespacing.

### 3.2 Namespaced Pattern: `plans/{plan-name}`

**Comparison: `plan/` vs `plans/`**

| Aspect | `plan/` | `plans/` |
|--------|---------|----------|
| Length | 5 chars | 6 chars |
| Semantics | Singular | Plural |
| Industry standard | Common | Less common |

**Recommendation:** USE `plan/` (singular) to match git-flow conventions.

### 3.3 User-Prefixed Pattern: `user/{username}/{type}/{plan-name}`

**Examples:**
```bash
user/alice/plan/implement-auth
user/bob/plan/add-logging
```

**Recommendation:** NOT RECOMMENDED as default. Consider for team workflows only.

---

## 4. Special Branch Purposes

### 4.1 Archive Branches

**Purpose:** Preserve completed plan's granular history after squash merge.

**Recommendation:** **Use tags, not branches:**

```bash
git tag archive/plan-implement-auth plan/implement-auth
git log archive/plan-implement-auth  # View granular history
```

**Rationale:**
- Tags are immutable (better for archives)
- Tags don't clutter `git branch` output
- Tags can be garbage-collected with expiry policy

### 4.2 Backup Branches

**Purpose:** Create safety checkpoint before destructive operations.

**Recommendation:** **Use timestamped tags:**

```bash
git tag "backup/$(date +%Y-%m-%d-%H%M%S)" HEAD
```

### 4.3 Phase Sub-Branches

**Purpose:** Isolate phase work for verification gates.

**Recommendation:** **Use phase tags on plan branch (default):**

```bash
git tag plan/implement-auth/phase-1-complete
```

**Use phase sub-branches (opt-in for high-risk plans):**

```bash
plan/implement-auth/phase-1
```

---

## 5. Git Tooling Integration

### GitHub/GitLab UI

GitHub groups branches by slash-separated prefix:

```
▼ plan (3)
  - analyze-git-workflow
  - implement-auth
  - cleanup-deprecated-code
▼ archive (2)
  - analyze-git-workflow
  - implement-auth
```

**Winner:** `{type}/{name}` pattern provides visual grouping.

### CI/CD Pattern Matching

**GitHub Actions:**
```yaml
on:
  push:
    branches:
      - 'plan/**'
      - '!archive/**'
```

**GitLab CI:**
```yaml
only:
  - /^plan\/.*/
```

### Branch Protection

```
Pattern: plan/*
Require PR before merge: true
Require status checks: true
```

---

## 6. Comparison Table

| Pattern | Clarity | Discoverability | Scalability | Git Tools | CI/CD | Recommendation |
|---------|---------|----------------|-------------|-----------|-------|----------------|
| `{type}/{plan-name}` | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | **PRIMARY** |
| `plan-{plan-name}` | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | Not recommended |
| `plans/{plan-name}` | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | Alternative |
| `user/{user}/{type}/{plan}` | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐⭐ | Team-only |

---

## 7. Recommendation & Specification

### 7.1 Primary Convention

**Use `{type}/{plan-name}` pattern:**

```
plan/{plan-name}            # Active plan work
archive/{plan-name}         # Archive tags (not branches)
backup/{timestamp}          # Temporary backup tags
```

### 7.2 Naming Rules

**Plan branches:**

```
Format: plan/{plan-name}

Rules:
- Prefix: "plan/" (4 chars)
- Plan name: Kebab-case, alphanumeric + hyphens
- Max length: 50 chars
- No uppercase, spaces, or special chars

Valid:
  plan/analyze-git-workflow
  plan/implement-auth
  plan/fix-bug-123

Invalid:
  plan/Analyze_Git_Workflow  (uppercase, underscores)
  plan/implement auth        (spaces)
```

**Archive tags:**

```
Format: archive/plan-{plan-name}

Example:
  git tag archive/plan-analyze-git-workflow plan/analyze-git-workflow
```

**Backup tags:**

```
Format: backup/{timestamp}

Example:
  git tag backup/20241224-143022
```

**Phase tags:**

```
Format: plan/{plan-name}/phase-{N}-{status}

Examples:
  plan/implement-auth/phase-0-complete
  plan/implement-auth/phase-1-complete
```

### 7.3 Reserved Prefixes

Do not use these prefixes for plan names:

```
archive/   # Archive tags
backup/    # Backup tags
release/   # Release branches
hotfix/    # Hotfix branches
main       # Main branch
master     # Master branch
```

---

## 8. Git Command Reference

### Branch Operations

```bash
# Create plan branch
git checkout -b plan/analyze-git-workflow

# List all plan branches
git branch -a | grep 'plan/'

# Switch between plans
git checkout plan/implement-auth

# Delete completed plan
git branch -D plan/analyze-git-workflow
```

### Archive Operations

```bash
# Create archive tag
git tag archive/plan-analyze-git-workflow plan/analyze-git-workflow

# List all archives
git tag -l 'archive/*'

# View archive history
git log archive/plan-analyze-git-workflow

# Restore file from archive
git checkout archive/plan-analyze-git-workflow -- path/to/file.js
```

### Backup Operations

```bash
# Create backup
git tag "backup/$(date -u +%Y%m%d-%H%M%S)"

# List backups
git tag -l 'backup/*'

# Restore from backup
git reset --hard backup/20241224-143022
```

---

## 9. Summary

### Final Recommendation

**PRIMARY CONVENTION: `plan/{plan-name}`**

- **Active plans:** `plan/analyze-git-workflow`
- **Archives:** `archive/plan-{plan-name}` (tags, not branches)
- **Backups:** `backup/{timestamp}` (tags)
- **Phases:** `plan/{plan-name}/phase-{N}-complete` (tags by default)

**Rationale:**
- Industry-standard pattern (git-flow)
- Excellent tool support (GitHub, GitLab, CI/CD)
- Scalable (10-100+ plans)
- Clear semantics (type prefix)
- Configurable (semantic types, user prefixes, phase isolation)

### Implementation Priority

**Phase 1 (MVP):**
- Implement `plan/{plan-name}` branch creation in `/plan:set`
- Archive tag creation in `/plan:complete`
- Phase tags in `/plan:batch`

**Phase 2 (Enhanced):**
- Configurable branch prefix
- Automated archive tag cleanup (90-day retention)
- Phase sub-branch support (opt-in)

**Phase 3 (Team Features):**
- User prefix support (team mode)
- Branch protection rule templates
- CI/CD configuration generator

### Success Metrics

- Branch discovery time < 5 seconds
- Zero branch name conflicts
- CI/CD integration works with simple glob patterns
- GitHub/GitLab UI groups branches logically
- Archive recovery possible 90+ days after plan completion
