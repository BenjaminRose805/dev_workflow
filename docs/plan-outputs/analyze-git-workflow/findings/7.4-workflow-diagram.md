# Task 7.4: Visual Workflow Diagram

## Overview

This document provides visual representations of the recommended git workflow for the plan orchestration system. Diagrams are rendered in ASCII art for maximum compatibility.

---

## 1. Primary Workflow: Hybrid A (Branch-Per-Plan + Squash)

### High-Level Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      RECOMMENDED GIT WORKFLOW (HYBRID A)                    │
│         Branch-Per-Plan + Commit-Per-Task + Squash Merge                    │
└─────────────────────────────────────────────────────────────────────────────┘

                                    main
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             │                             │
   ┌─────────┐                        │                        ┌─────────┐
   │ Plan A  │                        │                        │ Plan B  │
   │ Branch  │                        │                        │ Branch  │
   └────┬────┘                        │                        └────┬────┘
        │                             │                             │
        │ Task commits                │                             │
        │   task 1.1                  │                             │
        │   task 1.2                  │                             │
        │   task 1.3                  │                             │
        │   ...                       │                             │
        │                             │                             │
        ▼                             ▼                             │
   ┌─────────┐                   ┌─────────┐                        │
   │ SQUASH  │──────────────────▶│  Plan A │                        │
   │ MERGE   │                   │ (1 commit)                       │
   └─────────┘                   └────┬────┘                        │
        │                             │                             │
        │ Archive tag:                │                             │
        │ archive/plan-A              │                             │
        │ (preserves task commits)    │                             │
        ▼                             ▼                             ▼
   ┌─────────────────────────────────────────────────────────────────┐
   │                           main branch                           │
   │  ──●──────────────────────●──────────────────────────●──────▶  │
   │    │                      │                          │          │
   │ Initial              Plan A                     Plan B          │
   │                    (squashed)                 (squashed)        │
   └─────────────────────────────────────────────────────────────────┘
```

### Detailed Lifecycle

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                           PLAN EXECUTION LIFECYCLE                        ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║  ┌──────────────────────────────────────────────────────────────────┐     ║
║  │ PHASE 1: PLAN START                                              │     ║
║  │                                                                  │     ║
║  │   /plan:set implement-auth                                       │     ║
║  │                    │                                             │     ║
║  │                    ▼                                             │     ║
║  │   git checkout -b plan/implement-auth                            │     ║
║  │                    │                                             │     ║
║  │                    ▼                                             │     ║
║  │   Initialize status.json                                         │     ║
║  └──────────────────────────────────────────────────────────────────┘     ║
║                                                                           ║
║                         │                                                 ║
║                         ▼                                                 ║
║                                                                           ║
║  ┌──────────────────────────────────────────────────────────────────┐     ║
║  │ PHASE 2: TASK EXECUTION (repeat for each task)                   │     ║
║  │                                                                  │     ║
║  │   /plan:implement 1.1                                            │     ║
║  │            │                                                     │     ║
║  │            ▼                                                     │     ║
║  │   ┌─────────────────────────────────────────────────────────┐    │     ║
║  │   │ Execute Task                                            │    │     ║
║  │   │   • Modify files                                        │    │     ║
║  │   │   • Create files                                        │    │     ║
║  │   │   • Run tests                                           │    │     ║
║  │   └──────────────────────────┬──────────────────────────────┘    │     ║
║  │                              │                                   │     ║
║  │                              ▼                                   │     ║
║  │   ┌─────────────────────────────────────────────────────────┐    │     ║
║  │   │ Auto-Commit                                             │    │     ║
║  │   │   git add -A                                            │    │     ║
║  │   │   git commit -m "task 1.1: Create auth middleware"      │    │     ║
║  │   └──────────────────────────┬──────────────────────────────┘    │     ║
║  │                              │                                   │     ║
║  │                              ▼                                   │     ║
║  │   Update status.json with commit SHA                             │     ║
║  │                                                                  │     ║
║  │   ┌─────────────────────────────────────────────────────────┐    │     ║
║  │   │ Phase Boundary (after VERIFY task):                     │    │     ║
║  │   │   git tag plan/implement-auth/phase-1                   │    │     ║
║  │   └─────────────────────────────────────────────────────────┘    │     ║
║  └──────────────────────────────────────────────────────────────────┘     ║
║                                                                           ║
║                         │                                                 ║
║                         ▼                                                 ║
║                                                                           ║
║  ┌──────────────────────────────────────────────────────────────────┐     ║
║  │ PHASE 3: PLAN COMPLETION                                         │     ║
║  │                                                                  │     ║
║  │   /plan:complete                                                 │     ║
║  │            │                                                     │     ║
║  │            ├──▶ Verify all tasks complete                        │     ║
║  │            │                                                     │     ║
║  │            ├──▶ git tag archive/plan-implement-auth              │     ║
║  │            │         (preserve granular history)                 │     ║
║  │            │                                                     │     ║
║  │            ├──▶ git checkout main                                │     ║
║  │            │                                                     │     ║
║  │            ├──▶ git merge --squash plan/implement-auth           │     ║
║  │            │                                                     │     ║
║  │            ├──▶ git commit -m "Plan: implement-auth (squashed)"  │     ║
║  │            │                                                     │     ║
║  │            └──▶ git branch -D plan/implement-auth                │     ║
║  │                      (branch deleted, tag preserved)             │     ║
║  └──────────────────────────────────────────────────────────────────┘     ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 2. Branch and Tag Structure

### During Plan Execution

```
                    BRANCH/TAG STRUCTURE (DURING EXECUTION)
                    ========================================

main                    plan/implement-auth
  │                            │
  │                            ├── task 1.1: Create auth structure
  │                            │
  │                            ├── task 1.2: Add user model
  │                            │
  │                            ├── task 1.3: Create JWT middleware
  │                            │
  │                            ├──[TAG: plan/implement-auth/phase-1]
  │                            │
  │                            ├── task 2.1: Add login endpoint
  │                            │
  │                            ├── task 2.2: Add logout endpoint
  │                            │
  │                            └── task 2.3: Add session management
  │                                 │
  │                                 └──[TAG: plan/implement-auth/phase-2]
  │
  │ (main unchanged during plan execution)
  │
```

### After Plan Completion

```
                    BRANCH/TAG STRUCTURE (AFTER COMPLETION)
                    ========================================

main
  │
  ├── Previous commits...
  │
  └── Plan: implement-auth (squashed)   ◀── Single commit on main
           │
           │
           └──[TAG: archive/plan-implement-auth]
                     │
                     │   (Tag points to original branch history)
                     │
                     ├── task 1.1: Create auth structure
                     ├── task 1.2: Add user model
                     ├── task 1.3: Create JWT middleware
                     ├──[TAG: plan/implement-auth/phase-1]
                     ├── task 2.1: Add login endpoint
                     ├── task 2.2: Add logout endpoint
                     └── task 2.3: Add session management


  Note: Branch "plan/implement-auth" is DELETED
        Tag "archive/plan-implement-auth" preserves access to granular history
```

---

## 3. Rollback Scenarios

### Task-Level Rollback (During Execution)

```
                    TASK ROLLBACK (DURING EXECUTION)
                    ================================

BEFORE:                                    AFTER:
plan/implement-auth                        plan/implement-auth
        │                                          │
        ├── task 1.1 ✓                             ├── task 1.1 ✓
        │                                          │
        ├── task 1.2 ✓                             ├── task 1.2 ✓
        │                                          │
        ├── task 1.3 ✗ (bug!)       ────▶          ├── task 1.3 ✗ (reverted)
        │              │                           │
        ├── task 1.4 ✓ │                           ├── task 1.4 ✓
        │              │                           │
        └── task 1.5 ✓ │                           ├── task 1.5 ✓
                       │                           │
                       │                           └── Revert "task 1.3"
                       │
             git revert <task-1.3-commit>

  Note: Tasks 1.4 and 1.5 PRESERVED
        Only task 1.3 is undone
        Revert commit added to history
```

### Plan-Level Rollback (Not Yet Merged)

```
                    PLAN ROLLBACK (BEFORE MERGE)
                    ============================

BEFORE:                                    AFTER:
main                                       main
  │                                          │
  └── (unchanged)                            └── (unchanged)

plan/implement-auth                        (branch DELETED)
        │
        ├── task 1.1
        ├── task 1.2                       All 15 commits discarded
        ├── ...                            Zero impact on main
        └── task 3.5


  Command: git checkout main
           git branch -D plan/implement-auth

  Result: Complete rollback, clean state
```

### Plan-Level Rollback (After Merge)

```
                    PLAN ROLLBACK (AFTER MERGE)
                    ===========================

BEFORE:                                    AFTER:
main                                       main
  │                                          │
  ├── Initial commit                         ├── Initial commit
  │                                          │
  ├── Plan: feature-A (squashed)             ├── Plan: feature-A (squashed)
  │                                          │
  └── Plan: implement-auth (squashed)        ├── Plan: implement-auth (squashed)
                      │                      │
                      │            ────▶     └── Revert "Plan: implement-auth"
                      │
           git revert <squash-commit>

  Note: Single revert undoes entire plan
        Granular history still in archive tag
```

---

## 4. Parallel Plan Workflow

```
                    PARALLEL PLAN EXECUTION
                    =======================

                              main
                                │
    ┌───────────────────────────┼───────────────────────────┐
    │                           │                           │
    ▼                           │                           ▼
plan/feature-A                  │                    plan/feature-B
    │                           │                           │
    ├── task 1.1               │                           ├── task 1.1
    ├── task 1.2    ◀──────────┼── Context switch ─────────▶    (paused)
    │               │           │                           │
    │   (working)   │           │                           │
    │               │           │                           │
    │               │           │                           ├── task 1.2
    ├── task 1.3    │           │                           ├── task 1.3
    │               │           │                           │   (working)
    │               │           │                           │
    │               │           │                           │
    │               ▼           │                           │
    │         COMPLETE          │                           │
    │               │           │                           │
    └───────────────┼───────────┤                           │
                    │           │                           │
                    ▼           ▼                           │
              ┌──────────────────────┐                      │
              │ Plan: feature-A      │                      │
              │ (merged to main)     │                      │
              └──────────────────────┘                      │
                                │                           │
                                │                           │
                                ▼                           ▼
                              main                    COMPLETE
                                │                           │
                                └───────────────────────────┘
                                              │
                                              ▼
                                ┌──────────────────────┐
                                │ Plan: feature-B      │
                                │ (merged to main)     │
                                └──────────────────────┘


  Benefits:
  • Each plan isolated on its own branch
  • Context switching via git checkout
  • No interference between plans
  • Merge order independent of start order
```

---

## 5. Complete Git Graph Example

```
                    GIT GRAPH AFTER MULTIPLE PLANS
                    ==============================

main
  │
  ●─────────────────────────────────────────────────────────────▶ (current)
  │                         │                   │
  │                         │                   │
  │                         │                   └── Plan: add-logging
  │                         │                         (squashed, 8 tasks)
  │                         │
  │                         └── Plan: refactor-api
  │                               (squashed, 12 tasks)
  │
  └── Plan: implement-auth
        (squashed, 15 tasks)


  Archive Tags (preserving granular history):
  ├── archive/plan-implement-auth ───▶ 15 task commits
  ├── archive/plan-refactor-api ───▶ 12 task commits
  └── archive/plan-add-logging ───▶ 8 task commits


  Compare to non-squashed history:
  (would show 35 task commits on main instead of 3 plan commits)
```

---

## 6. Command Quick Reference

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         COMMAND QUICK REFERENCE                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  START PLAN                                                                 │
│  ──────────                                                                 │
│  /plan:set my-plan          →  git checkout -b plan/my-plan                 │
│                                                                             │
│  EXECUTE TASK                                                               │
│  ────────────                                                               │
│  /plan:implement 1.1        →  Execute + git add -A + git commit            │
│                                                                             │
│  CHECK STATUS                                                               │
│  ────────────                                                               │
│  /plan:status               →  Show progress, branch, uncommitted changes   │
│                                                                             │
│  COMPLETE PLAN                                                              │
│  ─────────────                                                              │
│  /plan:complete             →  Archive tag + squash merge + delete branch   │
│  /plan:complete --merge commit  →  Preserve granular history on main        │
│                                                                             │
│  ROLLBACK                                                                   │
│  ────────                                                                   │
│  /plan:rollback task 1.3    →  git revert <commit> + update status          │
│  /plan:rollback phase 2     →  Revert phase commits + update status         │
│  /plan:rollback plan        →  Delete branch OR revert merge commit         │
│                                                                             │
│  ABANDON PLAN                                                               │
│  ────────────                                                               │
│  /plan:abandon              →  git checkout main + git branch -D plan/X     │
│                                                                             │
│  ACCESS GRANULAR HISTORY                                                    │
│  ───────────────────────                                                    │
│  git log archive/plan-X     →  View all task commits for completed plan     │
│  git checkout archive/plan-X -- file.js  →  Restore file from plan          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Alternative Workflow Diagrams

### Alternative A: Merge Commit (Audit-Heavy)

```
                    MERGE COMMIT WORKFLOW
                    =====================

main
  │
  ●───────────────────────────●───────────────────────────────▶
  │                           │\
  │                           │ \
  │                           │  ●── task 1.5
  │                           │  │
  │                           │  ●── task 1.4
  │                           │  │
  │                           │  ●── task 1.3
  │                           │  │
  │                           │  ●── task 1.2
  │                           │  │
  │                           │  ●── task 1.1
  │                           │ /
  │                           │/
  └── (previous)              └── Merge: Plan implement-auth
                                      │
                                      └── (all task commits visible
                                           from main via merge parent)

  Command: git merge --no-ff plan/implement-auth

  Note: History is NOISIER but task commits directly accessible on main
```

### Alternative B: Branch-Per-Phase

```
                    BRANCH-PER-PHASE WORKFLOW
                    =========================

main
  │
  └── plan/my-plan (plan branch)
           │
           ├── plan/my-plan/phase-1 (phase branch)
           │       │
           │       ├── task 1.1
           │       ├── task 1.2
           │       └── task 1.3
           │              │
           │              └── VERIFY 1 passes
           │                      │
           ├──────────────────────┘ (merge phase-1 to plan)
           │
           ├── plan/my-plan/phase-2 (phase branch)
           │       │
           │       ├── task 2.1
           │       ├── task 2.2
           │       └── task 2.3
           │              │
           │              └── VERIFY 2 passes
           │                      │
           └──────────────────────┘ (merge phase-2 to plan)
                    │
                    └── Complete: squash merge to main

  Note: 3-level hierarchy provides maximum phase isolation
        Use only for expensive verification or regulatory needs
```

---

## Summary

The visual diagrams above illustrate:

1. **Primary Workflow (Hybrid A):** Branch-per-plan with commit-per-task and squash merge
2. **Branch and Tag Structure:** How history is organized during and after execution
3. **Rollback Scenarios:** Task, phase, and plan level recovery options
4. **Parallel Execution:** How multiple plans can coexist
5. **Command Mapping:** What each orchestrator command does in git terms
6. **Alternative Workflows:** Visual representation of merge commit and branch-per-phase options

These diagrams provide a clear visual reference for understanding and implementing the recommended git workflow.
