# Task 6.4: .gitignore Updates for Git Workflow

## Executive Summary

The current `.gitignore` covers most needs but requires **additions** for git workflow integration. Key additions include orchestrator state files, recovery artifacts, and branch-related temp files.

**Current State:** Good foundation with `*.log`, `*.tmp`, `*.lock` already covered.

**Recommendation:** Add 5 new entries for git workflow safety.

---

## 1. Current .gitignore Analysis

### Existing Relevant Entries

```gitignore
# Already covered - good!
*.log                              # Covers orchestrator.log ✓
*.tmp                              # Covers temp files ✓
*.temp                             # Covers temp files ✓
*.lock                             # Covers lock files ✓
docs/plan-outputs/*/status.json    # Status files (optional) ✓
docs/plan-outputs/*/status.json.bak # Backup files ✓
.claude/current-plan.txt           # Plan pointer ✓
```

### Gap Analysis

| File Type | Currently Ignored? | Risk if Committed |
|-----------|-------------------|-------------------|
| `orchestrator.log` | YES (*.log) | Low - redundant commit |
| `status.json` | Partially | Medium - stale state |
| State recovery files | NO | Medium - confusing history |
| Git operation temp | NO | High - corrupted state |
| Stash references | NO | Low - noise |

---

## 2. Recommended Additions

### 2.1 Orchestrator State Files

```gitignore
# Orchestrator runtime state (used for crash recovery)
.git/orchestrator-state.json
```

**Reason:** This file tracks in-progress operations for crash recovery. It should never be committed as it's session-specific and transient.

### 2.2 Branch Switching Temp Files

```gitignore
# Branch switching temporary files
.git/plan-switch-*
```

**Reason:** During plan switching, temporary files may be created to track state. These are implementation details, not project content.

### 2.3 Conflict Resolution Artifacts

```gitignore
# Conflict resolution backups created by git
*.orig
```

**Reason:** Git creates `.orig` files during merge conflict resolution. These are backup copies that shouldn't be committed.

### 2.4 Recovery Archive Files

```gitignore
# Plan recovery archives (created by /plan:recover)
.plan-recovery-*
```

**Reason:** Recovery operations may create archive files for safety. These are diagnostic artifacts, not project content.

### 2.5 Git Workflow Timestamps

```gitignore
# Timestamps directory (generated metadata)
docs/plan-outputs/*/timestamps/
```

**Reason:** Timestamp files track execution timing. They're useful for debugging but add noise to commits.

---

## 3. Files That Should NOT Be Ignored

### 3.1 Findings (Track These!)

```gitignore
# DON'T ignore findings - they're valuable output!
# docs/plan-outputs/*/findings/    # ❌ DON'T ADD THIS
```

**Reason:** Findings are the documented output of analysis tasks. They should be committed as project documentation.

### 3.2 Plan Files

```gitignore
# DON'T ignore plan definitions
# docs/plans/*.md                  # ❌ DON'T ADD THIS
```

**Reason:** Plan files are source documents that define work. They're essential project artifacts.

### 3.3 Status JSON (Debate)

The current `.gitignore` already has:

```gitignore
docs/plan-outputs/*/status.json
docs/plan-outputs/*/status.json.bak
```

**Options:**
1. **Keep ignored** (current) - Status is local execution state
2. **Remove from ignore** - Track progress in git history
3. **Add to .gitattributes** - Use merge strategy for conflicts

**Recommendation:** Keep ignored. Status is execution state, not source. Progress is better tracked via commits.

---

## 4. Updated .gitignore Section

### Proposed Addition

```gitignore
# =============================================================================
# Plan Orchestrator & Git Workflow
# =============================================================================

# Orchestrator log (TUI mode writes here)
orchestrator.log

# Crash recovery state (session-specific)
.git/orchestrator-state.json

# Branch switching temp files
.git/plan-switch-*

# Conflict resolution backups
*.orig

# Recovery archives
.plan-recovery-*

# Timestamps (generated metadata)
docs/plan-outputs/*/timestamps/

# Status tracking (execution state, not source)
docs/plan-outputs/*/status.json
docs/plan-outputs/*/status.json.bak
```

---

## 5. Files Currently In Repo

### Check for Files That Should Be Ignored

```bash
# Check for log files
ls -la *.log 2>/dev/null
# Found: orchestrator.log (0 bytes) - should be ignored

# Check for .orig files
find . -name "*.orig" 2>/dev/null
# None found currently

# Check for backup files
find docs/plan-outputs -name "*.bak" 2>/dev/null
# Found: 49 status.json.bak files - already in .gitignore
```

### Cleanup Recommendation

The `orchestrator.log` file exists but is empty and already covered by `*.log`. No cleanup needed.

---

## 6. .gitattributes Consideration

### Merge Strategy for Plan Files

```gitattributes
# Use union merge for concurrent plan progress
docs/plan-outputs/*/status.json merge=union

# Binary files
*.png binary
*.jpg binary
```

**Note:** This is optional. Only needed if status.json is ever tracked in git.

---

## 7. Implementation

### Option A: Minimal (Recommended)

Add only critical new entries:

```gitignore
# Git workflow additions
.git/orchestrator-state.json
*.orig
```

**Effort:** 5 minutes

### Option B: Comprehensive

Add all recommended entries as a new section:

```gitignore
# =============================================================================
# Plan Orchestrator & Git Workflow
# =============================================================================

# Crash recovery state
.git/orchestrator-state.json

# Branch switching temp files
.git/plan-switch-*

# Conflict resolution backups
*.orig

# Recovery archives
.plan-recovery-*

# Timestamps
docs/plan-outputs/*/timestamps/
```

**Effort:** 10 minutes

---

## 8. Verification Commands

After updating `.gitignore`:

```bash
# Check what would be ignored
git status --ignored

# Verify new patterns work
echo "test" > test.orig
git status  # Should not show test.orig
rm test.orig

# Check for any files that should be ignored
git ls-files --others --ignored --exclude-standard
```

---

## 9. Summary

### Changes Required

| Entry | Priority | Reason |
|-------|----------|--------|
| `.git/orchestrator-state.json` | HIGH | Crash recovery state |
| `*.orig` | HIGH | Conflict resolution artifacts |
| `.git/plan-switch-*` | MEDIUM | Branch switching temp |
| `.plan-recovery-*` | LOW | Recovery archives |
| `docs/plan-outputs/*/timestamps/` | LOW | Generated metadata |

### Already Covered

| Entry | Pattern | Status |
|-------|---------|--------|
| Log files | `*.log` | ✓ Covered |
| Temp files | `*.tmp`, `*.temp` | ✓ Covered |
| Lock files | `*.lock` | ✓ Covered |
| Status backups | `*.bak` | ✓ Covered |
| Plan pointer | `.claude/current-plan.txt` | ✓ Covered |

### Final Recommendation

Add these 2 critical entries to `.gitignore`:

```gitignore
# Git workflow recovery state
.git/orchestrator-state.json

# Conflict resolution backups
*.orig
```

**Estimated Effort:** 5 minutes to update, 10 minutes to verify.
