# Task 2.3: CLI/TUI Features to Implementation Files Mapping

## Overview

This document maps each CLI/TUI feature to its implementation file(s), providing a comprehensive reference for understanding where functionality is implemented.

## Feature-to-File Mapping

### Plan Skills (Claude Code Commands)

| Feature | Files | Location |
|---------|-------|----------|
| `/plan:status` | `status.md` | `.claude/commands/plan/status.md` |
| `/plan:implement` | `implement.md` | `.claude/commands/plan/implement.md` |
| `/plan:orchestrate` | `orchestrate.md` | `.claude/commands/plan/orchestrate.md` |
| `/plan:batch` | `batch.md` | `.claude/commands/plan/batch.md` |
| `/plan:verify` | `verify.md` | `.claude/commands/plan/verify.md` |
| `/plan:set` | `set.md` | `.claude/commands/plan/set.md` |
| `/plan:create` | `create.md` | `.claude/commands/plan/create.md` |
| `/plan:templates` | `templates.md` | `.claude/commands/plan/templates.md` |
| `/plan:split` | `split.md` | `.claude/commands/plan/split.md` |
| `/plan:explain` | `explain.md` | `.claude/commands/plan/explain.md` |
| `/plan:archive` | `archive.md` | `.claude/commands/plan/archive.md` |
| `/plan:complete` | `complete.md` | `.claude/commands/plan/complete.md` |
| `/plan:cleanup` | `cleanup.md` | `.claude/commands/plan/cleanup.md` |
| `/plan:abandon` | `abandon.md` | `.claude/commands/plan/abandon.md` |
| `/plan:rollback` | `rollback.md` | `.claude/commands/plan/rollback.md` |
| `/plan:migrate` | `migrate.md` | `.claude/commands/plan/migrate.md` |
| `/plan:worktree` | `worktree.md` | `.claude/commands/plan/worktree.md` |
| Status tracking utilities | `status-tracking.md` | `.claude/commands/plan/_common/status-tracking.md` |
| Git utilities | `git-utilities.md` | `.claude/commands/plan/_common/git-utilities.md` |
| Uncommitted changes protection | `uncommitted-changes-protection.md` | `.claude/commands/plan/_common/uncommitted-changes-protection.md` |

### Node.js CLI Scripts

| Feature | Primary File | Supporting Files |
|---------|--------------|------------------|
| **Status Management** | | |
| Initialize status.json | `status-cli.js` | - |
| Mark task started | `status-cli.js` | - |
| Mark task complete | `status-cli.js` | - |
| Mark task failed | `status-cli.js` | - |
| Mark task skipped | `status-cli.js` | - |
| Get next tasks | `status-cli.js` | - |
| Show progress | `status-cli.js` | - |
| Validate status | `status-cli.js` | - |
| Dependency checking | `status-cli.js` | - |
| **Worktree Management** | | |
| Create worktree | `worktree-cli.js` | - |
| List worktrees | `worktree-cli.js` | - |
| Remove worktree | `worktree-cli.js` | - |
| Worktree context | `worktree-cli.js` | - |
| **API Server** | | |
| REST endpoints | `api-server.js` | - |
| WebSocket events | `api-server.js` | - |
| **Utilities** | | |
| Scan all plans | `scan-plans.js` | - |
| Parse plan structure | `parse-plan-structure.js` | - |
| Substitute template vars | `substitute-variables.js` | - |
| Validate plan format | `validate-plan-format.js` | - |
| Migrate completed plans | `migrate-completed-plan.js` | - |
| Cache clear | `cache-clear.js` | - |
| Cache stats | `cache-stats.js` | - |
| Check file status | `check-file-status.js` | - |

### Python CLI Scripts

| Feature | Primary File | Supporting Files |
|---------|--------------|------------------|
| **Orchestrator** | | |
| Plan execution | `plan_orchestrator.py` | `scripts/lib/claude_runner.py` |
| Daemon mode | `plan_orchestrator.py` | - |
| API server integration | `plan_orchestrator.py` | `orchestrator_server.py` |
| Instance management | `plan_orchestrator.py` | - |
| **Plan Switching** | | |
| Switch plan | `switch_plan.py` | - |
| List plans | `switch_plan.py` | - |
| Show current plan | `switch_plan.py` | - |
| **Monitoring** | | |
| Multi-plan monitor | `multi_plan_monitor.py` | - |
| Focus/split layout | `multi_plan_monitor.py` | - |
| **API** | | |
| HTTP server | `orchestrator_server.py` | - |
| Type generation | `generate_api_types.py` | - |
| Server runner | `run_api_server.py` | - |

### TUI Features

| Feature | Primary File | Supporting Modules |
|---------|--------------|-------------------|
| **Keyboard Input** | | |
| Non-blocking input | `tui/keyboard.py` | - |
| Vim-style navigation | `tui/keyboard.py` | - |
| Mode switching (Normal/Command/Search) | `tui/keyboard.py` | - |
| Key event queue | `tui/keyboard.py` | - |
| **Display Panels** | | |
| Phase progress panel | `tui/panels.py` | `PhaseProgressPanel` |
| Upcoming tasks panel | `tui/panels.py` | `UpcomingPanel` |
| Run history panel | `tui/panels.py` | `RunHistoryPanel` |
| Dependency graph panel | `tui/panels.py` | `DependencyGraphPanel` |
| Subtask tree panel | `tui/panels.py` | `SubtaskTreePanel` |
| Artifact browser panel | `tui/panels.py` | `ArtifactBrowserPanel` |
| Agent tracker panel | `tui/panels.py` | `AgentTrackerPanel` |
| **Command Palette** | | |
| Command discovery | `tui/command_palette.py` | Scans `.claude/commands/plan/` |
| Fuzzy search | `tui/command_palette.py` | - |
| Tab completion | `tui/command_palette.py` | - |
| **Task Selection** | | |
| Task picker modal | `tui/task_picker.py` | Uses `status-cli.js` |
| Multi-select support | `tui/task_picker.py` | - |
| Blocker display | `tui/task_picker.py` | - |
| **Task Actions** | | |
| Explain task (e key) | `tui/task_actions.py` | Invokes `/plan:explain` |
| Implement task (i key) | `tui/task_actions.py` | Invokes `/plan:implement` |
| Verify task (v key) | `tui/task_actions.py` | Invokes `/plan:verify` |
| Skip task (s key) | `tui/task_actions.py` | Calls `status-cli.js mark-skipped` |
| View findings (f key) | `tui/task_actions.py` | Reads from `findings/` |
| Show dependencies (d key) | `tui/task_actions.py` | Calls `status-cli.js check` |
| **Command Execution** | | |
| Run plan commands | `tui/command_runner.py` | Uses `scripts/lib/claude_runner.py` |
| Output streaming | `tui/command_runner.py` | - |
| Agent tracking | `tui/command_runner.py` | `AgentTracker` class |
| **Overlays** | | |
| Help overlay | `tui/overlays.py` | `HelpOverlay` |
| Overlay manager | `tui/overlays.py` | `OverlayManager` |
| **Error Handling** | | |
| Error catching | `tui/error_handler.py` | - |
| Error recovery | `tui/error_handler.py` | `ErrorRecovery` |
| Error notification | `tui/error_handler.py` | `ErrorNotifier` |
| **Configuration** | | |
| Load/save config | `tui/config.py` | - |
| Panel visibility | `tui/config.py` | - |
| Keybinding overrides | `tui/config.py` | - |
| **Findings Browser** | | |
| Browse findings | `tui/findings_browser.py` | Reads `docs/plan-outputs/<plan>/findings/` |

### Shared Libraries

| Feature | File | Used By |
|---------|------|---------|
| Claude session runner | `scripts/lib/claude_runner.py` | `plan_orchestrator.py`, `command_runner.py` |

## Feature to API Endpoint Mapping

| CLI/TUI Feature | Uses Endpoint | API Server File |
|-----------------|---------------|-----------------|
| Get plans | `GET /api/plans` | `api-server.js` |
| Get plan by name | `GET /api/plans/:name` | `api-server.js` |
| Get plan status | `GET /api/plans/:name/status` | `api-server.js` |
| Get orchestrators | `GET /api/orchestrators` | `api-server.js` |
| Get orchestrator by ID | `GET /api/orchestrators/:id` | `api-server.js` |
| Start orchestrator | `POST /api/orchestrators/start` | `api-server.js` |
| Pause orchestrator | `POST /api/orchestrators/:id/pause` | `api-server.js` |
| Resume orchestrator | `POST /api/orchestrators/:id/resume` | `api-server.js` |
| Stop orchestrator | `POST /api/orchestrators/:id/stop` | `api-server.js` |
| Get tasks | `GET /api/plans/:name/tasks` | `api-server.js` |
| Skip task | `POST /api/plans/:name/tasks/:id/skip` | `api-server.js` |
| Retry task | `POST /api/plans/:name/tasks/:id/retry` | `api-server.js` |
| Get findings | `GET /api/plans/:name/findings` | `api-server.js` |
| Get finding content | `GET /api/plans/:name/findings/:id` | `api-server.js` |
| Activity feed | `GET /api/activity` | `api-server.js` |
| Real-time updates | WebSocket `/ws` | `api-server.js` |

## CLI-Only Features (No API Endpoint)

| Feature | Implementation | Notes |
|---------|----------------|-------|
| Create plan | `/plan:create` | Template-based, no API |
| Edit plan file | Direct file editing | No API |
| Git commit | `/plan:implement` commit flow | Automatic commit per task |
| Git branch management | `/plan:set` | Branch per plan |
| Worktree management | `worktree-cli.js` | No API |
| Template listing | `/plan:templates` | No API |
| Plan archival | `/plan:archive` | No API |
| Plan rollback | `/plan:rollback` | No API |
| Plan cleanup | `/plan:cleanup` | No API |

## File Count Summary

| Category | File Count | Total LOC |
|----------|------------|-----------|
| Plan Skills (markdown) | 20 files | ~3,000 |
| Node.js scripts | 12 files | ~5,000 |
| Python scripts | 7 files | ~5,000 |
| TUI modules | 11 files | ~7,000 |
| **Total** | **50 files** | **~20,000** |

## Cross-Reference: Features by Implementation Type

### Claude Code Skills Only
- Plan creation from templates
- Task splitting
- Plan archival/cleanup
- Git branch management
- Worktree orchestration

### Node.js CLI Only
- Status tracking commands
- Plan parsing
- API server

### Python CLI Only
- Plan orchestrator execution
- Multi-plan monitoring
- Daemon mode

### TUI Only
- Interactive panels
- Keyboard navigation
- Command palette
- Visual overlays

### Both CLI and API
- Get/set status
- Start/stop orchestrator
- Skip/retry tasks
- View findings
