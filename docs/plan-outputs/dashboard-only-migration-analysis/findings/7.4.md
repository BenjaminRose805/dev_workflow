# Task 7.4: Risks and Mitigation Strategies

## Overview

This document provides a comprehensive risk assessment for the dashboard-only migration, categorizing risks by type, severity, and likelihood. Each risk includes specific mitigation strategies, early warning indicators, and contingency plans.

---

## Risk Assessment Framework

### Severity Levels

| Level | Description | Impact |
|-------|-------------|--------|
| **CRITICAL** | Migration cannot proceed; system unusable | Total workflow blockage |
| **HIGH** | Significant functionality loss | Major user impact, workarounds painful |
| **MEDIUM** | Noticeable degradation | Productivity impact, workarounds exist |
| **LOW** | Minor inconvenience | Minimal user impact |

### Likelihood Levels

| Level | Description | Probability |
|-------|-------------|-------------|
| **CERTAIN** | Will definitely occur | 90-100% |
| **LIKELY** | More likely than not | 60-89% |
| **POSSIBLE** | Could occur | 30-59% |
| **UNLIKELY** | Not expected | 10-29% |
| **RARE** | Very unlikely | <10% |

### Risk Score = Severity × Likelihood

---

## Category 1: Technical Risks

### 1.1 Hidden Dependencies

| Attribute | Value |
|-----------|-------|
| **Severity** | HIGH |
| **Likelihood** | POSSIBLE (40%) |
| **Risk Score** | 3.2/5 |
| **Phase Affected** | Cleanup phases |

**Description:**
Code being removed may have undiscovered dependencies from other parts of the system. Removing these files could break functionality in unexpected places.

**Warning Signs:**
- Import errors after cleanup
- Runtime exceptions referencing removed modules
- Test failures in unrelated areas

**Mitigation Strategies:**

1. **Pre-cleanup dependency audit**
   ```bash
   # Before removing any file, search for references
   for file in $(find scripts/tui -name "*.py"); do
     module=$(basename "$file" .py)
     echo "=== References to $module ==="
     grep -r "$module" scripts/ --include="*.py" --include="*.js"
   done
   ```

2. **Incremental removal with validation**
   - Remove one category at a time
   - Run full test suite after each removal
   - Deploy to staging before production

3. **Import tracking script**
   - Create script that logs all imports at runtime
   - Run for 1 week before cleanup to capture all usage patterns

**Contingency:**
- Git tags at each phase enable instant rollback
- Archive branch preserves all removed code
- Revert command: `git checkout v1.0-pre-[phase]`

---

### 1.2 API Server Performance Degradation

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | POSSIBLE (35%) |
| **Risk Score** | 2.1/5 |
| **Phase Affected** | P0/P1 feature additions |

**Description:**
Adding new endpoints (templates, implement, explain/verify) may overload the API server, especially with Claude session spawning.

**Warning Signs:**
- Response times >2 seconds
- Memory usage spikes
- Connection timeouts during peak usage

**Mitigation Strategies:**

1. **Rate limiting on expensive endpoints**
   ```javascript
   // Limit Claude-spawning endpoints
   app.use('/api/plans/:name/tasks/:id/implement',
     rateLimit({ windowMs: 60000, max: 5 })
   );
   ```

2. **Connection pooling for Claude sessions**
   - Queue implementation requests
   - Max 3 concurrent Claude sessions
   - Timeout and cleanup stale sessions

3. **Performance monitoring**
   - Add response time logging
   - Memory usage alerts
   - Load testing before deployment

**Contingency:**
- Disable expensive endpoints temporarily
- Fall back to orchestrator-only execution
- Add caching layer for explain requests

---

### 1.3 WebSocket Connection Stability

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | LIKELY (65%) |
| **Risk Score** | 2.6/5 |
| **Phase Affected** | Task Implementation, Output Streaming |

**Description:**
Real-time features depend on WebSocket connections that may drop, especially for long-running tasks.

**Warning Signs:**
- Progress stops updating
- Disconnect events in logs
- Users report "stuck" progress modals

**Mitigation Strategies:**

1. **Automatic reconnection with state recovery**
   ```javascript
   // Dashboard WebSocket client
   const ws = new ReconnectingWebSocket(url, null, {
     maxRetries: 10,
     reconnectInterval: 3000
   });

   ws.onopen = () => {
     // Request current state after reconnect
     ws.send({ type: 'sync', lastEventId: lastSeenId });
   };
   ```

2. **Heartbeat mechanism**
   - Server sends ping every 30 seconds
   - Client responds with pong
   - Disconnect if no pong within 10 seconds

3. **Fallback polling**
   - If WebSocket fails, poll `/api/status` every 5 seconds
   - Display "Live updates unavailable" warning

**Contingency:**
- Status.json polling as backup
- Refresh button to force state sync
- Email notification for task completion

---

### 1.4 Git Auto-Commit Conflicts

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | POSSIBLE (30%) |
| **Risk Score** | 1.8/5 |
| **Phase Affected** | Git Auto-Commit feature |

**Description:**
Auto-commits may conflict with manual git operations or concurrent task execution.

**Warning Signs:**
- Commit failures in logs
- Merge conflict messages
- Task completes but no commit appears

**Mitigation Strategies:**

1. **Git operation queue**
   ```python
   # Use lib/git-queue.js pattern
   git_lock = threading.Lock()

   def auto_commit_task(...):
       with git_lock:
           # Exclusive git operations
           subprocess.run(['git', 'add', '-A'])
           subprocess.run(['git', 'commit', '-m', message])
   ```

2. **Graceful failure handling**
   - Log warning but don't fail task
   - Queue failed commits for retry
   - Mark task as "completed (commit pending)"

3. **Conflict detection**
   - Check for uncommitted changes before task
   - Warn user if working directory dirty
   - Option to skip auto-commit per task

**Contingency:**
- Manual commit option in dashboard
- "Commit All Pending" bulk action
- Disable auto-commit via config

---

## Category 2: User Experience Risks

### 2.1 Workflow Disruption

| Attribute | Value |
|-----------|-------|
| **Severity** | HIGH |
| **Likelihood** | CERTAIN (95%) |
| **Risk Score** | 4.75/5 |
| **Phase Affected** | Plan Skills Removal |

**Description:**
Users relying on CLI/TUI commands will lose their established workflows when skills are removed.

**Warning Signs:**
- Support requests increase
- Negative feedback
- Users requesting CLI restoration

**Mitigation Strategies:**

1. **Extended parallel operation**
   - Keep CLI working for 4+ weeks after dashboard features complete
   - Allow users to transition at their own pace

2. **Comprehensive workflow mapping**
   - Document every CLI command → dashboard equivalent
   - Create video tutorials for new workflows
   - Provide CLI → API migration guide for automation

3. **Staged deprecation**
   - Week 1-2: Dashboard features live, no warnings
   - Week 3-4: Deprecation warnings in CLI
   - Week 5-6: Disable by default, `--enable-cli` flag
   - Week 7-8: Remove CLI code

4. **User feedback loop**
   - Survey users before removal
   - Track feature usage analytics
   - Hotline for migration support

**Contingency:**
- Re-enable CLI commands if adoption <50%
- Create "legacy mode" config option
- Archive branch for power users

---

### 2.2 Feature Parity Gaps Discovered Late

| Attribute | Value |
|-----------|-------|
| **Severity** | HIGH |
| **Likelihood** | LIKELY (60%) |
| **Risk Score** | 3.6/5 |
| **Phase Affected** | Migration Phase 2-3 |

**Description:**
Users may discover missing features that weren't identified in analysis, blocking their workflows.

**Warning Signs:**
- "How do I X in the dashboard?" questions
- Workaround requests
- Users refusing to migrate

**Mitigation Strategies:**

1. **Comprehensive feature audit with users**
   - Shadow 5+ users during typical workflows
   - Document every action they take
   - Compare against dashboard capabilities

2. **Beta testing period**
   - Invite power users to test dashboard-only mode
   - Collect detailed feedback
   - 2-week minimum beta before general rollout

3. **Fast-track feature implementation**
   - Reserve 20% capacity for discovered gaps
   - 1-week max response time for P0 gaps
   - Expedited review process for gap fixes

4. **Feature request channel**
   - Dedicated Slack/Discord channel
   - Weekly triage meeting
   - Transparent roadmap updates

**Contingency:**
- Pause migration if critical gap found
- Temporary CLI re-enable for specific features
- External tool integration as stopgap

---

### 2.3 Learning Curve Resistance

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | LIKELY (70%) |
| **Risk Score** | 2.8/5 |
| **Phase Affected** | All phases |

**Description:**
Users comfortable with CLI may resist learning new dashboard interface.

**Warning Signs:**
- Low dashboard adoption despite availability
- Complaints about "extra clicks"
- Requests for keyboard shortcuts

**Mitigation Strategies:**

1. **Keyboard-first design**
   - Vim-style navigation (j/k/Enter)
   - Command palette (Cmd+K)
   - Shortcut hints on hover

2. **Progressive disclosure**
   - Simple default view
   - Advanced options hidden but accessible
   - "Power User Mode" setting

3. **Training and documentation**
   - Interactive tutorial on first visit
   - Contextual help tooltips
   - Video walkthroughs

4. **Feature parity messaging**
   - "Same features, new interface"
   - Side-by-side comparison
   - Benefits of visual interface

**Contingency:**
- Add more keyboard shortcuts
- Create CLI-like command input in dashboard
- Allow both interfaces longer term

---

## Category 3: Data and Security Risks

### 3.1 Data Inconsistency

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | UNLIKELY (20%) |
| **Risk Score** | 1.0/5 |
| **Phase Affected** | All phases |

**Description:**
Status.json or findings files could become inconsistent between dashboard and backend operations.

**Warning Signs:**
- Progress percentages don't match
- Tasks show wrong status
- Findings missing from dashboard

**Mitigation Strategies:**

1. **Single source of truth**
   - All writes go through plan-status.js
   - Dashboard reads only, never writes directly
   - Orchestrator handles all status updates

2. **File locking**
   ```javascript
   // Use proper-lockfile package
   const release = await lockfile.lock(statusPath);
   try {
     // Update status.json
   } finally {
     await release();
   }
   ```

3. **Checksum validation**
   - Store SHA256 of status.json
   - Validate before/after updates
   - Alert on unexpected changes

**Contingency:**
- Re-initialize status.json from plan file
- Rebuild findings index
- Manual status reset tool

---

### 3.2 Authentication/Authorization Gaps

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | POSSIBLE (40%) |
| **Risk Score** | 2.0/5 |
| **Phase Affected** | Task Implementation feature |

**Description:**
Task implementation spawns Claude sessions that may have elevated permissions compared to dashboard user.

**Warning Signs:**
- Unauthorized file modifications
- Unexpected system commands
- Security audit failures

**Mitigation Strategies:**

1. **Sandboxed execution**
   - Claude sessions run in restricted environment
   - Limit file system access to plan directory
   - Block network access except to Claude API

2. **Action logging**
   - Log all tool calls
   - Audit trail for file modifications
   - Review capability for admins

3. **Confirmation for dangerous actions**
   - Prompt before destructive operations
   - Require explicit user approval
   - Timeout for unconfirmed actions

**Contingency:**
- Disable task implementation feature
- Require manual approval for each task
- Rollback unauthorized changes via git

---

## Category 4: Operational Risks

### 4.1 Migration Timeline Slip

| Attribute | Value |
|-----------|-------|
| **Severity** | LOW |
| **Likelihood** | LIKELY (75%) |
| **Risk Score** | 1.5/5 |
| **Phase Affected** | All phases |

**Description:**
Implementation takes longer than estimated, delaying migration completion.

**Warning Signs:**
- Tasks consistently take 1.5x estimated time
- Scope creep on features
- Bug fixes consuming sprint capacity

**Mitigation Strategies:**

1. **Buffer time in estimates**
   - Add 30% contingency to all estimates
   - 8-week timeline includes 2 weeks buffer
   - Prioritize MVP over polish

2. **Scope management**
   - Strict P0/P1/P2 prioritization
   - "Good enough" threshold for each feature
   - Defer P2+ to post-migration

3. **Progress tracking**
   - Daily standups during migration
   - Burndown chart visibility
   - Early warning if behind schedule

**Contingency:**
- Extend parallel operation period
- Defer less critical cleanup
- Deploy P0 features as complete

---

### 4.2 Resource Constraints

| Attribute | Value |
|-----------|-------|
| **Severity** | MEDIUM |
| **Likelihood** | POSSIBLE (50%) |
| **Risk Score** | 2.0/5 |
| **Phase Affected** | All phases |

**Description:**
Development resources may be pulled for other priorities during migration.

**Warning Signs:**
- Team members reassigned
- Sprint velocity drops
- Competing priorities

**Mitigation Strategies:**

1. **Executive commitment**
   - Migration as quarterly goal
   - Protected capacity allocation
   - Stakeholder buy-in documented

2. **Parallel workstreams**
   - Frontend and backend can proceed independently
   - Cleanup and features can alternate
   - Minimize blocking dependencies

3. **Automation**
   - CI/CD for testing
   - Automated cleanup validation
   - Self-service documentation

**Contingency:**
- Reduce scope to P0 only
- Extend timeline proportionally
- External contractor for specific tasks

---

## Category 5: Rollback Risks

### 5.1 Incomplete Rollback

| Attribute | Value |
|-----------|-------|
| **Severity** | HIGH |
| **Likelihood** | UNLIKELY (15%) |
| **Risk Score** | 1.2/5 |
| **Phase Affected** | Post-removal |

**Description:**
After CLI removal, rollback may not fully restore functionality due to code changes.

**Warning Signs:**
- Rollback command fails
- Restored CLI has bugs
- Data format incompatibility

**Mitigation Strategies:**

1. **Tested rollback procedures**
   - Test rollback at each phase
   - Document exact commands
   - Validate functionality after rollback

2. **Archive branch maintenance**
   - Keep `cli-archive` branch updated
   - Cherry-pick security fixes
   - Tag stable rollback points

3. **Data backward compatibility**
   - No breaking changes to status.json
   - Findings format unchanged
   - Plan file format unchanged

**Contingency:**
- Fresh install from archive
- Manual file restoration
- Hybrid mode (some features restored)

---

## Risk Summary Matrix

| Risk | Severity | Likelihood | Score | Priority |
|------|----------|------------|-------|----------|
| 2.1 Workflow Disruption | HIGH | CERTAIN | **4.75** | **1** |
| 2.2 Feature Gaps | HIGH | LIKELY | **3.6** | **2** |
| 1.1 Hidden Dependencies | HIGH | POSSIBLE | **3.2** | **3** |
| 2.3 Learning Curve | MEDIUM | LIKELY | **2.8** | **4** |
| 1.3 WebSocket Stability | MEDIUM | LIKELY | **2.6** | **5** |
| 1.2 API Performance | MEDIUM | POSSIBLE | **2.1** | **6** |
| 3.2 Auth Gaps | MEDIUM | POSSIBLE | **2.0** | **7** |
| 4.2 Resource Constraints | MEDIUM | POSSIBLE | **2.0** | **8** |
| 1.4 Git Conflicts | MEDIUM | POSSIBLE | **1.8** | **9** |
| 4.1 Timeline Slip | LOW | LIKELY | **1.5** | **10** |
| 5.1 Incomplete Rollback | HIGH | UNLIKELY | **1.2** | **11** |
| 3.1 Data Inconsistency | MEDIUM | UNLIKELY | **1.0** | **12** |

---

## Top 5 Risks - Detailed Action Plans

### Risk #1: Workflow Disruption (Score: 4.75)

**Actions Before Migration:**
- [ ] Complete workflow mapping document
- [ ] Create video tutorials for each workflow
- [ ] Set up feedback collection mechanism
- [ ] Define adoption success metrics

**Actions During Migration:**
- [ ] Monitor support ticket volume
- [ ] Weekly check-ins with power users
- [ ] Track CLI vs dashboard usage ratio
- [ ] Quick-response team for issues

**Actions After Migration:**
- [ ] 30-day satisfaction survey
- [ ] Document lessons learned
- [ ] Publish case studies

---

### Risk #2: Feature Gaps (Score: 3.6)

**Actions Before Migration:**
- [ ] User shadowing sessions (5 users minimum)
- [ ] Feature audit with real workflows
- [ ] Beta testing group formation
- [ ] Gap tracking spreadsheet

**Actions During Migration:**
- [ ] Daily gap report review
- [ ] 1-week SLA for P0 gaps
- [ ] Feature request triage process
- [ ] Transparent roadmap updates

**Actions After Migration:**
- [ ] Gap closure verification
- [ ] User confirmation of parity
- [ ] Continuous improvement process

---

### Risk #3: Hidden Dependencies (Score: 3.2)

**Actions Before Migration:**
- [ ] Run dependency audit script
- [ ] Map all imports in codebase
- [ ] Create removal checklist
- [ ] Test each removal category

**Actions During Migration:**
- [ ] Incremental removal with validation
- [ ] Full test suite after each phase
- [ ] Staging deployment before prod
- [ ] 24-hour monitoring after cleanup

**Actions After Migration:**
- [ ] Final dependency verification
- [ ] Clean up orphaned references
- [ ] Update dependency documentation

---

### Risk #4: Learning Curve (Score: 2.8)

**Actions Before Migration:**
- [ ] Design keyboard shortcuts
- [ ] Create interactive tutorial
- [ ] Build help documentation
- [ ] Power user preview sessions

**Actions During Migration:**
- [ ] Track tutorial completion rates
- [ ] A/B test UI variations
- [ ] Collect usability feedback
- [ ] Iterate on pain points

**Actions After Migration:**
- [ ] Usability satisfaction score
- [ ] Identify remaining friction
- [ ] Plan continuous improvement

---

### Risk #5: WebSocket Stability (Score: 2.6)

**Actions Before Migration:**
- [ ] Implement reconnection logic
- [ ] Add heartbeat mechanism
- [ ] Create fallback polling
- [ ] Load test WebSocket server

**Actions During Migration:**
- [ ] Monitor connection metrics
- [ ] Alert on disconnect spikes
- [ ] User-reported issue tracking
- [ ] Performance optimization

**Actions After Migration:**
- [ ] Analyze connection stability
- [ ] Optimize based on data
- [ ] Document best practices

---

## Mitigation Investment Summary

| Mitigation Category | Effort | Risk Reduction |
|---------------------|--------|----------------|
| User Communication & Training | 5 days | 40% of user risks |
| Testing & Validation | 3 days | 60% of tech risks |
| Monitoring & Alerting | 2 days | 30% of operational risks |
| Rollback Procedures | 1 day | 80% of rollback risks |
| Documentation | 3 days | 20% of all risks |
| **Total Investment** | **~14 days** | |

This investment represents ~35% of the 40-day migration timeline, which is appropriate for a medium-risk initiative.

---

## Conclusion

The dashboard-only migration carries **moderate overall risk** with a few high-severity items that are well-understood and have clear mitigations. The highest risks are user-facing (workflow disruption, feature gaps, learning curve) rather than technical, indicating that **communication and change management** are as important as technical execution.

**Key Success Factors:**
1. Extended parallel operation period
2. Comprehensive user feedback loops
3. Fast response to discovered gaps
4. Tested rollback procedures
5. Incremental cleanup with validation

With proper mitigation investment, the migration can proceed with confidence.
