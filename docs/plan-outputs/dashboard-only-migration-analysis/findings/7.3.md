# Task 7.3: Recommended Implementation Order

## Overview

This document provides a detailed implementation order for the dashboard-only migration, incorporating dependencies, effort estimates, and validation checkpoints. The order is optimized for:

1. **Unblocking migration** - P0 features first
2. **Maximizing ROI** - Quick wins before complex work
3. **Minimizing risk** - Incremental cleanup with validation
4. **Respecting dependencies** - Prerequisite work before dependent work

---

## Implementation Schedule

### Sprint 1: Foundation (Days 1-5)

#### Day 1: Quick Cleanup Wins

| Order | Task | Effort | Risk | Validation |
|-------|------|--------|------|------------|
| 1.1 | Remove `scripts/tests/` directory | 1h | None | API server still starts |
| 1.2 | Remove unused CLI scripts | 1h | None | Core functionality works |
| 1.3 | Create git tag for rollback point | 15m | None | Tag exists |

**Scripts to remove (1.2):**
- `scripts/cache-clear.js` (215 LOC)
- `scripts/cache-stats.js` (356 LOC)
- `scripts/check-file-status.js` (416 LOC)
- `scripts/generate_api_types.py` (419 LOC)
- `scripts/run_api_server.py` (254 LOC)

**Checkpoint:** Verify dashboard loads, API responds, orchestrator starts

---

#### Day 2-3: Git Auto-Commit (P0)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 2.1 | Add `auto_commit_task()` to `plan_orchestrator.py` | 3h | None |
| 2.2 | Add git-workflow.json auto_commit config schema | 1h | None |
| 2.3 | Integrate auto-commit into task completion flow | 2h | 2.1 |
| 2.4 | Test commit format: `[plan-name] task X.Y: description` | 1h | 2.3 |
| 2.5 | Handle edge cases (merge conflicts, detached HEAD) | 2h | 2.3 |

**Implementation details:**

```python
# plan_orchestrator.py - after task completion
def auto_commit_task(plan_name, task_id, description):
    if not git_config.get('auto_commit', {}).get('enabled', True):
        return

    # Check for changes
    result = subprocess.run(['git', 'status', '--porcelain'], capture_output=True)
    if not result.stdout.strip():
        return

    # Stage and commit
    subprocess.run(['git', 'add', '-A'])
    message = f"[{plan_name}] task {task_id}: {description[:50]}"
    subprocess.run(['git', 'commit', '-m', message])
```

**Checkpoint:** Run orchestrator, verify git commits appear after tasks complete

---

#### Day 4-5: Plan Archive Action (Quick Win)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 3.1 | Add `POST /api/plans/:name/archive` endpoint | 2h | None |
| 3.2 | Implement `archivePlan()` in plan-status.js | 1h | None |
| 3.3 | Add "Archive" menu item to dashboard plan card | 2h | 3.1 |
| 3.4 | Add confirmation dialog | 1h | 3.3 |
| 3.5 | Hide archived plans from main list | 1h | 3.1 |
| 3.6 | Add "Show Archived" toggle | 1h | 3.5 |

**Checkpoint:** Archive a plan, verify it moves to archive folder, disappears from list

---

### Sprint 2: Core P0 Features (Days 6-12)

#### Days 6-8: Plan Creation Wizard (P0)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 4.1 | Add `GET /api/templates` endpoint | 2h | None |
| 4.2 | Add `GET /api/templates/:name` endpoint | 1h | None |
| 4.3 | Add `POST /api/plans` endpoint (create plan) | 3h | 4.1 |
| 4.4 | Create `TemplateSelector` React component | 3h | 4.1 |
| 4.5 | Create `PlanConfigForm` React component | 3h | 4.2 |
| 4.6 | Create `PlanPreview` React component | 2h | 4.5 |
| 4.7 | Create `PlanCreationDialog` (wizard container) | 2h | 4.4, 4.5, 4.6 |
| 4.8 | Add "Create Plan" button to plans page | 1h | 4.7 |
| 4.9 | Initialize status.json for new plans | 1h | 4.3 |
| 4.10 | Create git branch for new plan (if configured) | 1h | 4.3 |

**Checkpoint:** Create plan via dashboard, verify file created, status initialized, visible in list

---

#### Days 9-10: Task Explain/Verify Buttons (P1)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 5.1 | Add `POST /api/plans/:name/tasks/:id/explain` | 2h | None |
| 5.2 | Add `POST /api/plans/:name/tasks/:id/verify` | 2h | None |
| 5.3 | Create `ExplainModal` component | 2h | 5.1 |
| 5.4 | Create `VerifyModal` component | 2h | 5.2 |
| 5.5 | Add "Explain" button to task row | 1h | 5.3 |
| 5.6 | Add "Verify" button to completed tasks | 1h | 5.4 |
| 5.7 | Cache explanations to avoid repeat calls | 1h | 5.1 |

**Checkpoint:** Click Explain on task, see explanation; Click Verify on completed, see report

---

#### Days 11-12: CLI Wrapper Cleanup

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 6.1 | Audit CLI wrapper dependencies | 1h | None |
| 6.2 | Remove `scripts/status-cli.js` | 30m | Verify API has equivalents |
| 6.3 | Remove `scripts/worktree-cli.js` | 30m | Verify API has equivalents |
| 6.4 | Remove remaining CLI wrappers | 1h | 6.1 |
| 6.5 | Update any documentation references | 1h | 6.4 |

**Wrappers to remove (6.4):**
- `scripts/switch_plan.py`
- `scripts/multi_plan_monitor.py`
- `scripts/scan-plans.js`
- `scripts/parse-plan-structure.js`
- `scripts/validate-plan-format.js`
- `scripts/substitute-variables.js`
- `scripts/migrate-completed-plan.js`

**Checkpoint:** Dashboard still works, API endpoints functional

---

### Sprint 3: Task Implementation & Monitoring (Days 13-22)

#### Days 13-17: Task Implementation Trigger (P0)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 7.1 | Add `--single-task` mode to plan_orchestrator.py | 3h | None |
| 7.2 | Add `--session-id` argument for tracking | 1h | 7.1 |
| 7.3 | Implement `run_single_task_mode()` | 4h | 7.1, 7.2 |
| 7.4 | Add `POST /api/plans/:name/tasks/:id/implement` | 3h | 7.3 |
| 7.5 | Add session tracking to API server | 2h | 7.4 |
| 7.6 | Create WebSocket `/ws/sessions/:id` endpoint | 3h | 7.5 |
| 7.7 | Create `ImplementationProgress` modal component | 4h | 7.6 |
| 7.8 | Add "Implement" button to pending tasks | 2h | 7.7 |
| 7.9 | Integrate auto-commit with single-task mode | 1h | 7.3, 2.3 |
| 7.10 | Handle timeout and failure cases | 2h | 7.7 |

**Checkpoint:** Click Implement on task, see progress stream, task completes and commits

---

#### Days 18-19: Agent Tracking Panel (P1)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 8.1 | Add agent events to WebSocket protocol | 2h | None |
| 8.2 | Emit agent events from orchestrator | 2h | 8.1 |
| 8.3 | Create `AgentTracker` component | 3h | 8.1 |
| 8.4 | Add agent panel to plan detail page | 1h | 8.3 |
| 8.5 | Show "Waiting for N/M agents" indicator | 1h | 8.3 |

**Checkpoint:** Start batch execution, see agents listed with status/duration

---

#### Days 20-22: Output Streaming (P1)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 9.1 | Enhance progress streaming from orchestrator | 2h | None |
| 9.2 | Parse and structure log output | 2h | 9.1 |
| 9.3 | Create `OutputPanel` component (terminal-like) | 4h | 9.2 |
| 9.4 | Add scroll lock and search | 2h | 9.3 |
| 9.5 | Highlight tool calls in output | 1h | 9.3 |

**Checkpoint:** Start orchestrator, see real-time output with tool highlights

---

### Sprint 4: TUI Cleanup & Polish (Days 23-30)

#### Days 23-25: TUI Directory Removal

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 10.1 | Verify `--no-tui` fully works | 1h | None |
| 10.2 | Update api-server.js to always pass `--no-tui` | 30m | 10.1 |
| 10.3 | Remove `scripts/tui/` directory (11 files) | 30m | 10.2 |
| 10.4 | Remove `scripts/lib/tui.py` | 15m | 10.2 |
| 10.5 | Remove `scripts/lib/multi_plan_tui.py` | 15m | 10.2 |
| 10.6 | Clean up TUI imports in plan_orchestrator.py | 1h | 10.3 |
| 10.7 | Test all orchestrator modes | 2h | 10.6 |

**Checkpoint:** Start orchestrator via dashboard, all functionality works without TUI

---

#### Days 26-27: Worktree Management UI (P1)

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 11.1 | Add `POST /api/worktrees` endpoint | 2h | None |
| 11.2 | Add `DELETE /api/worktrees/:name` endpoint | 2h | None |
| 11.3 | Create `CreateWorktreeDialog` component | 2h | 11.1 |
| 11.4 | Add create/remove buttons to worktree panel | 1h | 11.2, 11.3 |
| 11.5 | Add resource limit warnings | 1h | 11.1 |

**Checkpoint:** Create worktree from dashboard, run plan, remove worktree

---

#### Days 28-30: P2 Quick Wins

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 12.1 | Add vim-style keyboard navigation (j/k) | 4h | None |
| 12.2 | Add `/` for search focus | 1h | 12.1 |
| 12.3 | Add `g/G` for top/bottom | 1h | 12.1 |
| 12.4 | Add Template Browser to plan creation | 4h | 4.4 |
| 12.5 | Add template preview modal | 2h | 12.4 |

**Checkpoint:** Navigate with keyboard, browse templates visually

---

### Sprint 5: Migration Completion (Days 31-40)

#### Days 31-33: Plan Skills Removal (User Impact)

**Prerequisites:**
- All P0 dashboard features complete and validated
- User communication sent (1 week prior)
- Deprecation warnings active

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 13.1 | Send final removal notice | - | P0 complete |
| 13.2 | Remove `.claude/commands/plan/` (20 files) | 1h | 13.1 |
| 13.3 | Remove `.claude/commands/plan/_common/` (3 files) | 30m | 13.1 |
| 13.4 | Update `.claude/CLAUDE.md` references | 1h | 13.2 |
| 13.5 | Archive skills in separate branch | 30m | 13.2 |

**Checkpoint:** Skills no longer available, dashboard fully functional

---

#### Days 34-35: Template Cleanup (Optional)

**Prerequisite:** Plan creation in dashboard fully works

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 14.1 | Copy templates to dashboard-accessible location | 30m | Plan creation |
| 14.2 | Remove `.claude/templates/` if no longer needed | 30m | 14.1 |
| 14.3 | Update template loading paths | 1h | 14.2 |

---

#### Days 36-40: Final Validation & Documentation

| Order | Task | Effort | Dependencies |
|-------|------|--------|--------------|
| 15.1 | Full integration test of all dashboard features | 4h | All above |
| 15.2 | Performance testing | 2h | 15.1 |
| 15.3 | Update all documentation to dashboard-only | 4h | 15.1 |
| 15.4 | Create migration complete announcement | 1h | 15.3 |
| 15.5 | Archive CLI code branch for reference | 30m | 13.5 |
| 15.6 | Final code cleanup and formatting | 2h | 15.1 |

---

## Visual Implementation Timeline

```
Week 1 (Days 1-5)
├── Day 1: Quick Cleanup Wins ◆ (test scripts, unused CLI)
├── Day 2-3: Git Auto-Commit ★ P0
└── Day 4-5: Plan Archive ○

Week 2 (Days 6-12)
├── Day 6-8: Plan Creation Wizard ★ P0
├── Day 9-10: Explain/Verify Buttons ▲ P1
└── Day 11-12: CLI Wrapper Cleanup ◆

Week 3 (Days 13-22)
├── Day 13-17: Task Implementation ★ P0
├── Day 18-19: Agent Tracking ▲ P1
└── Day 20-22: Output Streaming ▲ P1

Week 4 (Days 23-30)
├── Day 23-25: TUI Removal ◆◆
├── Day 26-27: Worktree UI ▲ P1
└── Day 28-30: P2 Quick Wins ○

Week 5 (Days 31-40)
├── Day 31-33: Plan Skills Removal ◆◆◆
├── Day 34-35: Template Cleanup ◆
└── Day 36-40: Validation & Docs

Legend:
★ = P0 Feature (migration blocker)
▲ = P1 Feature (high value)
○ = Quick Win (low effort)
◆ = Cleanup (code removal)
```

---

## Dependency Graph

```
                    ┌─────────────────────┐
                    │ Quick Cleanup (1.x) │
                    └──────────┬──────────┘
                               │
              ┌────────────────┼────────────────┐
              ▼                ▼                ▼
      ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
      │ Git Commit    │ │ Plan Archive  │ │ Explain/Verify│
      │ (2.x) P0      │ │ (3.x) Quick   │ │ (5.x) P1      │
      └───────┬───────┘ └───────────────┘ └───────────────┘
              │
              ▼
      ┌───────────────┐
      │ Plan Creation │
      │ (4.x) P0      │
      └───────┬───────┘
              │
              ├─────────────────────────┐
              ▼                         ▼
      ┌───────────────┐         ┌───────────────┐
      │ Task Implement│         │ Template      │
      │ (7.x) P0      │         │ Browser (12.x)│
      └───────┬───────┘         └───────────────┘
              │
              ▼
      ┌───────────────┐
      │ Agent Tracking│──────┐
      │ (8.x) P1      │      │
      └───────────────┘      │
              │              ▼
              ▼       ┌───────────────┐
      ┌───────────────┐│ Output Stream │
      │ CLI Wrapper   ││ (9.x) P1      │
      │ Cleanup (6.x) │└───────────────┘
      └───────┬───────┘
              │
              ▼
      ┌───────────────┐
      │ TUI Removal   │
      │ (10.x)        │
      └───────┬───────┘
              │
              ▼
      ┌───────────────┐
      │ Plan Skills   │
      │ Removal (13.x)│
      └───────────────┘
```

---

## Validation Checkpoints Summary

| Checkpoint | After | Criteria |
|------------|-------|----------|
| C1 | Day 1 | Dashboard loads, API responds, orchestrator starts |
| C2 | Day 3 | Git commits appear after task completion |
| C3 | Day 5 | Plans can be archived from dashboard |
| C4 | Day 8 | Plans can be created from dashboard |
| C5 | Day 10 | Explain and Verify buttons work |
| C6 | Day 12 | CLI wrappers removed, dashboard still works |
| C7 | Day 17 | Individual tasks can be implemented from dashboard |
| C8 | Day 19 | Agent tracking visible during batch execution |
| C9 | Day 22 | Real-time output streaming works |
| C10 | Day 25 | TUI removed, orchestrator works via dashboard |
| C11 | Day 27 | Worktrees can be created/removed from dashboard |
| C12 | Day 33 | Plan skills removed, all workflows via dashboard |
| C13 | Day 40 | Full integration validation complete |

---

## Rollback Points

| Point | After | Rollback Command | Restores |
|-------|-------|------------------|----------|
| R1 | Day 1 | `git checkout v1.0-pre-cleanup` | Full CLI/TUI |
| R2 | Day 12 | `git checkout v1.0-pre-wrapper-removal` | CLI wrappers |
| R3 | Day 25 | `git checkout v1.0-pre-tui-removal` | TUI |
| R4 | Day 33 | `git checkout cli-archive` | Plan skills |

---

## Key Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| P0 Features Complete | Day 17 | All 3 P0 features working |
| Code Removed | Day 33 | ~40,000 LOC removed |
| Dashboard Adoption | Day 20 | >60% of workflows via dashboard |
| Zero Blocking Issues | Day 40 | No P0/P1 bugs |
| Documentation Updated | Day 40 | All docs point to dashboard |

---

## Summary: Implementation Order

1. **Quick cleanup wins** (Day 1) - Zero risk, immediate benefit
2. **Git Auto-Commit** (Days 2-3) - Highest ROI P0 feature
3. **Plan Archive** (Days 4-5) - Quick user convenience win
4. **Plan Creation** (Days 6-8) - Core P0 capability
5. **Explain/Verify** (Days 9-10) - High-value P1 features
6. **CLI Wrapper Cleanup** (Days 11-12) - Low risk cleanup
7. **Task Implementation** (Days 13-17) - Complex P0 feature
8. **Agent Tracking + Output** (Days 18-22) - Monitoring P1 features
9. **TUI Removal** (Days 23-25) - Major cleanup milestone
10. **Worktree UI + P2 Wins** (Days 26-30) - Polish and power user features
11. **Plan Skills Removal** (Days 31-33) - Final major cleanup
12. **Validation + Docs** (Days 36-40) - Migration completion
