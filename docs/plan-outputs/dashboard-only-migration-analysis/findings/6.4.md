# Task 6.4: Migration Path from CLI/TUI to Dashboard

## Overview

This document provides a detailed migration path for transitioning from CLI/TUI-based workflows to a dashboard-only architecture. It includes phased rollout, user communication, rollback strategies, and validation checkpoints.

---

## Migration Philosophy

### Guiding Principles

1. **Gradual Transition**: No "big bang" cutover; features migrate incrementally
2. **Backwards Compatibility**: CLI/TUI continues to work until dashboard ready
3. **User Choice**: Users decide when to switch workflows
4. **Rollback Capability**: Can revert at any stage if issues arise
5. **Zero Data Loss**: All plans, status, and findings preserved throughout

### Success Criteria

- [ ] All P0 features implemented in dashboard
- [ ] 100% of users can complete core workflows via dashboard
- [ ] Zero data migration needed (same file formats)
- [ ] CLI/TUI can be safely disabled without breaking dashboard

---

## Pre-Migration Checklist

Before beginning migration:

| Check | Status | Notes |
|-------|--------|-------|
| Dashboard deployed and accessible | [ ] | Verify at configured URL |
| API server running and healthy | [ ] | `GET /health` returns OK |
| WebSocket connections working | [ ] | Real-time updates visible |
| All existing plans visible in dashboard | [ ] | Compare count with `docs/plans/` |
| Orchestrator start/stop working | [ ] | Test from dashboard UI |
| Git workflow config correct | [ ] | Check `.claude/git-workflow.json` |
| User documentation updated | [ ] | Migration guide accessible |

---

## Phase 1: Parallel Operation (Week 1-2)

### Goal

Both CLI/TUI and dashboard fully functional. Users choose their preferred interface.

### Actions

1. **Deploy Dashboard Features**
   - P0: Plan creation wizard
   - P0: Task implementation trigger
   - P0: Git auto-commit (backend only)

2. **No CLI/TUI Changes**
   - All existing commands work unchanged
   - No deprecation warnings yet

3. **User Communication**
   ```
   Subject: New Dashboard Features Available

   You can now create plans and implement tasks directly from the dashboard!

   New features:
   - Plan Creation Wizard: Create plans from templates via the UI
   - Task Implementation: Execute individual tasks with "Implement" button
   - Git Auto-Commit: Changes are automatically committed after each task

   The CLI/TUI commands continue to work as before. Try the dashboard
   at http://localhost:3000 and let us know your feedback.
   ```

4. **Monitoring**
   - Track dashboard vs CLI usage metrics
   - Log user feedback and issues
   - Monitor API error rates

### Validation Checkpoint

| Metric | Target | Actual |
|--------|--------|--------|
| Dashboard uptime | >99% | |
| Plan creation success rate | >95% | |
| Task implementation success rate | >90% | |
| User adoption (% trying dashboard) | >30% | |
| Critical bugs | 0 | |

---

## Phase 2: Dashboard Preference (Week 3-4)

### Goal

Dashboard becomes the recommended interface. CLI/TUI available as fallback.

### Actions

1. **Deploy Remaining P1 Features**
   - Task explanation and verification
   - Plan archive action
   - Agent tracking panel
   - Output streaming
   - Worktree management

2. **Add Deprecation Notices to CLI**
   ```python
   # In plan_orchestrator.py TUI initialization
   if not args.no_tui:
       print("⚠️ The TUI interface will be retired in a future release.")
       print("   Use the dashboard at http://localhost:3000 instead.")
       print("   Add --no-tui to suppress this message.\n")
   ```

3. **Update Default Behaviors**
   - `api.enabled: true` by default in git-workflow.json
   - Dashboard URL in startup messages
   - Documentation points to dashboard first

4. **User Communication**
   ```
   Subject: Dashboard Now Recommended for Plan Management

   Based on positive feedback, we're recommending the dashboard as the
   primary interface for plan management.

   What's new:
   - Task Explain/Verify buttons
   - Plan archiving from UI
   - Real-time agent tracking
   - Output streaming during execution

   The CLI/TUI will show deprecation notices but continues to work.
   Please report any missing functionality.
   ```

### Validation Checkpoint

| Metric | Target | Actual |
|--------|--------|--------|
| Dashboard adoption | >60% | |
| P1 feature usage | >40% | |
| CLI usage declining | Yes | |
| Support tickets (dashboard) | <5/week | |
| Feature parity feedback | Resolved | |

---

## Phase 3: CLI Deprecation (Week 5-6)

### Goal

CLI/TUI marked deprecated. Documentation redirects to dashboard.

### Actions

1. **Stronger Deprecation Warnings**
   ```python
   # In CLI commands
   import warnings

   warnings.warn(
       "This CLI command is deprecated. Use the dashboard instead. "
       "This command will be removed in version X.Y.",
       DeprecationWarning
   )
   ```

2. **Update All Documentation**
   - README points to dashboard
   - CLI command docs marked deprecated
   - Migration guide prominent in docs

3. **Disable CLI in New Installations**
   - Default config: `dashboard_only: true`
   - CLI commands require explicit `--enable-cli` flag

4. **User Communication**
   ```
   Subject: CLI/TUI Deprecation Notice

   The CLI and TUI interfaces are now deprecated and will be removed
   in version X.Y (estimated: [date]).

   Action required:
   - Transition your workflows to the dashboard
   - Update any automation scripts to use the API
   - Report any blocking issues ASAP

   Dashboard: http://localhost:3000
   API docs: [link]
   Migration guide: [link]
   ```

### Validation Checkpoint

| Metric | Target | Actual |
|--------|--------|--------|
| Dashboard adoption | >90% | |
| CLI usage | <10% | |
| API automation adoption | Increasing | |
| Blocking issues reported | 0 | |
| Rollback requests | 0 | |

---

## Phase 4: CLI Removal (Week 7-8)

### Goal

CLI/TUI code removed from codebase. Dashboard is the only interface.

### Actions

1. **Final Warning Period (1 week)**
   - Email reminder to remaining CLI users
   - Dashboard banner announcing removal date

2. **Code Removal**
   - Remove TUI directory: `scripts/tui/`
   - Remove CLI wrapper scripts (per findings 5.1)
   - Remove plan skills (optional - may keep for Claude Code users)
   - Update imports in remaining files

3. **Cleanup**
   - Remove deprecated config options
   - Remove CLI documentation
   - Archive removed code in separate branch for reference

4. **User Communication**
   ```
   Subject: CLI/TUI Removed - Dashboard is Now Primary Interface

   As announced, the CLI and TUI interfaces have been removed.

   What changed:
   - /plan:* commands no longer available
   - TUI monitoring removed
   - All functionality available in dashboard

   If you encounter issues:
   - Dashboard: http://localhost:3000
   - Support: [link]
   - Rollback (temporary): git checkout cli-archive
   ```

### Validation Checkpoint

| Metric | Target | Actual |
|--------|--------|--------|
| Dashboard functionality | 100% | |
| User complaints | <3 | |
| API stability | 100% | |
| Code removed | ~40K LOC | |
| Tests passing | 100% | |

---

## Rollback Strategies

### During Phase 1-2: Full Rollback Available

```bash
# Revert to CLI-primary if needed
git checkout main -- scripts/tui/
git checkout main -- .claude/commands/plan/

# Disable dashboard-only mode
echo '{"api": {"enabled": false}}' > .claude/git-workflow.json
```

### During Phase 3: Partial Rollback

```bash
# Re-enable CLI commands without restoring TUI
git checkout cli-deprecated -- .claude/commands/plan/

# Remove deprecation warnings
sed -i 's/warnings.warn.*DeprecationWarning.*/pass/' scripts/*.py
```

### During Phase 4: Archive Rollback

```bash
# Full restore from archive branch
git checkout cli-archive

# Or cherry-pick specific files
git checkout cli-archive -- scripts/tui/
git checkout cli-archive -- .claude/commands/plan/
```

---

## Workflow Migration Guide

### For Plan Authors

| CLI Workflow | Dashboard Equivalent |
|--------------|---------------------|
| `/plan:create` | "Create Plan" button → Wizard |
| `/plan:templates` | Plan creation → Template browser |
| Edit plan markdown | Not available (keep editor) |
| `/plan:set` | Click on plan in list |

### For Plan Executors

| CLI Workflow | Dashboard Equivalent |
|--------------|---------------------|
| `/plan:implement 1.1` | Task row → "Implement" button |
| `/plan:batch` | Orchestrator settings → Batch size |
| `/plan:explain 1.1` | Task row → "Explain" button |
| `/plan:verify 1.1` | Task row → "Verify" button |
| Watch orchestrator | Activity feed + Output panel |

### For Plan Managers

| CLI Workflow | Dashboard Equivalent |
|--------------|---------------------|
| `/plan:status` | Plan detail page |
| `/plan:archive` | Plan menu → Archive |
| `/plan:orchestrate` | "Start Orchestrator" button |
| `/plan:complete` | Automatic when 100% done |

### For Advanced Users

| CLI Workflow | Dashboard Equivalent |
|--------------|---------------------|
| `/plan:worktree` | Worktree panel → Create/Remove |
| Git operations | Not available (keep git CLI) |
| `/plan:rollback` | Plan menu → Rollback (P2) |
| Multi-plan monitor | Home page grid view |

---

## API Migration for Automation

### Before (CLI Scripts)

```bash
#!/bin/bash
# Old automation using CLI

# Create plan
claude-code --skill plan:create --template feature

# Start orchestrator
claude-code --skill plan:orchestrate --autonomous

# Check status
node scripts/status-cli.js status
```

### After (API Calls)

```bash
#!/bin/bash
# New automation using API

API_URL="http://localhost:3100"

# Create plan
curl -X POST "$API_URL/api/plans" \
  -H "Content-Type: application/json" \
  -d '{"name": "my-feature", "template": "feature-implementation"}'

# Start orchestrator
curl -X POST "$API_URL/api/plans/my-feature/start" \
  -H "Content-Type: application/json" \
  -d '{"mode": "batch", "autonomous": true}'

# Check status
curl "$API_URL/api/plans/my-feature/status"
```

### WebSocket Integration

```javascript
// Real-time monitoring via WebSocket
const ws = new WebSocket('ws://localhost:3100/ws/plans/my-feature');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'task:completed') {
    console.log(`Task ${data.taskId} completed`);
  }
};
```

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Users resist dashboard | Extended parallel operation, gather feedback |
| Dashboard bugs block workflows | CLI fallback available, hotfix priority |
| API performance issues | Rate limiting, caching, monitoring |
| Data format incompatibility | None (same files used) |
| Integration scripts break | API migration guide, support period |
| Feature parity gaps discovered | Prioritize, implement before removal |

---

## Timeline Summary

| Phase | Duration | Key Milestone |
|-------|----------|---------------|
| Phase 1: Parallel Operation | 2 weeks | Dashboard P0 features live |
| Phase 2: Dashboard Preference | 2 weeks | Dashboard recommended, >60% adoption |
| Phase 3: CLI Deprecation | 2 weeks | Deprecation warnings active |
| Phase 4: CLI Removal | 2 weeks | CLI code removed, ~40K LOC cleanup |
| **Total** | **8 weeks** | Dashboard-only architecture |

---

## Success Metrics

### Adoption Metrics

- Dashboard daily active users
- Plan creations via dashboard vs CLI
- Task implementations via dashboard
- API call volume

### Quality Metrics

- Dashboard uptime
- API error rate
- User-reported bugs
- Time to resolve issues

### Efficiency Metrics

- Codebase size reduction
- Maintenance burden decrease
- Onboarding time for new users

---

## Post-Migration

After CLI/TUI removal:

1. **Archive CLI code** in separate branch for reference
2. **Update all documentation** to dashboard-only
3. **Simplify codebase** - remove CLI-related abstractions
4. **Continue P2 features** - vim keys, subtask tree, etc.
5. **Gather long-term feedback** for future improvements
