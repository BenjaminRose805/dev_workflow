# Schema Files Assessment

## Overview

Assessed 9 JSON schema files across 2 directories:

| Location | Count | Lines | Purpose |
|----------|-------|-------|---------|
| `docs/schemas/` | 5 | ~775 | Artifact output schemas |
| `scripts/lib/schemas/` | 4 | ~355 | Internal validation schemas |
| **Total** | **9** | **~1,130** | |

---

## docs/schemas/ (Artifact Schemas)

These schemas define the structure of artifacts produced by commands.

| File | Lines | Command | Artifact Type | Status |
|------|-------|---------|---------------|--------|
| artifact-metadata.json | 103 | All | Base metadata | KEEP |
| requirements-spec.json | 139 | /clarify | requirements-spec | KEEP |
| components-catalog.json | 194 | /architect | components-catalog | KEEP |
| validation-report.json | 226 | /validate | validation-report | KEEP |
| analysis-report.json | 217 | /analyze | analysis-report | KEEP |

### 1. artifact-metadata.json

**Purpose:** Base schema defining common metadata fields required for all artifacts.

**Required Fields:**
- `artifact_type` - Enum of known artifact types
- `version` - Semantic version pattern
- `created_at` - ISO-8601 timestamp
- `created_by` - Model identifier (sonnet, opus, haiku)
- `command` - Producing command pattern
- `status` - Lifecycle status (draft, active, superseded, archived)

**Optional Fields:**
- `subcommand`, `updated_at`, `tags`, `depends_on`, `consumed_by`, `project_context`

**Assessment:** Well-structured base schema. All artifact-specific schemas should extend this.

**Recommendation:** **KEEP** (essential, base schema)

---

### 2. requirements-spec.json

**Purpose:** Schema for requirements specifications produced by /clarify command.

**Key Features:**
- Extends artifact-metadata fields
- Defines requirement structure with MoSCoW priority
- Includes acceptance criteria and dependencies
- Tracks clarification Q&A history

**Field Validations:**
- Requirement ID pattern: `^REQ-\d{3,}$`
- Priority enum: must, should, could, wont
- Type enum: functional, non_functional, constraint

**Recommendation:** **KEEP** (well-defined)

---

### 3. components-catalog.json

**Purpose:** Schema for component catalogs produced by /architect command.

**Key Features:**
- Defines architectural component structure
- Includes technology stack, interfaces, dependencies
- Supports multiple component types (service, library, module, container, etc.)
- Tracks layer assignment (presentation, application, domain, infrastructure)

**Field Validations:**
- Component ID pattern: `^COMP-[A-Z0-9-]+$`
- Relationship types: uses, extends, implements, contains, communicates

**Recommendation:** **KEEP** (comprehensive)

---

### 4. validation-report.json

**Purpose:** Schema for validation reports produced by /validate command.

**Key Features:**
- Defines check structure (name, category, status, duration)
- Includes quality gate configuration and results
- Supports test coverage tracking
- Defines exit codes per quality gate standards

**Field Validations:**
- Check categories: type-check, lint, test, build, security, format, custom
- Check status: passed, failed, skipped, error
- Severity levels: critical, high, medium, low, info

**Recommendation:** **KEEP** (aligned with quality gate standards)

---

### 5. analysis-report.json

**Purpose:** Schema for analysis reports produced by /analyze command.

**Key Features:**
- Supports 7 analysis types: security, performance, quality, dependency, test, architecture, accessibility
- Defines finding structure with severity, location, references
- Includes metrics with thresholds and status
- Supports recommendations with effort estimates

**Field Validations:**
- Finding ID pattern: `^FIND-[A-Z0-9-]+$`
- Severity enum: critical, high, medium, low, info
- Effort enum: trivial, low, medium, high

**Recommendation:** **KEEP** (comprehensive)

---

## scripts/lib/schemas/ (Internal Schemas)

These schemas validate internal agent/tool output.

| File | Lines | Purpose | Usage | Status |
|------|-------|---------|-------|--------|
| verify-result.json | 50 | Task verification output | verify-with-agent.js | KEEP |
| analysis-result.json | 81 | Deep analysis agent output | Internal | KEEP |
| research-result.json | 61 | Research agent output | Internal | KEEP |
| plan-status.json | 163 | status.json structure | plan-status.js | KEEP |

### 1. verify-result.json

**Purpose:** Validates output from task verification agent.

**Required Fields:**
- `task_id` - Task identifier
- `status` - DONE or NEEDED
- `confidence` - 0-100 confidence score

**Optional Fields:**
- `evidence`, `missing_items`, `suggestions`

**Recommendation:** **KEEP** (actively used by verify-with-agent.js)

---

### 2. analysis-result.json

**Purpose:** Validates output from deep analysis agent.

**Required Fields:**
- `question` - Problem being analyzed
- `recommendation` - Primary recommendation
- `confidence` - 0-100 confidence score
- `pros`, `cons` - Arrays of trade-offs

**Optional Fields:**
- `evidence`, `alternatives`, `implementation_notes`

**Recommendation:** **KEEP** (agent output validation)

---

### 3. research-result.json

**Purpose:** Validates output from research agent.

**Required Fields:**
- `findings` - Array of findings (type, description, location, evidence)
- `confidence` - 0-100 confidence score

**Finding Types:**
- file, pattern, dependency, issue

**Recommendation:** **KEEP** (agent output validation)

---

### 4. plan-status.json

**Purpose:** Canonical schema for status.json files in docs/plan-outputs/*/status.json.

**Required Fields:**
- `planPath` - Path to plan file
- `planName` - Human-readable name
- `createdAt` - ISO-8601 timestamp
- `tasks` - Array of task objects

**Task Structure:**
- `id` - Pattern: `^\d+\.\d+(\.\d+)?$`
- `status` - Enum: pending, in_progress, completed, failed, skipped
- `description`, `startedAt`, `completedAt`, `duration`, `notes`, `error`, etc.

**Summary:**
- Total counts: totalTasks, completed, pending, failed, skipped, in_progress

**Recommendation:** **KEEP** (essential, actively used)

---

## Schema Overlap Analysis

### Potential Overlaps Found

| Schema 1 | Schema 2 | Overlap | Resolution |
|----------|----------|---------|------------|
| analysis-report.json | analysis-result.json | Both for analysis output | **Different purpose** - One for command artifacts, one for agent output |

**Conclusion:** No actual duplication. The two analysis schemas serve different purposes:
- `docs/schemas/analysis-report.json` - Defines /analyze command output artifacts
- `scripts/lib/schemas/analysis-result.json` - Validates internal agent responses

---

## Schema Consistency Analysis

### Consistent Patterns

1. **All use JSON Schema Draft-07** - `$schema: http://json-schema.org/draft-07/schema#`
2. **All have required fields** - Explicitly defined required arrays
3. **All have descriptions** - Properties include descriptions
4. **Consistent ID patterns** - Use regex patterns for IDs

### Inconsistencies Found

| Issue | Location | Details |
|-------|----------|---------|
| artifact_type enum partial | artifact-metadata.json | Only lists 12 types, but artifact-type-registry.md lists 80+ |
| created_by enum limited | All docs/schemas/ | Only lists sonnet, opus, haiku - may need updating for new models |
| No $ref usage | All schemas | Each schema duplicates artifact metadata fields instead of referencing |

### Recommendations

1. **Update artifact_type enum** - Sync artifact-metadata.json with artifact-type-registry.md
2. **Use $ref for base metadata** - Artifact schemas should reference artifact-metadata.json
3. **Centralize model list** - created_by enum should be in one place

---

## Summary

| Recommendation | Count | Files |
|----------------|-------|-------|
| **KEEP** | 9 | All schemas |
| **CONSOLIDATE** | 0 | N/A |
| **ARCHIVE** | 0 | N/A |
| **DELETE** | 0 | N/A |

### Key Findings

1. **No duplicates** - All 9 schemas serve unique purposes
2. **Well-organized** - Separated by usage (artifact output vs internal validation)
3. **Consistent structure** - All follow JSON Schema Draft-07
4. **Actively used** - plan-status.json and verify-result.json are in active use
5. **Future-ready** - Artifact schemas ready for when commands are implemented

### Action Items (Not Required, Future Enhancement)

1. Sync artifact-metadata.json enum with artifact-type-registry.md
2. Consider using $ref to reduce duplication across artifact schemas
3. Document schema usage in a README.md in each schemas directory
