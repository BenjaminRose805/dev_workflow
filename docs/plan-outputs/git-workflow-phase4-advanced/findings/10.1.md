# Task 10.1: Test Full Workflow with PR Creation

## Test Objective

Verify that the complete plan workflow with `--pr` flag works correctly, including:
- PR creation via GitHub CLI
- PR description generation from status.json
- Draft PR creation with `--draft` flag
- Archive tag creation before PR
- Proper error handling when gh CLI not available

## Test Cases

### TC-10.1.1: PR Flag Documentation

**Action:** Verify `--pr` flag is documented in `/plan:complete`

**Command:**
```bash
grep -c "\-\-pr" .claude/commands/plan/complete.md
```

**Expected:** Count >= 1

**Result:** PASS
- Found 14 occurrences of `--pr` in complete.md
- Flag documented in options section (line 15)
- Full PR workflow documented in steps PR.1-PR.5 (lines 546-882)

### TC-10.1.2: Draft Flag Documentation

**Action:** Verify `--draft` flag is documented

**Command:**
```bash
grep -c "\-\-draft" .claude/commands/plan/complete.md
```

**Expected:** Count >= 1

**Result:** PASS
- Found 8 occurrences of `--draft` in complete.md
- Flag documented in options section (line 16)
- Draft PR creation logic documented (lines 779-796)

### TC-10.1.3: GitHub CLI Integration

**Action:** Verify `gh pr create` command is documented

**Command:**
```bash
grep -c "gh pr create" .claude/commands/plan/complete.md
```

**Expected:** Count >= 1

**Result:** PASS
- Found 3 occurrences of `gh pr create` in complete.md
- Full gh pr create command with options documented (lines 759-776)

### TC-10.1.4: PR Description Generation

**Action:** Verify PR body generation logic exists

**Verification Points:**
1. PR title format: `Complete: {plan-name}` (line 747)
2. PR body includes:
   - Summary section (line 656)
   - Plan details with task counts (lines 661-664)
   - Phase list (lines 666-668)
   - Task checklist (lines 670-672)
   - Test plan section (lines 674-677)
   - Claude Code attribution (line 680)

**Result:** PASS
- All required sections documented in PR body structure (lines 649-681)
- Node.js script for generating PR body included (lines 684-737)

### TC-10.1.5: GitHub CLI Availability Check

**Action:** Verify graceful error handling when gh CLI not installed

**Verification Points:**
1. Check for `command -v gh` (line 563)
2. Check for `gh auth status` (line 579)
3. Clear error message with installation instructions (lines 567-574)

**Result:** PASS
- Pre-check for gh installation documented (lines 559-574)
- Authentication check documented (lines 577-584)
- Platform-specific installation instructions provided

### TC-10.1.6: Branch Push Before PR

**Action:** Verify branch is pushed with upstream tracking

**Command:**
```bash
grep -c "git push -u origin" .claude/commands/plan/complete.md
```

**Expected:** Count >= 1

**Result:** PASS
- `git push -u origin "$PLAN_BRANCH"` documented (line 611)
- Error handling for push failures included (lines 612-622)

### TC-10.1.7: PR URL Output

**Action:** Verify PR URL is captured and displayed

**Verification Points:**
1. `gh pr view --json url` command (line 802)
2. URL displayed with `View PR: $PR_URL` (line 804)

**Result:** PASS
- PR URL capture documented (lines 800-805)
- Example outputs show PR URL (lines 809-817)

### TC-10.1.8: Skip Local Merge with --pr

**Action:** Verify local merge steps are skipped when --pr used

**Verification Points:**
1. Steps 7-11 explicitly skipped (lines 833-837)
2. status.json updated with prCreated instead of mergedAt (lines 843-848)

**Result:** PASS
- PR workflow explicitly skips Steps 7-11 (local merge)
- Decision flowchart shows PR vs local merge paths (lines 851-882)

### TC-10.1.9: Archive Tag with PR Workflow

**Action:** Verify archive tag is still created in PR workflow

**Verification Points:**
1. Archive tag created in Step 6 (before merge/PR decision)
2. Archive tag created locally even in PR workflow

**Result:** PASS
- Archive tag creation is in Step 6, before the PR/merge decision point
- PR workflow still benefits from archive tag for local history

### TC-10.1.10: PR Workflow Examples

**Action:** Verify examples cover all PR scenarios

**Examples Present:**
- `/plan:complete --pr` - Regular PR
- `/plan:complete --pr --draft` - Draft PR
- `/plan:complete --pr --no-archive` - PR without archive tag

**Result:** PASS
- All three example scenarios documented (lines 886-904)
- Invalid usage case documented: `--draft` without `--pr` (lines 901-904)

## Summary

| Test Case | Status |
|-----------|--------|
| TC-10.1.1 | PASS |
| TC-10.1.2 | PASS |
| TC-10.1.3 | PASS |
| TC-10.1.4 | PASS |
| TC-10.1.5 | PASS |
| TC-10.1.6 | PASS |
| TC-10.1.7 | PASS |
| TC-10.1.8 | PASS |
| TC-10.1.9 | PASS |
| TC-10.1.10 | PASS |

**Overall Result:** PASS (10/10 test cases passed)

The PR creation workflow is fully documented and integrated into `/plan:complete`. All required functionality is present:
- GitHub CLI integration with proper error handling
- PR description generation from plan metadata
- Draft PR support
- Archive tag preservation
- Skip local merge when PR workflow is used
