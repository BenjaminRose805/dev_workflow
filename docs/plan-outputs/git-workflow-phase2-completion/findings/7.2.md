# 7.2 Test with Uncommitted Changes at Completion Time

## Test Scenario
When `/plan:complete` is run, there may be uncommitted changes (modified files, untracked files). These should be committed automatically before creating the archive tag.

## Test Setup
- Created test repo at `/tmp/git-workflow-test2`
- Plan: `test-uncommitted` with 1 task (completed)
- Added uncommitted changes AFTER task completion:
  - Modified file: `src/file.ts` (tracked, modified)
  - Untracked file: `src/extra.ts` (new file)

## Test Execution

### Pre-completion state
```
 M src/file.ts      # Modified tracked file
?? src/extra.ts     # Untracked new file
```

### Step 5: Uncommitted changes handling
```
Found uncommitted changes:
 M src/file.ts
?? src/extra.ts

Committing 2 file(s)...
âœ“ Committed 2 file(s) with uncommitted changes
  Commit: 6d9c555 [test-uncommitted] Final changes before completion
```

### Auto-generated commit message
```
[test-uncommitted] Final changes before completion

Committed 2 file(s) with uncommitted changes.
This commit was auto-generated by /plan:complete.

ðŸ¤– Generated with Claude Code

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

## Verification

### 1. Uncommitted changes included in archive tag
The archive tag was created AFTER the auto-commit, so it includes:
- Task 1.1 commit: `[test-uncommitted] task 1.1: Create a file`
- Auto-commit: `[test-uncommitted] Final changes before completion`

### 2. All files present in squash merge
After merge to master:
```
src/extra.ts   # Was untracked, now included
src/file.ts    # Was modified, changes included
```

### 3. Single squash commit on master
```
f82ec30 Complete: test-uncommitted
48e8e3f Add plan
f9d8102 Initial commit
```

## Result: PASS

The uncommitted changes handling works correctly:
1. âœ“ Detects both modified and untracked files
2. âœ“ Stages all changes with `git add -A`
3. âœ“ Creates descriptive auto-commit message
4. âœ“ Includes file count in commit message
5. âœ“ Archive tag includes the auto-committed changes
6. âœ“ Squash merge includes all changes
7. âœ“ Attribution footer present in auto-commit
