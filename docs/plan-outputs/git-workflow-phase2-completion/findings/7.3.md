# 7.3 Test Archive Tag Access After Branch Deletion

## Test Scenario
After `/plan:complete` deletes the plan branch, the archive tag should still provide access to the individual commit history.

## Test Environment
Used `/tmp/git-workflow-test` from test 7.1:
- Plan branch: `plan/test-integration-plan` (deleted)
- Archive tag: `archive/plan-test-integration-plan`
- Master: Has single squashed commit

## Test Results

### Test 1: View Archive Tag Details
```bash
git show archive/plan-test-integration-plan --no-patch
```
Result: ✓ PASS
```
tag archive/plan-test-integration-plan
Tagger: Test User <test@test.com>
Date:   Thu Dec 25 19:21:59 2025 -0600

Archive: test-integration-plan - Plan completed on 2025-12-25T19:21:59-06:00
```

### Test 2: View Commits Preserved in Archive
```bash
git log --oneline archive/plan-test-integration-plan
```
Result: ✓ PASS
```
a9e2923 [test-integration-plan] task 2.1: Verify test file exists
2b20e7d [test-integration-plan] task 1.2: Add content to test file
d35ab03 [test-integration-plan] task 1.1: Create a test file
895c165 Add test plan
35a0802 Initial commit
```
All 3 individual task commits preserved.

### Test 3: Compare Archive with Main
```bash
git log master..archive/plan-test-integration-plan --oneline
```
Result: ✓ PASS
```
a9e2923 [test-integration-plan] task 2.1: Verify test file exists
2b20e7d [test-integration-plan] task 1.2: Add content to test file
d35ab03 [test-integration-plan] task 1.1: Create a test file
```
Shows 3 individual commits that were squashed in master.

### Test 4: Restore Branch from Archive Tag
```bash
git checkout -b restored-test-integration-plan archive/plan-test-integration-plan
```
Result: ✓ PASS
- Branch created successfully from archive tag
- Full commit history available
- All files present (src/test.ts, findings/2.1.md)

### Test 5: View Specific Commit from Archive
```bash
git show archive/plan-test-integration-plan~1 --stat --no-patch
```
Result: ✓ PASS
- Can navigate to any commit in the archived history
- Task 1.2 commit details accessible

### Test 6: Cherry-Pick from Archive
```bash
git cherry-pick archive/plan-test-integration-plan~2 --no-commit
```
Result: ✓ PASS (with expected conflicts)
- Cherry-pick operation works
- Conflicts are expected when content already exists in master

### Test 7: Content Verification
```bash
git diff master archive/plan-test-integration-plan --stat
```
Result: ✓ PASS
- Only status.json differs (completion fields added after archive)
- Code content identical between archive and master

### Test 8: Archive Tag Type
```bash
git cat-file -t archive/plan-test-integration-plan
```
Result: ✓ PASS
```
tag
```
- Archive tag is annotated (not lightweight)
- Survives garbage collection
- Contains metadata (tagger, date, message)

## Summary of Archive Tag Capabilities

| Capability | Status |
|------------|--------|
| View tag details | ✓ PASS |
| List individual commits | ✓ PASS |
| Compare with squashed history | ✓ PASS |
| Restore deleted branch | ✓ PASS |
| View specific commit | ✓ PASS |
| Cherry-pick from archive | ✓ PASS |
| Survives garbage collection | ✓ PASS |

## Result: PASS

Archive tags provide full access to granular commit history after branch deletion:
1. ✓ Individual task commits are preserved
2. ✓ Commit messages, authors, timestamps intact
3. ✓ Can restore full branch from archive
4. ✓ Can cherry-pick individual changes
5. ✓ Annotated tag survives gc
6. ✓ Clear comparison between squashed and granular history
