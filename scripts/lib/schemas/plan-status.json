{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Plan Status Schema",
  "description": "Schema for tracking plan execution status and outputs. This is the canonical schema for status.json files in docs/plan-outputs/*/status.json",
  "type": "object",
  "required": ["planPath", "planName", "createdAt", "tasks"],
  "properties": {
    "_comment": {
      "type": "string",
      "description": "Human-readable comment explaining status.json purpose and source of truth"
    },
    "planPath": {
      "type": "string",
      "description": "Relative path to the plan file from project root",
      "minLength": 1
    },
    "planName": {
      "type": "string",
      "description": "Human-readable name of the plan",
      "minLength": 1
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when status tracking was initialized"
    },
    "lastUpdatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last status update"
    },
    "currentPhase": {
      "type": "string",
      "description": "Current phase being executed"
    },
    "tasks": {
      "type": "array",
      "description": "List of all tasks in the plan with their status",
      "items": {
        "type": "object",
        "required": ["id", "description", "status"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Task identifier in N.N or N.N.N format (e.g., '1.1', '2.3', '3.1.1'). Use N.N for simple tasks, N.N.N for sub-tasks within a subsection.",
            "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
            "minLength": 1
          },
          "phase": {
            "type": "string",
            "description": "Phase this task belongs to"
          },
          "description": {
            "type": "string",
            "description": "Task description from the plan",
            "minLength": 1
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "failed", "skipped"],
            "description": "Current status of the task"
          },
          "startedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When task execution started"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When task execution completed"
          },
          "duration": {
            "type": "number",
            "description": "Execution duration in milliseconds"
          },
          "findingsPath": {
            "type": "string",
            "description": "Relative path to task findings file"
          },
          "error": {
            "type": "string",
            "description": "Error message if task failed"
          },
          "notes": {
            "type": "string",
            "description": "Optional notes about task completion or implementation details"
          },
          "skipReason": {
            "type": "string",
            "description": "Reason for skipping the task if status is 'skipped'"
          },
          "executionConstraints": {
            "type": "object",
            "description": "Execution constraints for this task (e.g., sequential ordering)",
            "properties": {
              "sequential": {
                "type": "boolean",
                "description": "If true, this task must run sequentially (not in parallel with others in same group)"
              },
              "sequentialGroup": {
                "type": "string",
                "description": "Identifier for the sequential group (e.g., '3.1-3.4')"
              },
              "reason": {
                "type": "string",
                "description": "Reason for the constraint (e.g., 'all modify same file')"
              }
            }
          }
        }
      }
    },
    "runs": {
      "type": "array",
      "description": "Execution run history",
      "items": {
        "type": "object",
        "required": ["runId", "startedAt"],
        "properties": {
          "runId": {
            "type": "string",
            "description": "Unique identifier for this run"
          },
          "startedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When this run started"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When this run completed"
          },
          "tasksCompleted": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of tasks completed in this run"
          },
          "tasksFailed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of tasks that failed in this run"
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Overall progress summary",
      "properties": {
        "totalTasks": {
          "type": "integer",
          "minimum": 0
        },
        "completed": {
          "type": "integer",
          "minimum": 0
        },
        "pending": {
          "type": "integer",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "minimum": 0
        },
        "skipped": {
          "type": "integer",
          "minimum": 0
        },
        "in_progress": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tasks currently in progress"
        }
      }
    }
  }
}
